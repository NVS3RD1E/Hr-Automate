{
  "name": "SPU Modern Portal - Dark Theme",
  "nodes": [
    {
      "parameters": {
        "path": "intake/request-position",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a274731c-93a6-4a65-9c66-7de875de5b98",
      "name": "Webhook ‚Ä¢ Intake Form GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        336
      ],
      "webhookId": "spu-intake-get"
    },
    {
      "parameters": {
        "jsCode": "try {\n  const html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤ - SPU</title>\n<meta name=\"theme-color\" content=\"#E5007D\">\n<style>\n:root{\n  --spu-pink:#E5007D;\n  --spu-gray:#f9f9fb;\n  --spu-dark:#222;\n  --spu-border:#ddd;\n  --spu-gold:#ffb703;\n}\n*{box-sizing:border-box;}\nbody{\n  margin:0;\n  font-family:'Sarabun','Segoe UI',Tahoma,Arial,sans-serif;\n  background:var(--spu-gray);\n  color:var(--spu-dark);\n  -webkit-font-smoothing:antialiased;\n}\n.container{max-width:900px;margin:40px auto;padding:0 20px;}\n.brand{display:flex;align-items:center;gap:14px;margin-bottom:30px;}\n.brand img{height:64px;}\n.header{\n  background:var(--spu-pink);\n  border-radius:18px;\n  padding:24px;\n  color:#fff;\n  text-align:center;\n  box-shadow:0 8px 24px rgba(229,0,125,.25);\n}\n.header h1{margin:0;font-size:30px;}\n.header p{margin:6px 0 0;opacity:.95;}\n.card{\n  background:#fff;\n  border:1px solid var(--spu-border);\n  border-radius:18px;\n  padding:30px 24px;\n  margin-top:20px;\n  box-shadow:0 4px 16px rgba(0,0,0,.05);\n}\n.subtitle{color:#555;margin-bottom:24px;text-align:center;}\n.form-group{margin-bottom:20px;}\nlabel{display:block;margin-bottom:8px;font-weight:700;color:var(--spu-dark);}\ninput,select,textarea{\n  width:100%;\n  padding:14px 14px;\n  border-radius:12px;\n  border:1px solid var(--spu-border);\n  background:#fff;\n  color:#222;\n  font-size:16px;\n  transition:border .2s, box-shadow .2s;\n}\ninput:focus,select:focus,textarea:focus{\n  outline:none;\n  border-color:var(--spu-pink);\n  box-shadow:0 0 0 2px rgba(229,0,125,.2);\n}\ntextarea{min-height:120px;resize:vertical;font-family:inherit;}\n.error{font-size:13px;color:#c62828;margin-top:6px;display:none;}\n.is-invalid{border-color:#e63946!important;background:#fff2f2!important;}\n.btn-group{display:flex;gap:12px;margin-top:24px;}\nbutton{\n  flex:1;\n  padding:14px 16px;\n  border-radius:10px;\n  border:none;\n  font-size:16px;\n  font-weight:700;\n  cursor:pointer;\n  transition:all .25s;\n}\n.btn-primary{\n  color:#fff;\n  background:var(--spu-pink);\n  box-shadow:0 4px 12px rgba(229,0,125,.3);\n}\n.btn-primary:hover{background:#c4006b;}\n.btn-secondary{\n  background:#fff;\n  border:1px solid var(--spu-border);\n  color:#333;\n}\n.btn-secondary:hover{background:#f4f4f4;}\nfooter{\n  text-align:center;\n  color:#777;\n  margin-top:40px;\n  font-size:13px;\n}\n@media (max-width:768px){.btn-group{flex-direction:column;}}\n</style>\n</head>\n<body>\n  <div class=\"container\">\n    <div class=\"brand\">\n      <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU Logo\">\n      <div>\n        <strong>SRIPATUM UNIVERSITY</strong><br>\n        <span style=\"color:#666;\">‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏®‡∏£‡∏µ‡∏õ‡∏ó‡∏∏‡∏°</span>\n      </div>\n    </div>\n\n    <div class=\"header\">\n      <h1> ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤</h1>\n      <p>Recruitment & Selection</p>\n    </div>\n\n    <div class=\"card\">\n      <p class=\"subtitle\">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏î‡πÅ‡∏ó‡∏ô (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ * ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å)</p>\n\n      <form id=\"reqForm\" method=\"POST\" action=\"/webhook/intake/request-position\" novalidate>\n        <div class=\"form-group\">\n          <label for=\"request_type\">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏±‡∏ï‡∏£‡∏≤ *</label>\n          <select id=\"request_type\" name=\"request_type\" required>\n            <option value=\"\">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏±‡∏ï‡∏£‡∏≤</option>\n            <option value=\"new\">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÉ‡∏´‡∏°‡πà</option>\n            <option value=\"replacement\">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏î‡πÅ‡∏ó‡∏ô</option>\n          </select>\n          <div class=\"error\" id=\"err_request_type\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏±‡∏ï‡∏£‡∏≤</div>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"department\">‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î/‡∏Ñ‡∏ì‡∏∞ *</label>\n          <input id=\"department\" name=\"department\" type=\"text\" placeholder=\"‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå\" required>\n          <div class=\"error\" id=\"err_department\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î/‡∏Ñ‡∏ì‡∏∞</div>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"position\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ *</label>\n          <input id=\"position\" name=\"position\" type=\"text\" placeholder=\"‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå\" required>\n          <div class=\"error\" id=\"err_position\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>\n        </div>\n        \n        <div class=\"form-group\">\n          <label for=\"reason\">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ *</label>\n          <textarea id=\"reason\" name=\"reason\" placeholder=\"‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤\" required></textarea>\n          <div class=\"error\" id=\"err_reason\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"qualifications\">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ *</label>\n          <textarea id=\"qualifications\" name=\"qualifications\" placeholder=\"‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏±‡∏Å‡∏©‡∏∞\" required></textarea>\n          <div class=\"error\" id=\"err_qualifications\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥</div>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"owner_email\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠ (‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î) *</label>\n          <input id=\"owner_email\" name=\"owner_email\" type=\"email\" placeholder=\"email@spu.ac.th\" required>\n          <div class=\"error\" id=\"err_owner_email\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>\n        </div>\n\n        <div class=\"btn-group\">\n          <button type=\"button\" class=\"btn-secondary\" onclick=\"window.location.href='/webhook/portal'\">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>\n          <button id=\"submitBtn\" type=\"submit\" class=\"btn-primary\">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>\n        </div>\n      </form>\n    </div>\n\n    <footer>&copy; <span id=\"y\"></span> Sripatum University ‚Äî Recruitment & Selection System</footer>\n  </div>\n\n  <script>\n    document.getElementById('y').textContent = new Date().getFullYear() + 543;\n\n    const form = document.getElementById('reqForm');\n    const btn  = document.getElementById('submitBtn');\n    const fields = [\n      {id:'request_type',err:'err_request_type'},\n      {id:'department',err:'err_department'},\n      {id:'position',err:'err_position'},\n      {id:'qualifications',err:'err_qualifications'},\n      {id:'reason',err:'err_reason'},\n      {id:'owner_email',err:'err_owner_email',type:'email'}\n    ];\n\n    function validate(){\n      let ok=true;\n      fields.forEach(f=>{\n        const el=document.getElementById(f.id);\n        const er=document.getElementById(f.err);\n        const v=(el.value||'').trim();\n        let pass=v.length>0;\n        if(pass && f.type==='email') pass=/^[^\\\\s@]+@[^\\\\s@]+\\\\.[^\\\\s@]+$/.test(v);\n        if(!pass){ok=false;el.classList.add('is-invalid');er.style.display='block';}\n        else{el.classList.remove('is-invalid');er.style.display='none';el.value=v;}\n      });\n      return ok;\n    }\n\n    form.addEventListener('submit',e=>{\n      if(!validate()){\n        e.preventDefault();\n        document.querySelector('.is-invalid')?.focus();\n        return false;\n      }\n      btn.disabled=true;btn.textContent='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';\n    });\n\n    fields.forEach(f=>{\n      const el=document.getElementById(f.id);\n      el.addEventListener('input',()=>{el.classList.remove('is-invalid');document.getElementById(f.err).style.display='none';});\n    });\n  </script>\n</body>\n</html>`;\n\n  return [{ json: { html } }];\n} catch (error) {\n  return [{ json: { html: '<h1>Error: ' + (error?.message || error) + '</h1>' } }];\n}\n"
      },
      "id": "727ad785-4ab6-4b7a-9e8c-c1b729f383d7",
      "name": "Code ‚Ä¢ Generate Intake Form",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        240
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "d9f29b54-04e9-4292-8bbf-389da2a80481",
      "name": "Respond ‚Ä¢ Intake Form",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        240
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "intake/request-position",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a85ebbc3-80c6-4000-b69a-6ad32de82f43",
      "name": "Webhook ‚Ä¢ Intake Submit POST",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        1584
      ],
      "webhookId": "spu-intake-post"
    },
    {
      "parameters": {
        "jsCode": "// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å input\nconst body = $input.first().json.body || $input.first().json;\n\n// ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢\nconst now = new Date();\nconst thaiMonths = [\n  '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°',\n  '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'\n];\nconst buddhistYear = now.getFullYear() + 543;\nconst timestamp = `${now.getDate()} ${thaiMonths[now.getMonth()]} ${buddhistYear}`;\nconst paddedMonth = (now.getMonth() + 1).toString().padStart(2, '0');\nconst paddedDay = now.getDate().toString().padStart(2, '0');\nconst reqId = `REQ${buddhistYear}${paddedMonth}${paddedDay}-${Date.now().toString().slice(-6)}`;\n\n// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°\nconst requestType = body.request_type || '';\nconst department = body.department || '';\nconst position = body.position || '';\nconst qualifications = body.qualifications || '';\nconst reason = body.reason || '';\nconst ownerEmail = body.owner_email || '';\n\n// ‡∏™‡∏£‡πâ‡∏≤‡∏á URL base ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏£‡∏á‡πÜ (‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ $env)\nconst baseUrl = 'https://nun9.app.n8n.cloud';\nconst deptEncoded = encodeURIComponent(department);\nconst posEncoded = encodeURIComponent(position);\nconst ownerEncoded = encodeURIComponent(ownerEmail);\n\n// ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò\nconst approveLink = `${baseUrl}/webhook/approval/position?decision=approve&reqid=${reqId}&dept=${deptEncoded}&pos=${posEncoded}&owner=${ownerEncoded}`;\nconst rejectLink  = `${baseUrl}/webhook/approval/position?decision=reject&reqid=${reqId}`;\n\n// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢\nconst typeInThai = requestType === 'new' ? '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÉ‡∏´‡∏°‡πà' : '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏î‡πÅ‡∏ó‡∏ô';\n\n// ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ node ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ\nreturn [{\n  json: {\n    request_id: reqId,\n    request_type: requestType,\n    request_type_th: typeInThai,\n    department: department,\n    position: position,\n    qualifications: qualifications,\n    reason: reason,\n    owner_email: ownerEmail,\n    status: 'pending',\n    submitted_at: timestamp,\n    approval_link: approveLink,\n    reject_link: rejectLink\n  }\n}];\n"
      },
      "id": "eccf43de-9905-4cfc-a216-c800f189acd9",
      "name": "Code ‚Ä¢ Normalize Intake Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        1584
      ]
    },
    {
      "parameters": {
        "fromEmail": "=noreply@spu.ac.th",
        "toEmail": "nurfafa81@gmail.com",
        "subject": "=üîî [‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤] {{ $json.position }} - {{ $json.department }}",
        "emailFormat": "html",
        "html": "=<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° - SPU</title>\n<style>\nbody {\n  font-family: \"Sarabun\", \"Segoe UI\", sans-serif;\n  background: #f5f6fa;\n  margin: 0;\n  padding: 50px 0;\n  color: #1f2937;\n}\n.container {\n  max-width: 900px;\n  margin: auto;\n  background: #fff;\n  border-radius: 10px;\n  border: 1.5px solid #e5e7eb;\n  padding: 80px 90px;\n  box-shadow: 0 6px 18px rgba(0,0,0,0.06);\n  line-height: 1.9;\n  font-size: 18px;\n}\n.header {\n  text-align: center;\n  margin-bottom: 25px;\n}\n.header img {\n  height: 80px;\n  width: auto;\n  display: block;\n  margin: 0 auto 8px auto;\n}\n.header-text {\n  text-align: center;\n  font-weight: 700;\n  font-size: 22px;\n}\n.header-text .urgent {\n  color: #dc2626;\n  margin-right: 8px;\n}\n.header-line {\n  border-bottom: 3px solid #000;\n  margin-top: 10px;\n  margin-bottom: 25px;\n}\n.section { margin-bottom: 14px; }\nlabel {\n  display: inline-block;\n  width: 110px;\n  font-weight: 600;\n  color: #1e293b;\n}\nstrong { color: #111827; }\n\np { margin: 8px 0; }\nol { margin-top: 8px; margin-bottom: 16px; padding-left: 26px; }\nli { margin: 8px 0; }\n\n.btn-group {\n  text-align: center;\n  margin: 50px 0 10px;\n}\nbutton {\n  border: none;\n  border-radius: 50px;\n  padding: 22px 70px;\n  font-size: 18px;\n  font-weight: 600;\n  color: #fff;\n  margin: 0 25px;\n  cursor: pointer;\n  transition: all 0.25s ease;\n  box-shadow: 0 8px 20px rgba(0,0,0,0.12);\n}\nbutton.approve {\n  background: linear-gradient(135deg, #16a34a, #22c55e);\n}\nbutton.reject {\n  background: linear-gradient(135deg, #dc2626, #ef4444);\n}\nbutton:hover {\n  transform: translateY(-2px);\n}\n.footer {\n  text-align: right;\n  margin-top: 80px;\n  font-size: 18px;\n}\n.signature {\n  text-align: right;\n  margin-top: 55px;\n}\n.signature-line {\n  display: inline-block;\n  width: 320px;\n  border-bottom: 1px solid #333;\n  margin-bottom: 5px;\n}\n.note {\n  text-align: center;\n  font-size: 14px;\n  color: #6b7280;\n  margin-top: 40px;\n  border-top: 1px solid #e5e7eb;\n  padding-top: 18px;\n}\n</style>\n</head>\n<body>\n<div class=\"container\">\n\n  <div class=\"header\">\n    <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU Logo\">\n    <div class=\"header-text\">\n      <span class=\"urgent\">‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°\n    </div>\n    <div class=\"header-line\"></div>\n  </div>\n\n  <div class=\"section\"><label>‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô:</label> <strong>{{ $json.department }}</strong></div>\n  <div class=\"section\"><label>‡∏ó‡∏µ‡πà:</label> <strong>{{ $json.request_id }}</strong></div>\n  <div class=\"section\"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label> <strong>{{ $json.submitted_at }}</strong></div>\n  <div class=\"section\"><label>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á:</label> ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{ $json.position }}</div>\n  <div class=\"section\"><label>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label> ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏®‡∏£‡∏µ‡∏õ‡∏ó‡∏∏‡∏°</div>\n\n  <p>‡∏î‡πâ‡∏ß‡∏¢ {{ $json.department }} ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <strong>{{ $json.position }}</strong>\n  ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ</p>\n\n  <ol>\n    <li><strong>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</strong><br>{{ $json.reason }}</li>\n    <li><strong>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</strong><br>{{ $json.qualifications }}</li>\n    <li><strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</strong><br><a href=\"mailto:{{ $json.owner_email }}\">{{ $json.owner_email }}</a></li>\n  </ol>\n\n  <p>‡∏à‡∏∂‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡∏î‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>\n\n  <div class=\"btn-group\">\n    <a href=\"{{ $json.approval_link }}\"><button class=\"approve\">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button></a>\n    <a href=\"{{ $json.reject_link }}\"><button class=\"reject\">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button></a>\n  </div>\n\n  <div class=\"footer\">\n    ‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠<br>\n    <div class=\"signature\">\n      (‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠) <span class=\"signature-line\"></span><br>\n      {{ $json.department }}\n    </div>\n  </div>\n\n  <div class=\"note\">\n    ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ <strong>SPU Recruitment System</strong><br>\n    ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ\n  </div>\n</div>\n</body>\n</html>",
        "options": {}
      },
      "id": "0763f7c9-8851-4d5b-8ad6-ba01d3e26a9a",
      "name": "Email ‚Ä¢ Notify HR Director & Asst President",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        -1728,
        1488
      ],
      "webhookId": "d66244e9-b71f-40c5-8b39-24cb653c12dd",
      "credentials": {
        "smtp": {
          "id": "J3CgwUwFlXIpPIDC",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.success_html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "6694223f-0221-4af7-b926-467fb5b49bcd",
      "name": "Respond ‚Ä¢ Intake Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        1680
      ]
    },
    {
      "parameters": {
        "jsCode": "// ‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡∏à‡∏≤‡∏Å Google Sheets Lookup\nconst row = $input.first().json || {};\n\n// helper ‡∏Å‡∏±‡∏ô XSS ‡πÅ‡∏•‡∏∞ null/undefined\nconst esc = (s) => String(s ?? '')\n  .replace(/&/g,'&amp;')\n  .replace(/</g,'&lt;')\n  .replace(/>/g,'&gt;')\n  .replace(/\"/g,'&quot;')\n  .replace(/'/g,'&#39;');\n\n// ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏ö‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πá‡∏Å/‡πÉ‡∏´‡∏ç‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏ó‡∏¢\nconst data = {\n  request_id: row.request_id ?? row.Request_ID ?? row['Request ID'] ?? row['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏Ç‡∏≠'] ?? '',\n  position: row.position ?? row.Position ?? row['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'] ?? '',\n  department: row.department ?? row.Department ?? row['‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î'] ?? '',\n  submitted_at: row.submitted_at ?? row.Submitted_At ?? row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô'] ?? '',\n};\n\n// HTML ‡πÇ‡∏ó‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Login + ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô\nconst html = String.raw`<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - SPU</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap\" rel=\"stylesheet\">\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{\n  font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;\n  background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);\n  min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;\n  color:#0F172A;\n}\n.container{\n  width:100%; max-width:560px;\n  background:#FFFFFF; border:1px solid #E2E8F0; border-radius:22px;\n  box-shadow:0 20px 40px rgba(2,6,23,.35);\n  padding:36px 36px 30px; text-align:center; animation:fadeIn .5s ease;\n}\n@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}\n\n.logo{display:flex;justify-content:center;align-items:center;margin-bottom:18px} /* ‡πÄ‡∏û‡∏¥‡πà‡∏° margin-bottom ‡πÉ‡∏´‡πâ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */\n.logo img{height:56px;width:auto}\n\n.iconBadge{\n  height:68px;width:68px;margin:12px auto 16px;border-radius:50%;\n  display:flex;align-items:center;justify-content:center;\n  background: #22C55E; color:#fff; box-shadow:0 6px 18px rgba(34,197,94,.35);\n}\n.iconBadge svg{width:36px;height:36px;stroke:#fff;stroke-width:2;fill:none}\n\nh1{font-size:26px;line-height:1.2;font-weight:700;color:#0F172A;margin:10px 0 8px}\n.subtitle{color:#64748B;margin-bottom:18px}\n\n.info-box{\n  text-align:left; background:#F8FAFC; border:1px solid #E2E8F0; border-radius:14px;\n  padding:18px 18px; margin:20px 0 24px;\n}\n.row{display:flex; gap:10px; padding:8px 4px}\n.row + .row{border-top:1px dashed #E2E8F0}\n.label{width:40%; min-width:140px; color:#334155; font-weight:600}\n.value{flex:1; color:#0F172A}\n\n.btn{\n  display:inline-block; width:100%;\n  padding:14px 18px; border-radius:14px; font-weight:700; letter-spacing:.2px;\n  text-decoration:none; color:#fff; text-align:center; transition:all .2s ease;\n  background:linear-gradient(135deg,#E5007D,#C4006B);\n  box-shadow:0 6px 18px rgba(229,0,125,.35);\n}\n.btn:hover{transform:translateY(-1px); box-shadow:0 10px 26px rgba(229,0,125,.45)}\n.btn:active{transform:translateY(0); box-shadow:0 3px 10px rgba(229,0,125,.25)}\n\n.note{margin-top:16px; color:#64748B; font-size:14px}\n</style>\n</head>\n<body>\n  <main class=\"container\" role=\"main\" aria-labelledby=\"success-title\">\n    <div class=\"logo\">\n      <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU Sripatum University\">\n    </div>\n\n    <div class=\"iconBadge\" aria-hidden=\"true\">\n      <svg viewBox=\"0 0 24 24\">\n        <polyline points=\"20 6 9 17 4 12\"></polyline>\n      </svg>\n    </div>\n\n    <h1 id=\"success-title\">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!</h1>\n    <p class=\"subtitle\">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß</p>\n\n    <section class=\"info-box\" aria-label=\"‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠\">\n      <div class=\"row\"><div class=\"label\">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏Ç‡∏≠</div><div class=\"value\">${esc(data.request_id) || '-'}</div></div>\n      <div class=\"row\"><div class=\"label\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div><div class=\"value\">${esc(data.position) || '-'}</div></div>\n      <div class=\"row\"><div class=\"label\">‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</div><div class=\"value\">${esc(data.department) || '-'}</div></div>\n      <div class=\"row\"><div class=\"label\">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô</div><div class=\"value\">${esc(data.submitted_at) || '-'}</div></div>\n    </section>\n\n    <a href=\"/webhook/portal\" class=\"btn\">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>\n    <p class=\"note\">‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 3‚Äì5 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</p>\n  </main>\n</body>\n</html>`;\n\n// ‡πÅ‡∏ô‡∏ö success_html ‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ\nreturn [{ json: { ...row, ...data, success_html: html } }];\n"
      },
      "id": "7854f4c9-ee41-40c2-aa52-bffc2b3fcc67",
      "name": "Code ‚Ä¢ Generate Success Page",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        1680
      ]
    },
    {
      "parameters": {
        "path": "apply",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "25e2e0ff-89c3-4f4f-bbe1-558fe898a32a",
      "name": "Webhook ‚Ä¢ Apply Form GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        2544
      ],
      "webhookId": "spu-apply-get"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "apply",
        "responseMode": "responseNode",
        "options": {
          "binaryPropertyName": "resume"
        }
      },
      "id": "33031f51-7f4c-467c-8f01-f899f4fa67a2",
      "name": "Webhook ‚Ä¢ Apply Submit POST",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        2992
      ],
      "webhookId": "spu-apply-post"
    },
    {
      "parameters": {
        "path": "department/shortlist",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "2323f002-3ff6-4c1e-ac22-b226a8efcbc8",
      "name": "Webhook ‚Ä¢ Shortlist Form GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        2768
      ],
      "webhookId": "spu-shortlist-get"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "department/shortlist",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "ee72b564-7889-48c9-ada8-17fa27ad111d",
      "name": "Webhook ‚Ä¢ Shortlist Submit POST",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        4304
      ],
      "webhookId": "spu-shortlist-post"
    },
    {
      "parameters": {
        "path": "interview/score",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "5ef6a3dd-8716-4fed-b1f7-0a5f1cb8b944",
      "name": "Webhook ‚Ä¢ Interview Score GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        4080
      ],
      "webhookId": "spu-interview-get"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "interview/score",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "90cf3190-c8b4-475e-9fc1-146abe17a035",
      "name": "Webhook ‚Ä¢ Interview Score POST",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        4528
      ],
      "webhookId": "spu-interview-post"
    },
    {
      "parameters": {
        "path": "portal/result",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a35b5fa9-85df-4e1d-84c1-ed6da5167bcf",
      "name": "Webhook ‚Ä¢ Result Helper GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        3856
      ],
      "webhookId": "spu-result-get"
    },
    {
      "parameters": {
        "path": "approval/position",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a4105898-7f4a-490b-9497-dd375ec5f479",
      "name": "Webhook ‚Ä¢ Approval Position GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        2224
      ],
      "webhookId": "spu-approval-position"
    },
    {
      "parameters": {
        "path": "approval/final",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "0157d7ad-3683-4ecf-ae58-2843ec61741d",
      "name": "Webhook ‚Ä¢ Approval Final GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        4848
      ],
      "webhookId": "spu-approval-final"
    },
    {
      "parameters": {
        "jsCode": "try {\n  const html = String.raw`<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô - SPU</title>\n<meta name=\"theme-color\" content=\"#E5007D\">\n<style>\n:root{\n  --spu-pink:#E5007D;\n  --spu-gray:#f9f9fb;\n  --spu-dark:#222;\n  --spu-border:#ddd;\n}\n*{box-sizing:border-box}\nbody{\n  margin:0;\n  font-family:'Sarabun','Segoe UI',Tahoma,Arial,sans-serif;\n  background:var(--spu-gray);\n  color:var(--spu-dark);\n  -webkit-font-smoothing:antialiased;\n}\n.container{max-width:900px;margin:40px auto;padding:0 20px}\n.brand{display:flex;align-items:center;gap:14px;margin-bottom:30px}\n.brand img{height:64px}\n.header{\n  background:var(--spu-pink);\n  border-radius:18px;\n  padding:24px;\n  color:#fff;\n  text-align:center;\n  box-shadow:0 8px 24px rgba(229,0,125,.25);\n}\n.header h1{margin:0;font-size:30px}\n.header p{margin:6px 0 0;opacity:.95}\n.card{\n  background:#fff;\n  border:1px solid var(--spu-border);\n  border-radius:18px;\n  padding:30px 24px;\n  margin-top:20px;\n  box-shadow:0 4px 16px rgba(0,0,0,.05);\n}\n.subtitle{color:#555;margin-bottom:24px;text-align:center}\n.grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}\n@media (max-width:768px){.grid{grid-template-columns:1fr}}\n.form-group{margin-bottom:18px}\nlabel{display:block;margin-bottom:8px;font-weight:700;color:var(--spu-dark)}\ninput,select,textarea{\n  width:100%;padding:14px;border-radius:12px;\n  border:1px solid var(--spu-border);background:#fff;color:#222;font-size:16px;\n  transition:border .2s, box-shadow .2s\n}\ninput:focus,select:focus,textarea:focus{\n  outline:none;border-color:var(--spu-pink);box-shadow:0 0 0 2px rgba(229,0,125,.2)\n}\ntextarea{min-height:120px;resize:vertical;font-family:inherit}\nsmall.help{color:#6b7280;display:block;margin-top:6px}\n.error{font-size:13px;color:#c62828;margin-top:6px;display:none}\n.is-invalid{border-color:#e63946!important;background:#fff2f2!important}\n.btn-group{display:flex;gap:12px;margin-top:24px}\nbutton{\n  flex:1;padding:14px 16px;border-radius:10px;border:none;font-size:16px;font-weight:700;cursor:pointer;transition:all .25s\n}\n.btn-primary{color:#fff;background:var(--spu-pink);box-shadow:0 4px 12px rgba(229,0,125,.3)}\n.btn-primary:hover{background:#c4006b}\n.btn-secondary{background:#fff;border:1px solid var(--spu-border);color:#333}\n.btn-secondary:hover{background:#f4f4f4}\nfooter{text-align:center;color:#777;margin-top:40px;font-size:13px}\n</style>\n</head>\n<body>\n  <div class=\"container\">\n    <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ SPU -->\n    <div class=\"brand\">\n      <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU Logo\">\n      <div>\n        <strong>SRIPATUM UNIVERSITY</strong><br>\n        <span style=\"color:#666\">‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏®‡∏£‡∏µ‡∏õ‡∏ó‡∏∏‡∏°</span>\n      </div>\n    </div>\n\n    <!-- ‡∏´‡∏±‡∏ß‡∏ä‡∏°‡∏û‡∏π -->\n    <div class=\"header\">\n      <h1>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô</h1>\n      <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheets ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà/CV</p>\n    </div>\n\n    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏° -->\n    <div class=\"card\">\n      <p class=\"subtitle\">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ * ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å)</p>\n\n      <form id=\"applyForm\" method=\"POST\" action=\"/webhook/apply\" enctype=\"multipart/form-data\" novalidate>\n        <div class=\"grid\">\n          <div class=\"form-group\">\n            <label for=\"first_name\">‡∏ä‡∏∑‡πà‡∏≠ *</label>\n            <input id=\"first_name\" name=\"first_name\" type=\"text\" placeholder=\"‡∏ä‡∏∑‡πà‡∏≠\" required>\n            <div class=\"error\" id=\"err_first_name\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠</div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"last_name\">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>\n            <input id=\"last_name\" name=\"last_name\" type=\"text\" placeholder=\"‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•\" required>\n            <div class=\"error\" id=\"err_last_name\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"email\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥) *</label>\n            <input id=\"email\" name=\"email\" type=\"email\" inputmode=\"email\" autocomplete=\"email\"\n                   placeholder=\"‡πÄ‡∏ä‡πà‡∏ô yourname@gmail.com\" required>\n            <small class=\"help\">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏• @spu.ac.th ‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô</small>\n            <div class=\"error\" id=\"err_email\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"phone\">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>\n            <input id=\"phone\" name=\"phone\" type=\"tel\" placeholder=\"08x-xxx-xxxx\" required>\n            <div class=\"error\" id=\"err_phone\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>\n          </div>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"position\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£ *</label>\n          <input id=\"position\" name=\"position\" type=\"text\" placeholder=\"‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥, ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£\" required>\n          <div class=\"error\" id=\"err_position\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>\n        </div>\n\n        <div class=\"grid\">\n          <div class=\"form-group\">\n            <label for=\"department\">‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à *</label>\n            <select id=\"department\" name=\"department\" required>\n              <option value=\"\">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>\n              <option>‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>\n              <option>‡∏Ñ‡∏ì‡∏∞‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</option>\n              <option>‡∏Ñ‡∏ì‡∏∞‡∏®‡∏¥‡∏•‡∏õ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>\n              <option>‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>\n              <option>‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</option>\n              <option>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏î‡∏µ</option>\n              <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>\n            </select>\n            <div class=\"error\" id=\"err_department\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"education\">‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î *</label>\n            <select id=\"education\" name=\"education\" required>\n              <option value=\"\">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>\n              <option>‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ</option>\n              <option>‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó</option>\n              <option>‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å</option>\n            </select>\n            <div class=\"error\" id=\"err_education\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</div>\n          </div>\n        </div>\n\n        <div class=\"grid\">\n          <div class=\"form-group\">\n            <label for=\"experience_years\">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡∏õ‡∏µ)</label>\n            <input id=\"experience_years\" name=\"experience_years\" type=\"number\" min=\"0\" max=\"50\" value=\"0\">\n            <small class=\"help\">‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà 0</small>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"resume\">‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà/CV (PDF/Doc, ‚â§ 10MB) *</label>\n            <input id=\"resume\" name=\"resume\" type=\"file\" accept=\".pdf,.doc,.docx\" required>\n            <div class=\"error\" id=\"err_resume\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà/CV (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö .pdf .doc .docx ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB)</div>\n          </div>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"skills\">‡∏ó‡∏±‡∏Å‡∏©‡∏∞/‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</label>\n          <textarea id=\"skills\" name=\"skills\" placeholder=\"‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏±‡∏Å‡∏©‡∏∞ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©\"></textarea>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"motivation\">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£ *</label>\n          <textarea id=\"motivation\" name=\"motivation\" placeholder=\"‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö ‡∏°‡∏®‡∏õ.\" required></textarea>\n          <div class=\"error\" id=\"err_motivation\">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>\n        </div>\n\n        <div class=\"btn-group\">\n          <button type=\"button\" class=\"btn-secondary\" onclick=\"window.location.href='/webhook/portal'\">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>\n          <button id=\"submitBtn\" type=\"submit\" class=\"btn-primary\">‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>\n        </div>\n      </form>\n    </div>\n\n    <footer>&copy; <span id=\"y\"></span> Sripatum University ‚Äî Recruitment & Selection System</footer>\n  </div>\n\n<script>\n  // ‡∏õ‡∏µ ‡∏û.‡∏®.\n  document.getElementById('y').textContent = new Date().getFullYear() + 543;\n\n  const form = document.getElementById('applyForm');\n  const btn  = document.getElementById('submitBtn');\n\n  const fields = [\n    {id:'first_name', err:'err_first_name'},\n    {id:'last_name',  err:'err_last_name'},\n    {id:'email',      err:'err_email', type:'email'},\n    {id:'phone',      err:'err_phone'},\n    {id:'position',   err:'err_position'},\n    {id:'department', err:'err_department'},\n    {id:'education',  err:'err_education'},\n    {id:'motivation', err:'err_motivation'},\n    {id:'resume',     err:'err_resume', type:'file'}\n  ];\n\n  function validate(){\n    let ok = true;\n\n    fields.forEach(f=>{\n      const el = document.getElementById(f.id);\n      const er = document.getElementById(f.err);\n      let v = (el.value || '').trim();\n      let pass = v.length > 0;\n\n      // ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡πÇ‡∏î‡πÄ‡∏°‡∏ô)\n      if (f.type === 'email' && pass) {\n        pass = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(v);\n      }\n\n      // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡∏ô‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå + ‡∏Ç‡∏ô‡∏≤‡∏î ‚â§ 10MB\n      if (f.type === 'file') {\n        const file = el.files && el.files[0];\n        pass = !!file;\n        if (pass) {\n          const okExt  = /\\.(pdf|doc|docx)$/i.test(file.name || '');\n          const okSize = file.size <= 10 * 1024 * 1024;\n          pass = okExt && okSize;\n        }\n      }\n\n      if (!pass) {\n        ok = false;\n        el.classList.add('is-invalid');\n        er.style.display = 'block';\n      } else {\n        el.classList.remove('is-invalid');\n        er.style.display = 'none';\n        if (f.type !== 'file') el.value = v;\n      }\n    });\n\n    return ok;\n  }\n\n  form.addEventListener('submit', (e)=>{\n    if (!validate()) {\n      e.preventDefault();\n      document.querySelector('.is-invalid')?.focus();\n      return false;\n    }\n    btn.disabled = true;\n    btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';\n  });\n\n  // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå error ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå\n  fields.forEach(f=>{\n    const el = document.getElementById(f.id);\n    const clear = () => {\n      el.classList.remove('is-invalid');\n      document.getElementById(f.err).style.display = 'none';\n    };\n    el.addEventListener('input', clear);\n    if (f.type === 'file') el.addEventListener('change', clear);\n  });\n</script>\n</body>\n</html>`;\n\n  return [{ json: { html } }];\n} catch (e) {\n  return [{ json: { error: String(e) } }];\n}\n"
      },
      "id": "a65b3dad-a2a4-4ae6-80f1-7ac85754001d",
      "name": "Code ‚Ä¢ Generate Apply Form",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        2544
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "bb24a523-841c-4b16-863e-5411a7377716",
      "name": "Respond ‚Ä¢ Apply Form",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1952,
        2544
      ]
    },
    {
      "parameters": {
        "jsCode": "const html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n<title>‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå - SPU</title>\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{font-family:'Sarabun','Segoe UI',sans-serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);min-height:100vh;color:#fff;padding:40px 20px}\n.container{max-width:900px;margin:0 auto;background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);border-radius:20px;padding:40px;border:1px solid rgba(255,255,255,0.1)}\nh1{text-align:center;margin-bottom:10px;font-size:36px;color:#FFD700}\n.subtitle{text-align:center;opacity:0.9;margin-bottom:40px}\n.form-group{margin-bottom:25px}\nlabel{display:block;margin-bottom:8px;font-weight:600;color:#FFD700}\ninput,select,textarea{width:100%;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.1);color:#fff;font-size:16px}\ninput:focus,select:focus{outline:none;border-color:#FFD700;background:rgba(255,255,255,0.15)}\ninput::placeholder{color:rgba(255,255,255,0.5)}\nselect option{background:#1a1a2e}\n.form-row{display:grid;grid-template-columns:1fr 1fr;gap:20px}\n.btn-group{display:flex;gap:15px;margin-top:35px}\nbutton{flex:1;padding:16px;border-radius:30px;border:none;font-size:18px;font-weight:700;cursor:pointer;transition:all 0.3s}\n.btn-primary{background:linear-gradient(135deg,#FFD700,#FFA500);color:#1a1a2e}\n.btn-primary:hover{transform:translateY(-3px)}\n.btn-secondary{background:rgba(255,255,255,0.1);color:#fff}\n.back-link{display:inline-block;margin-bottom:20px;color:#FFD700;text-decoration:none}\n.info-box{background:rgba(255,215,0,0.1);padding:15px;border-radius:10px;margin:20px 0;border-left:4px solid #FFD700}\n@media (max-width:768px){\n.form-row{grid-template-columns:1fr}\n.btn-group{flex-direction:column}\n}\n</style>\n<script>\nfunction buildGCalLink() {\n  const name = document.querySelector('[name=candidate_name]').value;\n  const pos = document.querySelector('[name=position]').value;\n  const dept = document.querySelector('[name=department]').value;\n  const date = document.querySelector('[name=interview_date]').value;\n  const time = document.querySelector('[name=interview_time]').value;\n  const room = document.querySelector('[name=interview_room]').value;\n  const guests = document.querySelector('[name=committee_emails]').value;\n  \n  if(!date || !time) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå');\n  \n  const datetime = date.replace(/-/g,'') + 'T' + time.replace(':','') + '00';\n  const endtime = date.replace(/-/g,'') + 'T' + (parseInt(time.split(':')[0])+1).toString().padStart(2,'0') + time.split(':')[1] + '00';\n  \n  const title = encodeURIComponent(`‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå: ${pos} (${dept})`);\n  const details = encodeURIComponent(`‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: ${name}\\n‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${pos}\\n‡∏´‡πâ‡∏≠‡∏á: ${room}`);\n  const location = encodeURIComponent(room);\n  const guestList = guests.split(',').map(e=>e.trim()).join(',');\n  \n  const link = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${datetime}/${endtime}&details=${details}&location=${location}&add=${guestList}&ctz=Asia/Bangkok`;\n  \n  window.open(link, '_blank');\n}\n</script>\n</head>\n<body>\n<div class=\"container\">\n<a href=\"/webhook/portal\" class=\"back-link\">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>\n<h1>üë• ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</h1>\n<p class=\"subtitle\">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 7-8: ‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡πÉ‡∏ô Google Calendar</p>\n<form method=\"POST\" action=\"/webhook/department/shortlist\">\n<div class=\"form-group\">\n<label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ *</label>\n<input type=\"text\" name=\"candidate_name\" placeholder=\"‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>\n<input type=\"text\" name=\"position\" placeholder=\"‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô *</label>\n<input type=\"text\" name=\"department\" placeholder=\"‡∏Ñ‡∏ì‡∏∞\" required>\n</div>\n<div class=\"form-row\">\n<div class=\"form-group\">\n<label>‡∏ß‡∏±‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå *</label>\n<input type=\"date\" name=\"interview_date\" required>\n</div>\n<div class=\"form-group\">\n<label>‡πÄ‡∏ß‡∏•‡∏≤ *</label>\n<input type=\"time\" name=\"interview_time\" required>\n</div>\n</div>\n<div class=\"form-group\">\n<label>‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå *</label>\n<input type=\"text\" name=\"interview_room\" placeholder=\"‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡πâ‡∏≠‡∏á 306 ‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 1\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£ (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ comma) *</label>\n<input type=\"text\" name=\"committee_emails\" placeholder=\"email1@spu.ac.th, email2@spu.ac.th\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>\n<input type=\"email\" name=\"candidate_email\" placeholder=\"candidate@email.com\">\n</div>\n<div class=\"info-box\">\n<strong>üí° Tips:</strong> ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏î‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡πÉ‡∏ô Google Calendar ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡πÄ‡∏ä‡∏¥‡∏ç‡πÑ‡∏õ‡∏´‡∏≤‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥\n</div>\n<div class=\"btn-group\">\n<button type=\"button\" class=\"btn-secondary\" onclick=\"buildGCalLink()\">üóìÔ∏è ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß Calendar Link</button>\n<button type=\"submit\" class=\"btn-primary\">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</button>\n</div>\n</form>\n</div>\n</body>\n</html>`;\nreturn [{json:{html}}];"
      },
      "id": "a368b751-4f14-4b06-af00-5dda5d908053",
      "name": "Code ‚Ä¢ Generate Shortlist Form",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        2768
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "c505bf03-0a86-475d-a4f4-88efcd4c8d6d",
      "name": "Respond ‚Ä¢ Shortlist Form",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1952,
        2768
      ]
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body;\nconst now = new Date();\nconst thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];\nconst interviewDate = new Date(body.interview_date + 'T' + body.interview_time);\nconst buddhistYear = interviewDate.getFullYear() + 543;\nconst thaiDate = `${interviewDate.getDate()} ${thaiMonths[interviewDate.getMonth()]} ${buddhistYear}`;\n\nreturn [{\njson: {\ncandidate_name: body.candidate_name,\nposition: body.position,\ndepartment: body.department,\ninterview_date: body.interview_date,\ninterview_time: body.interview_time,\ninterview_datetime_iso: interviewDate.toISOString(),\ninterview_date_thai: thaiDate,\ninterview_room: body.interview_room,\ncommittee_emails: body.committee_emails,\ncandidate_email: body.candidate_email || '',\nevent_title: `‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå: ${body.position} (${body.department})`,\nevent_description: `‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: ${body.candidate_name}\\n‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${body.position}\\n‡∏´‡πâ‡∏≠‡∏á: ${body.interview_room}`\n}\n}];"
      },
      "id": "c8ab9a7e-cb41-4f58-84a9-d9aa5575343e",
      "name": "Code ‚Ä¢ Normalize Shortlist Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        4304
      ]
    },
    {
      "parameters": {
        "jsCode": "const html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n<title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå - SPU</title>\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{font-family:'Sarabun','Segoe UI',sans-serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);min-height:100vh;color:#fff;padding:40px 20px}\n.container{max-width:900px;margin:0 auto;background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);border-radius:20px;padding:40px;border:1px solid rgba(255,255,255,0.1)}\nh1{text-align:center;margin-bottom:10px;font-size:36px;color:#FFD700}\n.subtitle{text-align:center;opacity:0.9;margin-bottom:40px}\n.form-group{margin-bottom:25px}\nlabel{display:block;margin-bottom:8px;font-weight:600;color:#FFD700}\ninput,select,textarea{width:100%;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.1);color:#fff;font-size:16px}\ninput:focus,select:focus,textarea:focus{outline:none;border-color:#FFD700;background:rgba(255,255,255,0.15)}\ninput::placeholder,textarea::placeholder{color:rgba(255,255,255,0.5)}\nselect option{background:#1a1a2e}\ntextarea{min-height:120px;resize:vertical;font-family:inherit}\n.score-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}\n.btn-group{display:flex;gap:15px;margin-top:35px}\nbutton{flex:1;padding:16px;border-radius:30px;border:none;font-size:18px;font-weight:700;cursor:pointer;transition:all 0.3s}\n.btn-primary{background:linear-gradient(135deg,#FFD700,#FFA500);color:#1a1a2e}\n.btn-primary:hover{transform:translateY(-3px)}\n.btn-secondary{background:rgba(255,255,255,0.1);color:#fff}\n.back-link{display:inline-block;margin-bottom:20px;color:#FFD700;text-decoration:none}\n@media (max-width:768px){\n.score-grid{grid-template-columns:1fr}\n.btn-group{flex-direction:column}\n}\n</style>\n</head>\n<body>\n<div class=\"container\">\n<a href=\"/webhook/portal\" class=\"back-link\">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>\n<h1>üìä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</h1>\n<p class=\"subtitle\">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 8: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</p>\n<form method=\"POST\" action=\"/webhook/interview/score\">\n<div class=\"form-group\">\n<label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ *</label>\n<input type=\"text\" name=\"candidate_name\" placeholder=\"‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>\n<input type=\"text\" name=\"position\" placeholder=\"‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô *</label>\n<input type=\"text\" name=\"interviewer\" placeholder=\"‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô\" required>\n</div>\n<div class=\"score-grid\">\n<div class=\"form-group\">\n<label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ/‡∏ó‡∏±‡∏Å‡∏©‡∏∞ (0-40) *</label>\n<input type=\"number\" name=\"technical_score\" min=\"0\" max=\"40\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ (0-30) *</label>\n<input type=\"number\" name=\"communication_score\" min=\"0\" max=\"30\" required>\n</div>\n<div class=\"form-group\">\n<label>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û (0-30) *</label>\n<input type=\"number\" name=\"personality_score\" min=\"0\" max=\"30\" required>\n</div>\n</div>\n<div class=\"form-group\">\n<label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>\n<textarea name=\"comments\" placeholder=\"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£\"></textarea>\n</div>\n<div class=\"btn-group\">\n<button type=\"button\" class=\"btn-secondary\" onclick=\"window.location.href='/webhook/portal'\">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>\n<button type=\"submit\" class=\"btn-primary\">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>\n</div>\n</form>\n</div>\n</body>\n</html>`;\nreturn [{json:{html}}];"
      },
      "id": "a0f5c304-c1fa-4c8c-bff6-99a4856ce62f",
      "name": "Code ‚Ä¢ Generate Interview Form",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        4080
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "b3b7a85d-d62c-465b-9c7b-c5f5768bc968",
      "name": "Respond ‚Ä¢ Interview Form",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1952,
        4080
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "6a033ddf-246e-492f-bf7b-90b8b839d487",
      "name": "Respond ‚Ä¢ Apply Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1728,
        2992
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst html = `<!DOCTYPE html><html lang='th'><head><meta charset='UTF-8'><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Sarabun',sans-serif;background:linear-gradient(135deg,#1a1a2e,#0f3460);min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff;padding:20px}.box{max-width:700px;background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);border-radius:20px;padding:50px;text-align:center;border:1px solid rgba(255,255,255,0.1)}.icon{font-size:80px;margin-bottom:30px}h1{color:#FFD700;font-size:32px;margin-bottom:20px}p{font-size:18px;line-height:1.8;margin-bottom:15px}.info{background:rgba(255,215,0,0.1);padding:20px;border-radius:12px;margin:25px 0;border-left:4px solid #FFD700;text-align:left}.info strong{color:#FFD700}.btn{display:inline-block;background:linear-gradient(135deg,#FFD700,#FFA500);color:#1a1a2e;padding:14px 35px;border-radius:30px;text-decoration:none;font-weight:700;margin-top:25px}.btn:hover{transform:scale(1.05)}</style></head><body><div class='box'><div class='icon'>üóìÔ∏è</div><h1>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</h1><p>‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡πÉ‡∏ô Google Calendar ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡πÄ‡∏ä‡∏¥‡∏ç‡πÅ‡∏•‡πâ‡∏ß</p><div class='info'><strong>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> ${data.candidate_name}<br><strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ${data.position}<br><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${data.interview_date_thai}<br><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${data.interview_time} ‡∏ô.<br><strong>‡∏´‡πâ‡∏≠‡∏á:</strong> ${data.interview_room}</div><p>‡∏Ñ‡∏ì‡∏∞‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡πÄ‡∏ä‡∏¥‡∏ç</p><a href='/webhook/portal' class='btn'>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></div></body></html>`;\nreturn [{json:{html}}];"
      },
      "id": "af9ed952-4e22-465e-a7fa-41a59cac710d",
      "name": "Code ‚Ä¢ Generate Shortlist Success",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        4304
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "cda83164-f686-4832-828f-3ba868558845",
      "name": "Respond ‚Ä¢ Shortlist Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        4304
      ]
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body;\nconst now = new Date();\nconst thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];\nconst buddhistYear = now.getFullYear() + 543;\nconst timestamp = `${now.getDate()} ${thaiMonths[now.getMonth()]} ${buddhistYear}`;\nconst evalId = `EVAL${buddhistYear}-${Date.now().toString().slice(-6)}`;\nconst totalScore = parseInt(body.technical_score) + parseInt(body.communication_score) + parseInt(body.personality_score);\n\nreturn [{\njson: {\nevaluation_id: evalId,\ncandidate_name: body.candidate_name,\nposition: body.position,\ninterviewer: body.interviewer,\ntechnical_score: body.technical_score,\ncommunication_score: body.communication_score,\npersonality_score: body.personality_score,\noverall_score: totalScore,\ncomments: body.comments || '',\ninterview_date: timestamp\n}\n}];"
      },
      "id": "e429cc46-5588-47b7-9e79-91a8c1476cd5",
      "name": "Code ‚Ä¢ Normalize Interview Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        4528
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": "={{$env.GSHEET_EVAL_ID}}",
        "sheetName": "Sheet1",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "id": "f1a0e16a-2938-4ed8-b3a2-f00c87f9d004",
      "name": "Google Sheets ‚Ä¢ Log Evaluation",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        -1952,
        4528
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "l9NRl6KMlOIOCf0N",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst html = `<!DOCTYPE html><html lang='th'><head><meta charset='UTF-8'><style>*{margin:0;padding:0}body{font-family:'Sarabun',sans-serif;background:linear-gradient(135deg,#1a1a2e,#0f3460);min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff;padding:20px}.box{max-width:600px;background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);border-radius:20px;padding:50px;text-align:center;border:1px solid rgba(255,255,255,0.1)}.icon{font-size:80px;margin-bottom:30px}h1{color:#FFD700;font-size:32px;margin-bottom:20px}p{font-size:18px;margin-bottom:15px}.info{background:rgba(255,215,0,0.1);padding:20px;border-radius:12px;margin:25px 0;text-align:left}.info strong{color:#FFD700}.btn{display:inline-block;background:linear-gradient(135deg,#FFD700,#FFA500);color:#1a1a2e;padding:14px 35px;border-radius:30px;text-decoration:none;font-weight:700;margin-top:25px}.btn:hover{transform:scale(1.05)}</style></head><body><div class='box'><div class='icon'>‚úÖ</div><h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</h1><p>‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏•‡∏á Google Sheets ‡πÅ‡∏•‡πâ‡∏ß</p><div class='info'><strong>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> ${data.candidate_name}<br><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°:</strong> ${data.overall_score}/100<br><strong>‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</strong> ${data.interviewer}</div><a href='/webhook/portal' class='btn'>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></div></body></html>`;\nreturn [{json:{html}}];"
      },
      "id": "566d2188-7fa8-4123-ab55-1d97da1db230",
      "name": "Code ‚Ä¢ Generate Interview Success",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        4528
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "5b9d5756-e025-4ec0-b909-aab2e4fe9a65",
      "name": "Respond ‚Ä¢ Interview Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        4528
      ]
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "en.th#holiday@group.v.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Holidays in Thailand"
        },
        "start": "={{$json.interview_datetime_iso}}",
        "end": "={{new Date(new Date($json.interview_datetime_iso).getTime() + 3600000).toISOString()}}",
        "additionalFields": {}
      },
      "id": "eee25178-bcb6-467d-8307-d67604eb1b84",
      "name": "Google Calendar ‚Ä¢ Create Event",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1,
      "position": [
        -1952,
        4304
      ],
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "ldcjj2ZSHcjCpWeR",
          "name": "Google Calendar account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const baseUrl = $env.BASE_URL || 'https://your-n8n-instance.app.n8n.cloud';\nconst html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\">\n<title>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ - SPU</title>\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{font-family:'Sarabun',sans-serif;background:linear-gradient(135deg,#1a1a2e,#0f3460);min-height:100vh;color:#fff;padding:40px 20px}\n.container{max-width:900px;margin:0 auto;background:rgba(255,255,255,0.08);backdrop-filter:blur(15px);border-radius:20px;padding:40px;border:1px solid rgba(255,255,255,0.1)}\nh1{text-align:center;color:#FFD700;font-size:36px;margin-bottom:40px}\n.form-group{margin-bottom:25px}\nlabel{display:block;margin-bottom:8px;font-weight:600;color:#FFD700}\ninput,select{width:100%;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.1);color:#fff;font-size:16px}\ninput:focus{outline:none;border-color:#FFD700}\n.btn{width:100%;padding:16px;border-radius:30px;border:none;font-size:18px;font-weight:700;cursor:pointer;background:linear-gradient(135deg,#FFD700,#FFA500);color:#1a1a2e;margin-top:30px}\n.btn:hover{transform:translateY(-3px)}\n.result-box{display:none;margin-top:30px;padding:25px;background:rgba(255,215,0,0.1);border-radius:12px;border-left:4px solid #FFD700}\n.result-box h3{color:#FFD700;margin-bottom:15px}\n.link-display{background:rgba(0,0,0,0.3);padding:15px;border-radius:8px;word-break:break-all;font-size:14px;margin:10px 0}\n.copy-btn{display:inline-block;background:#4CAF50;color:#fff;padding:10px 20px;border-radius:8px;text-decoration:none;margin-top:10px;cursor:pointer}\n</style>\n<script>\nfunction generateLink() {\n  const name = document.querySelector('[name=candidate_name]').value;\n  const pos = document.querySelector('[name=position]').value;\n  const start = document.querySelector('[name=start_date]').value;\n  const salary = document.querySelector('[name=salary]').value;\n  const decision = document.querySelector('[name=decision]').value;\n  \n  if(!name || !pos || !start) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');\n  \n  const link = '${baseUrl}/webhook/approval/final?decision=' + decision + \n               '&candidate=' + encodeURIComponent(name) +\n               '&position=' + encodeURIComponent(pos) +\n               '&start=' + start +\n               '&salary=' + salary;\n  \n  document.getElementById('result').style.display = 'block';\n  document.getElementById('linkDisplay').textContent = link;\n}\n\nfunction copyLink() {\n  const text = document.getElementById('linkDisplay').textContent;\n  navigator.clipboard.writeText(text);\n  alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!');\n}\n</script>\n</head>\n<body>\n<div class=\"container\">\n<h1>üîó ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</h1>\n<p style=\"text-align:center;margin-bottom:30px;opacity:0.9\">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 9-15: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏î‡∏µ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á Offer</p>\n<div class=\"form-group\">\n<label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ *</label>\n<input type=\"text\" name=\"candidate_name\" placeholder=\"‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•\">\n</div>\n<div class=\"form-group\">\n<label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á *</label>\n<input type=\"text\" name=\"position\" placeholder=\"‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á\">\n</div>\n<div class=\"form-group\">\n<label>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô *</label>\n<input type=\"date\" name=\"start_date\">\n</div>\n<div class=\"form-group\">\n<label>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>\n<input type=\"number\" name=\"salary\" placeholder=\"25000\">\n</div>\n<div class=\"form-group\">\n<label>‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô *</label>\n<select name=\"decision\">\n<option value=\"approve\">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Approve)</option>\n<option value=\"reject\">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Reject)</option>\n</select>\n</div>\n<button class=\"btn\" onclick=\"generateLink()\">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå</button>\n<div id=\"result\" class=\"result-box\">\n<h3>‚úÖ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:</h3>\n<div id=\"linkDisplay\" class=\"link-display\"></div>\n<button class=\"copy-btn\" onclick=\"copyLink()\">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>\n<p style=\"margin-top:15px;font-size:14px;opacity:0.8\">‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏î‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>\n</div>\n</div>\n</body>\n</html>`;\nreturn [{json:{html}}];"
      },
      "id": "58926ce3-5689-4eac-8eae-0f88c81d010b",
      "name": "Code ‚Ä¢ Generate Result Page",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        3856
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "412bbeed-793a-4a2c-b5bc-d8ba55445a3c",
      "name": "Respond ‚Ä¢ Result Page",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1952,
        3856
      ]
    },
    {
      "parameters": {
        "jsCode": "const query = $input.first().json.query;\nconst decision = query.decision;\nconst candidate = query.candidate;\nconst position = query.position;\nconst start = query.start;\nconst salary = query.salary || '25,000';\n\nreturn [{json:{decision, candidate, position, start_date: start, salary, status: decision === 'approve' ? 'hired' : 'rejected'}}];"
      },
      "id": "33481f5d-8d66-4004-86bb-dd7b59a67033",
      "name": "Code ‚Ä¢ Process Final Approval",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        4848
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.decision}}",
              "operation": "equals",
              "value2": "approve"
            }
          ]
        }
      },
      "id": "b9018d54-5e91-490d-80ea-680c800a5570",
      "name": "IF ‚Ä¢ Check Final Approved",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -1952,
        4848
      ]
    },
    {
      "parameters": {
        "fromEmail": "={{$env.SMTP_FROM}}",
        "toEmail": "={{$json.candidate_email || 'candidate@example.com'}}",
        "subject": "üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å - {{$json.position}}",
        "options": {}
      },
      "id": "fd199446-1001-4cad-a905-34249fe7ae0d",
      "name": "Email ‚Ä¢ Send Offer Letter",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        -1728,
        4752
      ],
      "webhookId": "a771eb14-30a0-4690-86bb-f7b489708799",
      "credentials": {
        "smtp": {
          "id": "J3CgwUwFlXIpPIDC",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "={{$env.SMTP_FROM}}",
        "toEmail": "={{$env.DEPARTMENT_INBOX}}",
        "subject": "üì¢ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô: {{$json.candidate}} - {{$json.position}}",
        "options": {}
      },
      "id": "4ebe00ed-5c36-46e1-9bf6-309fcbb004f3",
      "name": "Email ‚Ä¢ Notify Department Start",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [
        -1728,
        4944
      ],
      "webhookId": "e0de1485-fcbd-462f-86cb-44721bad2be3",
      "credentials": {
        "smtp": {
          "id": "J3CgwUwFlXIpPIDC",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<h1 style='color:green'>‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á Offer ‡πÅ‡∏•‡πâ‡∏ß</h1><p>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: {{$json.candidate}}</p><p>‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á Offer Letter ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß</p>",
        "options": {}
      },
      "id": "3133eed9-d826-4b74-b624-49cdde435d16",
      "name": "Respond ‚Ä¢ Final Success",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        4752
      ]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1bcat93r9rpgauePtFrkylEl658Qd8sfgoNP1z1l-mgY",
          "mode": "list",
          "cachedResultName": "Data",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bcat93r9rpgauePtFrkylEl658Qd8sfgoNP1z1l-mgY/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bcat93r9rpgauePtFrkylEl658Qd8sfgoNP1z1l-mgY/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "request_id",
              "displayName": "request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "request_type",
              "displayName": "request_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "request_type_th",
              "displayName": "request_type_th",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "department",
              "displayName": "department",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "position",
              "displayName": "position",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "qualifications",
              "displayName": "qualifications",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reason",
              "displayName": "reason",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "owner_email",
              "displayName": "owner_email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "submitted_at",
              "displayName": "submitted_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "approval_link",
              "displayName": "approval_link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reject_link",
              "displayName": "reject_link",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "4018dd0d-ccf0-4821-9337-95b9fc7ad3d7",
      "name": "Google Sheets ‚Ä¢ Log Applicant1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        -1952,
        1584
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "l9NRl6KMlOIOCf0N",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const query = $input.first().json.query;\nconst decision = query.decision;\nconst reqid = query.reqid;\nconst dept = query.dept;\nconst pos = query.pos;\nconst owner = query.owner;\n\nconst html = decision === 'approve' ? \n`<h2 style=\"color:green\">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</h2><p>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${reqid}</p><p>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${pos}</p><p>‡∏Ñ‡∏ì‡∏∞: ${dept}</p><p>‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß</p>` :\n`<h2 style=\"color:red\">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h2><p>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${reqid}</p>`;\n\nreturn [{json:{decision, reqid, dept, pos, owner, html, status: decision === 'approve' ? 'approved' : 'rejected'}}];"
      },
      "id": "e7ce80ba-9890-4576-b821-523c628038c0",
      "name": "Code ‚Ä¢ Process Position Approval",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        2224
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.decision }}",
                    "rightValue": "approve",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "367cc9b0-d0ec-4ca1-b392-5e5ed50cb05c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "approve"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "163892ac-ad68-4809-b3b1-434a290bfb7e",
                    "leftValue": "={{ $json.decision }}",
                    "rightValue": "reject",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reject"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1952,
        2224
      ],
      "id": "f77b1e2b-06dd-4bf4-b6ef-fda13f28a58f",
      "name": "Switch1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "adfead1d-7caf-492f-9829-29d7599cf901",
              "leftValue": "={{ $json.meta.duplicated.toBoolean() }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1728,
        2128
      ],
      "id": "e71242cd-2561-4448-841e-47b1e2b758e6",
      "name": "If3"
    },
    {
      "parameters": {
        "fromEmail": "ai@gmail.com",
        "toEmail": "=nurfadil.yum@spumail.net",
        "subject": "=SPU AI CLUB ‚Äì ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{ $json.dept }}",
        "html": "=<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1.0\" />\n<title>‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á</title>\n<style>\n  body{margin:0;background:#f6f8fb;color:#222;font-family:'Sarabun','Segoe UI',Tahoma,Arial,sans-serif}\n  .wrap{max-width:760px;margin:32px auto;padding:0 16px}\n  .card{background:#fff;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.06);overflow:hidden}\n  .hdr{background:linear-gradient(135deg,#1a237e,#3949ab);color:#fff;padding:22px 26px}\n  .hdr h1{font-size:20px;margin:0 0 6px}\n  .hdr p{margin:0;opacity:.9}\n  .body{padding:26px}\n  .kvs{width:100%;border-collapse:separate;border-spacing:0 8px}\n  .kvs td{padding:12px 14px;background:#f8f9ff;border:1px solid #e6e9ff}\n  .kvs td.k{width:34%;color:#4650a7;font-weight:700;border-right:0;border-radius:10px 0 0 10px}\n  .kvs td.v{border-left:0;border-radius:0 10px 10px 0}\n  .badge{display:inline-block;padding:6px 12px;border-radius:999px;font-weight:700;font-size:13px}\n  .ok{background:#e8f5e9;color:#2e7d32;border:1px solid #a5d6a7}\n  .ng{background:#ffebee;color:#c62828;border:1px solid #ef9a9a}\n  .muted{color:#666;margin-top:18px;font-size:13px;line-height:1.6}\n  .cta{padding:0 26px 26px}\n  .btn{display:inline-block;text-decoration:none;color:#fff;background:linear-gradient(135deg,#1565c0,#1e88e5);padding:12px 22px;border-radius:10px;font-weight:700}\n</style>\n</head>\n<body>\n  <div class=\"wrap\">\n    <div class=\"card\">\n      <div class=\"hdr\">\n        <h1>‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á</h1>\n        <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡∏£‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£ (SPU Recruitment)</p>\n      </div>\n\n      <div class=\"body\">\n        <p>\n          ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠:\n          <span class=\"badge {{ $json.decision === 'approve' || $json.status === 'approved' ? 'ok' : 'ng' }}\">\n            {{ $json.decision === 'approve' || $json.status === 'approved' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' : '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥' }}\n          </span>\n        </p>\n\n        <table class=\"kvs\" role=\"presentation\" cellspacing=\"0\" cellpadding=\"0\">\n          <tr>\n            <td class=\"k\">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏Ç‡∏≠</td>\n            <td class=\"v\">{{ $json.reqid || '-' }}</td>\n          </tr>\n          <tr>\n            <td class=\"k\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡πÄ‡∏õ‡∏¥‡∏î</td>\n            <td class=\"v\">{{ $json.pos || '-' }}</td>\n          </tr>\n          <tr>\n            <td class=\"k\">‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</td>\n            <td class=\"v\">{{ $json.dept || '-' }}</td>\n          </tr>\n          <tr>\n            <td class=\"k\">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡πà‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠</td>\n            <td class=\"v\">{{ $json.owner || '-' }}</td>\n          </tr>\n        </table>\n\n        <p class=\"muted\">\n          ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°\n          ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•\n        </p>\n      </div>\n\n      <div class=\"cta\">\n        <!-- ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ href ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ -->\n        <a class=\"btn\" href=\"#\">‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</a>\n      </div>\n    </div>\n\n    <p class=\"muted\" style=\"text-align:center\">\n      ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏®‡∏£‡∏µ‡∏õ‡∏ó‡∏∏‡∏° | ‡∏´‡∏≤‡∏Å‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏∞‡πÄ‡∏ß‡πâ‡∏ô‡πÑ‡∏î‡πâ\n    </p>\n  </div>\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        -1504,
        2128
      ],
      "id": "bf47726a-e8c6-435e-9d1a-4dd2d02ce0b2",
      "name": "Send email4",
      "webhookId": "10f1bfd3-278b-4033-81b4-ef9a3986fe16",
      "credentials": {
        "smtp": {
          "id": "J3CgwUwFlXIpPIDC",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1056,
        2128
      ],
      "id": "3bef652e-6365-437e-b566-ebeb550567ed",
      "name": "Respond to Webhook5"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Process Position Approval ‚Üí Build SPU-styled HTML (approve/reject)\n * Robust query sourcing for n8n\n */\n\n// 1) ‡∏î‡∏∂‡∏á‡πÅ‡∏´‡∏•‡πà‡∏á query ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö (Webhook node ‚Üí item.json ‚Üí $json)\nfunction safeNode(name) { try { return $node[name]?.json || {}; } catch { return {}; } }\nconst fromWebhook = safeNode('Webhook ‚Ä¢ Approval Position GET');   // ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì\nconst q = {\n  ...(fromWebhook.query || {}),\n  ...($json.query || {}),\n  ...($input.first()?.json?.query || {}),\n  // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏ï‡∏£‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏¥‡∏•‡∏î‡πå (‡∏Å‡∏£‡∏ì‡∏µ‡∏ö‡∏≤‡∏á flow ‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ö‡∏ô)\n  ...(typeof $json.decision !== 'undefined' ? { decision: $json.decision } : {}),\n  ...(typeof $json.reqid !== 'undefined' ? { reqid: $json.reqid } : {}),\n  ...(typeof $json.dept  !== 'undefined' ? { dept : $json.dept  } : {}),\n  ...(typeof $json.pos   !== 'undefined' ? { pos  : $json.pos   } : {}),\n  ...(typeof $json.owner !== 'undefined' ? { owner: $json.owner } : {}),\n};\n\n// 2) utils\nconst esc = (v) => String(v ?? \"\")\n  .replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\")\n  .replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\");\n\n// 3) map ‡∏Ñ‡πà‡∏≤\nconst decision = String(q.decision ?? 'approve').toLowerCase();\nconst reqid    = q.reqid  ?? q.req_id ?? q.request_id ?? '';\nconst dept     = q.dept   ?? q.department ?? '';\nconst pos      = q.pos    ?? q.position   ?? '';\nconst owner    = q.owner  ?? q.email      ?? '';\n\nconst COLORS = {\n  approve:  { text: \"‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß\",  gradient: \"linear-gradient(135deg,#16a34a,#22c55e)\" },\n  reject:   { text: \"‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß\",   gradient: \"linear-gradient(135deg,#dc2626,#ef4444)\" },\n  cancel:   { text: \"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß\",   gradient: \"linear-gradient(135deg,#d97706,#f59e0b)\" },\n};\nconst meta = COLORS[decision] || COLORS.approve;\n\n// 4) HTML ‡∏ò‡∏µ‡∏° SPU\nconst html = String.raw`<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>${esc(meta.text)} - SPU</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap\" rel=\"stylesheet\">\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;\n  background:linear-gradient(135deg,#0F172A 0%,#1E293B 100%);\n  min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}\n.card{width:100%;max-width:560px;background:#fff;border:1px solid #E2E8F0;border-radius:22px;\n  box-shadow:0 20px 40px rgba(0,0,0,.35);padding:36px 32px 28px;text-align:center}\n.logo{display:flex;justify-content:center;margin-bottom:18px}\n.logo img{height:56px;width:auto}\n.badge{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border-radius:999px;\n  color:#fff;font-weight:700;margin-bottom:20px;background:${meta.gradient};box-shadow:0 4px 12px rgba(0,0,0,.2)}\n.badge svg{stroke:#fff;width:20px;height:20px}\n.table{background:#F8FAFC;border:1px solid #E2E8F0;border-radius:14px;margin:16px 0 22px}\n.tr{display:flex;justify-content:space-between;gap:12px;padding:12px 16px}\n.tr+.tr{border-top:1px dashed #E2E8F0}\n.tl{color:#334155;font-weight:600}\n.tv{color:#0F172A}\n.note{color:#64748B;font-size:14px}\n</style>\n</head>\n<body>\n  <main class=\"card\" role=\"main\">\n    <div class=\"logo\">\n      <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU Sripatum University\">\n    </div>\n\n    <div class=\"badge\">\n      <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke-width=\"2.4\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <polyline points=\"20 6 9 17 4 12\"></polyline>\n      </svg>\n      ${esc(meta.text)}\n    </div>\n\n    <section class=\"table\" aria-label=\"‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏Ç‡∏≠\">\n      <div class=\"tr\"><div class=\"tl\">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏Ç‡∏≠</div><div class=\"tv\">${esc(reqid) || '-'}</div></div>\n      <div class=\"tr\"><div class=\"tl\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div><div class=\"tv\">${esc(pos)   || '-'}</div></div>\n      <div class=\"tr\"><div class=\"tl\">‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</div><div class=\"tv\">${esc(dept)  || '-'}</div></div>\n      <div class=\"tr\"><div class=\"tl\">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</div><div class=\"tv\">${esc(owner) || '-'}</div></div>\n    </section>\n\n    <p class=\"note\">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>\n  </main>\n</body>\n</html>`;\n\n// 5) ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å\nreturn [{\n  json: {\n    decision,\n    reqid,\n    dept,\n    pos,\n    owner,\n    status: decision === 'approve' ? 'approved' :\n            decision === 'reject'  ? 'rejected' :\n            decision === 'cancel'  ? 'canceled' : decision,\n    html,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1280,
        2128
      ],
      "id": "9f58f12c-0426-4c06-8f7e-eaef568267dd",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "adfead1d-7caf-492f-9829-29d7599cf901",
              "leftValue": "={{ $json.meta.duplicated.toBoolean() }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1728,
        2320
      ],
      "id": "869ed919-3b1b-4384-8f33-c53019555b1a",
      "name": "If5"
    },
    {
      "parameters": {
        "fromEmail": "ai@gmail.com",
        "toEmail": "={{$json.candidate.email}}",
        "subject": "=SPU AI CLUB ‚Äì ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{$json.candidate.position}}",
        "html": "=<!-- REJECT EMAIL (pretty + email-safe) -->\n<table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#f5f7fb;margin:0;padding:24px;font-family:Segoe UI,Tahoma,Arial,sans-serif;\">\n  <tr>\n    <td align=\"center\">\n      <table role=\"presentation\" width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;background:#ffffff;border:1px solid #e6e9ef;border-radius:14px;overflow:hidden\">\n        <!-- Header -->\n        <tr>\n          <td align=\"center\" style=\"background:#ef4444;color:#ffffff;padding:22px 20px\">\n            <div style=\"font-size:18px;font-weight:800;letter-spacing:.3px;\">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</div>\n            <div style=\"opacity:.9;font-size:13px;margin-top:6px\">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ‚ùå</div>\n          </td>\n        </tr>\n\n        <!-- Body -->\n        <tr>\n          <td style=\"padding:24px 22px;color:#111827;\">\n            <!-- Greeting -->\n            <div style=\"font-size:18px;font-weight:700;margin-bottom:8px\">\n              ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì {{$json.candidate.name}} üëã\n            </div>\n\n            <div style=\"line-height:1.7\">\n              ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <b>{{$json.candidate.position}}</b> ‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤<br>\n              ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô AI: {{$json.candidate.score}}%)<br>\n              ‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞ üôè\n            </div>\n\n            <!-- Highlight card -->\n            <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse;margin:16px 0 4px 0\">\n              <tr>\n                <td style=\"background:#fef2f2;border:1px solid #fecaca;border-radius:12px;padding:14px 16px\">\n                  <div style=\"font-size:12px;color:#991b1b;letter-spacing:.04em;text-transform:uppercase;margin-bottom:6px\">‡∏™‡∏£‡∏∏‡∏õ</div>\n                  <div style=\"color:#991b1b\">\n                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ\n                  </div>\n                </td>\n              </tr>\n            </table>\n\n            <!-- What next -->\n            <div style=\"margin-top:14px;line-height:1.7\">\n              ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞<br>\n              ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà\n              <a href=\"mailto:aiclub@spu.ac.th\" style=\"color:#4f46e5;text-decoration:none\">aiclub@spu.ac.th</a>\n            </div>\n\n            <!-- Divider -->\n            <div style=\"border-top:1px solid #eef2f7;margin:20px 0\"></div>\n\n            <!-- Footer -->\n            <div style=\"font-size:12px;color:#6b7280;line-height:1.6\">\n              ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡πÅ‡∏•‡∏∞‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏´‡∏ô‡πâ‡∏≤<br><br>\n              ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠<br>\n              ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô HR / SPU AI CLUB\n            </div>\n          </td>\n        </tr>\n      </table>\n    </td>\n  </tr>\n</table>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        -1504,
        2320
      ],
      "id": "2908c06f-0525-460a-b02c-26c485c50647",
      "name": "Send email5",
      "webhookId": "10f1bfd3-278b-4033-81b4-ef9a3986fe16",
      "credentials": {
        "smtp": {
          "id": "J3CgwUwFlXIpPIDC",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1056,
        2320
      ],
      "id": "31aba87c-b648-4013-ac4c-1d7ec9e5889b",
      "name": "Respond to Webhook7"
    },
    {
      "parameters": {
        "jsCode": "/**\n * HR Decision: REJECT (‡∏û‡∏£‡πâ‡∏≠‡∏° Animated HTML + ‡∏≠‡∏µ‡πÄ‡∏°‡∏• HR/‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ + ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏µ‡∏ï)\n * ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå: /hr-decision?action=reject&subId=...&name=...&email=...&pos=...&score=...\n * ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å $node[\"Webhook1\"].json.query ‡πÅ‡∏•‡∏∞ $json.query\n */\n\n/* ---------- helpers ---------- */\nconst src = (() => { try { return $node[\"Webhook1\"]?.json || {}; } catch { return {}; } })();\nconst q   = src.query || $json.query || {};\n\nconst toNum = (x) => Number.isFinite(Number(x)) ? Number(x) : null;\nconst esc = (v) => String(v ?? \"\")\n  .replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\")\n  .replace(/\"/g,\"&quot;\").replace(/>/g,\"&gt;\");\n\n/* ---------- normalize ---------- */\nconst action = \"reject\"; // ‡πÇ‡∏´‡∏ô‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö reject ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞\nconst candidate = {\n  name:     (q.name ?? $json?.candidate?.name ?? \"-\").toString(),\n  email:    (q.email ?? $json?.candidate?.email ?? \"\").toString().toLowerCase(),\n  position: (q.pos ?? q.position ?? $json?.candidate?.position ?? \"-\").toString(),\n};\nconst score        = toNum(q.score ?? $json.score);\nconst submissionId = q.subId || q.subid || $json.submissionId || null;\nconst reason       = (q.reason || q.note || $json.reason || \"\").toString().trim(); // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÅ‡∏ô‡∏ö‡∏°‡∏≤\n\n/* ---------- UI meta / palette ---------- */\nconst meta = { th: \"‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß\", color: \"#ef4444\" };\nconst confettiPalette = [\"#ef4444\",\"#fecaca\",\"#f87171\",\"#dc2626\"];\n\n/* ---------- Animated HTML (center ‡∏à‡∏£‡∏¥‡∏á) ---------- */\nconst html = `<!doctype html><html lang=\"th\"><head>\n<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>${esc(meta.th)}</title>\n<style>\n:root{\n  --bg:#0b1020;--card:#111827;--line:#334155;--muted:#9ca3af;--text:#e5e7eb;\n  --accent:${esc(meta.color)};--g1:#ef444433;--g2:#f59e0b33;--g3:#a78bfa33;\n}\n*{box-sizing:border-box}html,body{height:100%}\nbody{margin:0;background:var(--bg);color:var(--text);\n     font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans Thai\",Arial;overflow:hidden}\n.stage{position:fixed;inset:0;overflow:hidden;z-index:0}\n.aurora{position:absolute;inset:-20% -20%;\n  background:\n    radial-gradient(40% 60% at 20% 10%, #ef444480 0%, transparent 60%),\n    radial-gradient(55% 65% at 80% 0%,  #7c3aed70 0%, transparent 60%),\n    radial-gradient(60% 60% at 0% 100%, #f59e0b60 0%, transparent 60%),\n    radial-gradient(55% 55% at 100% 100%, #ef444455 0%, transparent 60%);\n  filter:blur(44px) saturate(1.05);animation:drift 22s linear infinite;opacity:.9}\n@keyframes drift{0%{transform:translate3d(0,0,0) rotate(0)}\n  50%{transform:translate3d(-3%,2%,0) rotate(180deg)}\n  100%{transform:translate3d(0,0,0) rotate(360deg)}}\n.particles{position:absolute;inset:0;pointer-events:none}\n.p{position:absolute;width:6px;height:6px;border-radius:999px;background:radial-gradient(#fff,#fecaca);\n   opacity:.55;box-shadow:0 0 12px 2px rgba(248,113,113,.45);filter:blur(.2px)}\n@keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-40vh)}}\n\n.centerWrap{position:fixed;inset:0;z-index:2;display:grid;place-items:center;padding:16px}\n.card{\n  width:min(560px,92vw);\n  border-radius:18px;padding:20px 22px;\n  background:linear-gradient(var(--card),var(--card)) padding-box,\n             conic-gradient(from 120deg,var(--g1),var(--g2),var(--g3),var(--g1)) border-box;\n  border:1px solid transparent;box-shadow:0 20px 60px rgba(0,0,0,.55),inset 0 1px 0 rgba(255,255,255,.04);\n  animation:pop .6s cubic-bezier(.22,1,.36,1);\n  display:flex;flex-direction:column;align-items:center;text-align:center;\n}\n@keyframes pop{from{opacity:0;transform:translateY(12px) scale(.985)}to{opacity:1;transform:translateY(0) scale(1)}}\n.badge{display:inline-grid;place-items:center;gap:6px;grid-auto-flow:column;\n  background:var(--accent);color:#2b0a0a;padding:8px 12px;border-radius:999px;font-weight:900}\n.badge svg{color:#2b0a0a}\n.kv{margin-top:10px;line-height:1.7}\n.kv b{color:#fff}\n.muted{color:var(--muted);font-size:12px;margin-top:10px}\n.hr{height:1px;background:var(--line);margin:14px 0;border-radius:999px;opacity:.6;width:100%}\n.reason{margin-top:8px;color:#fecaca;background:#7f1d1d33;border:1px solid #7f1d1d55;border-radius:12px;padding:10px 12px}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div><div class=\"particles\" id=\"particles\"></div>\n  </div>\n  <div class=\"centerWrap\">\n    <div class=\"card\" id=\"card\">\n      <div class=\"badge\">\n        <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\" opacity=\".25\"/>\n          <path d=\"M7 12.5l3.2 3.2L17.5 8.5\" stroke=\"currentColor\" stroke-width=\"2.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n        <span>${esc(meta.th)}</span>\n      </div>\n\n      <div class=\"kv\">\n        <div><b>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> ${esc(candidate.name)}</div>\n        <div><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</b> ${esc(candidate.position)}</div>\n        <div><b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</b> ${score ?? \"-\"}${score!=null?\"%\":\"\"}</div>\n        ${candidate.email ? `<div class=\"muted\">${esc(candidate.email)}</div>` : ``}\n      </div>\n\n      ${reason ? `<div class=\"reason\"><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> ${esc(reason)}</div>` : ``}\n      <div class=\"hr\"></div>\n      <div class=\"muted\">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ</div>\n      ${submissionId ? `<div class=\"muted\">Ref: ${esc(submissionId)}</div>` : ``}\n    </div>\n  </div>\n<script>\n  const part=document.getElementById('particles'); const N=36;\n  for(let i=0;i<N;i++){const s=document.createElement('span'); s.className='p';\n    s.style.left=(Math.random()*100)+'vw'; s.style.top=(Math.random()*100)+'vh';\n    s.style.animation='floaty '+(20+Math.random()*16)+'s linear '+(-Math.random()*30)+'s infinite';\n    s.style.width=s.style.height=(Math.random()>0.6?4:6)+'px'; part.appendChild(s);}\n\n  const palette=${JSON.stringify(confettiPalette)};\n  function confetti(cx,cy){const n=24;for(let i=0;i<n;i++){const a=document.createElement('span');\n    a.style.position='fixed';a.style.left=cx+'px';a.style.top=cy+'px';\n    a.style.width=a.style.height='8px';a.style.background=palette[i%palette.length];\n    a.style.borderRadius='2px';a.style.pointerEvents='none';a.style.zIndex=9999;\n    const dx=(Math.random()-.5)*2,dy=(Math.random()-.8)*2.6,rot=Math.random()*720;\n    a.animate([{transform:'translate(0,0) rotate(0)',opacity:1},\n      {transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],\n      {duration:650+Math.random()*250,easing:'cubic-bezier(.22,1,.36,1)'}); setTimeout(()=>a.remove(),900);\n    document.body.appendChild(a);} }\n  window.addEventListener('load',()=>confetti(innerWidth/2,innerHeight/2));\n</script>\n</body></html>`;\n\n/* ---------- HR email (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß) ---------- */\nconst hr_subject = `‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô HR ‚Äì ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò: ${candidate.name} (${candidate.position})`;\nconst hr_html = `\n  <div style=\"font-family:Segoe UI,Tahoma,Arial;color:#111;background:#fff\">\n    <div style=\"max-width:680px;margin:auto;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden\">\n      <div style=\"padding:14px 18px;background:#111827;color:#fff\">\n        <div style=\"font-weight:800\">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô HR ‚Äì ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</div>\n        <div style=\"color:#9ca3af;font-size:12px\">Submission: ${esc(submissionId || \"-\")}</div>\n      </div>\n      <div style=\"padding:18px\">\n        <p style=\"margin:.3em 0\"><b>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> ${esc(candidate.name)} &lt;${esc(candidate.email)}&gt;</p>\n        <p style=\"margin:.3em 0\"><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</b> ${esc(candidate.position)}</p>\n        <p style=\"margin:.3em 0\"><b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</b> ${score ?? \"-\"}${score!=null?\"%\":\"\"}</p>\n        ${reason ? `<p style=\"margin:.6em 0\"><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> ${esc(reason)}</p>` : \"\"}\n        <div style=\"margin-top:12px;padding:10px 12px;border-radius:10px;background:#fee2e2;color:#991b1b;border:1px solid #fecaca;width:max-content;font-weight:700\">REJECTED</div>\n      </div>\n    </div>\n  </div>\n`;\n\n/* ---------- Candidate email (‡πÇ‡∏ó‡∏ô‡∏™‡∏∏‡∏†‡∏≤‡∏û) ---------- */\nconst cand_subject = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‚Äì ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ`;\nconst cand_html = `\n  <div style=\"font-family:Segoe UI,Tahoma,Arial;color:#111;background:#fff\">\n    <div style=\"max-width:680px;margin:auto;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden\">\n      <div style=\"padding:16px 18px;background:#ef4444;color:#fff\">\n        <div style=\"font-weight:900\">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>\n        <div style=\"opacity:.9;font-size:12px\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ${esc(candidate.position)}</div>\n      </div>\n      <div style=\"padding:18px\">\n        <p>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì ${esc(candidate.name)},</p>\n        <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</strong>‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö</p>\n        ${reason ? `<p><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</b> ${esc(reason)}</p>` : \"\"}\n        <p>‡πÄ‡∏£‡∏≤‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ ‡πÅ‡∏•‡∏∞‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</p>\n        <p style=\"color:#64748b;font-size:12px\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏µ‡πâ</p>\n      </div>\n    </div>\n  </div>\n`;\n\n/* ---------- return (‡πÉ‡∏´‡πâ node ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ä‡πâ) ---------- */\nreturn [{\n  json: {\n    // core data\n    action: \"reject\",\n    status: \"rejected\",\n    hr_decision: \"reject\",\n    hr_decided_at: new Date().toISOString(),\n    candidate,\n    score,\n    submissionId,\n    reason,\n\n    // emails\n    hr_subject,  hr_html,\n    cand_subject, cand_html,\n\n    // thank-you/summary page\n    html,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1280,
        2320
      ],
      "id": "614bbebf-7c30-455b-be37-c5f082bc2770",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=",
        "options": {
          "responseCode": 302,
          "responseHeaders": {
            "entries": [
              {
                "name": "=Location",
                "value": "={{ $json.location }}"
              },
              {
                "name": "Set-Cookie",
                "value": "={{ $json.setCookie }}; Path=/; HttpOnly; Secure; SameSite=Lax; Max-Age=28800"
              }
            ]
          }
        }
      },
      "id": "942a4904-5235-4a88-8acd-8d7a9aa80b7e",
      "name": "Respond ‚Ä¢ Portal Home2",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1056,
        -624
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "auth/login",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "1d7a9adb-fa10-454d-8d4c-92312f895b88",
      "name": "Webhook Check Password",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        -720
      ],
      "webhookId": "spu-portal-home"
    },
    {
      "parameters": {
        "jsCode": "const COOKIE_NAME = '';\nconst cookie = `${COOKIE_NAME}=; HttpOnly; Secure; Path=/; Max-Age=0; SameSite=Lax`;\nreturn [{ json: { cookie, location: '/webhook/login' } }];\n"
      },
      "id": "67a68e40-3d88-48e1-a764-7e012769baa6",
      "name": "Code ‚Ä¢ Generate Portal Home3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        16
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseCode": 302,
          "responseHeaders": {
            "entries": [
              {
                "name": "Location",
                "value": "{{$json.location}}"
              },
              {
                "name": "Set-Cookie",
                "value": "={{$json.cookie}}"
              }
            ]
          }
        }
      },
      "id": "59a386a2-09b8-4ad2-a83b-33e5a8f65407",
      "name": "Respond ‚Ä¢ Portal Home3",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1952,
        16
      ]
    },
    {
      "parameters": {
        "path": "logout",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "417a1c10-78c7-448f-a438-97d6994a758a",
      "name": "Webhook Logout",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        16
      ],
      "webhookId": "spu-portal-home"
    },
    {
      "parameters": {
        "path": "auth/login",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "2f269982-b775-46fa-a8eb-d66c5d52b8b0",
      "name": "Webhook ‚Ä¢ Login GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        -1264
      ],
      "webhookId": "spu-modern-login"
    },
    {
      "parameters": {
        "jsCode": "// Get error/message from query string\nconst err = ($json.query?.err || '').trim();\nconst msg = ($json.query?.msg || '').trim();\n\nconst errHtml = err ? `<div style=\"background:#FEE;border:1px solid #FCC;color:#C33;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px\">${decodeURIComponent(err)}</div>` : '';\nconst msgHtml = msg ? `<div style=\"background:#EFE;border:1px solid #CFC;color:#3C3;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px\">${decodeURIComponent(msg)}</div>` : '';\n\nconst html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö - SPU Recruitment</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap\" rel=\"stylesheet\">\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{font-family:Sarabun,sans-serif;background:linear-gradient(135deg,#0F1535,#1a2347);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}\n.container{max-width:440px;width:100%;background:#fff;border-radius:20px;padding:48px 40px;box-shadow:0 20px 80px rgba(0,0,0,.3);animation:slideUp .5s ease}\n@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}\n.logo{text-align:center;margin-bottom:32px}\n.logo img{height:80px;margin-bottom:16px;background:#fff;padding:8px;border-radius:12px}\n.logo h1{font-size:28px;color:#0F1535;margin-bottom:8px}\n.logo p{color:#666;font-size:14px}\n.form-group{margin-bottom:20px}\nlabel{display:block;margin-bottom:8px;font-size:14px;font-weight:600;color:#333}\ninput{width:100%;padding:14px 16px;border:2px solid #E0E0E0;border-radius:12px;font-size:15px;font-family:inherit;transition:all .2s}\ninput:focus{outline:none;border-color:#E5007D;box-shadow:0 0 0 3px rgba(229,0,125,.1)}\n.btn{width:100%;padding:16px;background:linear-gradient(135deg,#E5007D,#C4006B);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;box-shadow:0 4px 16px rgba(229,0,125,.3);margin-top:8px}\n.btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(229,0,125,.4)}\n.footer{text-align:center;margin-top:24px;font-size:14px;color:#666}\n.footer a{color:#E5007D;text-decoration:none;font-weight:600}\n</style>\n</head>\n<body>\n<div class=\"container\">\n  <div class=\"logo\">\n    <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU\">\n    <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>\n    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡∏£‡∏´‡∏≤‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</p>\n  </div>\n  ${errHtml}\n  ${msgHtml}\n  <form method=\"POST\" action=\"/webhook/auth/login\">\n    <div class=\"form-group\">\n      <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå</label>\n      <input type=\"email\" name=\"email\" placeholder=\"your@spu.ac.th\" required autofocus>\n    </div>\n    <div class=\"form-group\">\n      <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>\n      <input type=\"password\" name=\"password\" placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\" required>\n    </div>\n    <button type=\"submit\" class=\"btn\">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‚Üí</button>\n  </form>\n  <div class=\"footer\">\n    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href=\"/webhook/auth/register\">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>\n  </div>\n</div>\n</body>\n</html>`;\n\nreturn [{ json: { html } }];"
      },
      "id": "1731eecd-5545-41ed-b42c-236c05a25a84",
      "name": "Code ‚Ä¢ Generate Modern Login",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1968,
        -1264
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "77d7f3e3-e96a-44d1-922b-8d145b911a7c",
      "name": "Respond ‚Ä¢ Login",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1744,
        -1264
      ]
    },
    {
      "parameters": {
        "jsCode": "// Get error/message from query string\nconst err = ($json.query?.err || '').trim();\nconst msg = ($json.query?.msg || '').trim();\n\nconst errHtml = err ? `<div style=\"background:#FEE;border:1px solid #FCC;color:#C33;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px\">${decodeURIComponent(err)}</div>` : '';\nconst msgHtml = msg ? `<div style=\"background:#EFE;border:1px solid #CFC;color:#3C3;padding:12px;border-radius:8px;margin-bottom:16px;font-size:14px\">${decodeURIComponent(msg)}</div>` : '';\n\nconst html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å - SPU Recruitment</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap\" rel=\"stylesheet\">\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{font-family:Sarabun,sans-serif;background:linear-gradient(135deg,#0F1535,#1a2347);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}\n.container{max-width:500px;width:100%;background:#fff;border-radius:20px;padding:48px 40px;box-shadow:0 20px 80px rgba(0,0,0,.3);animation:slideUp .5s ease}\n@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}\n.logo{text-align:center;margin-bottom:32px}\n.logo img{height:80px;margin-bottom:16px;background:#fff;padding:8px;border-radius:12px}\n.logo h1{font-size:28px;color:#0F1535;margin-bottom:8px}\n.logo p{color:#666;font-size:14px}\n.form-group{margin-bottom:20px}\nlabel{display:block;margin-bottom:8px;font-size:14px;font-weight:600;color:#333}\nlabel span{color:#E5007D}\ninput,select{width:100%;padding:14px 16px;border:2px solid #E0E0E0;border-radius:12px;font-size:15px;font-family:inherit;transition:all .2s}\ninput:focus,select:focus{outline:none;border-color:#E5007D;box-shadow:0 0 0 3px rgba(229,0,125,.1)}\n.btn{width:100%;padding:16px;background:linear-gradient(135deg,#E5007D,#C4006B);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;box-shadow:0 4px 16px rgba(229,0,125,.3);margin-top:8px}\n.btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(229,0,125,.4)}\n.footer{text-align:center;margin-top:24px;font-size:14px;color:#666}\n.footer a{color:#E5007D;text-decoration:none;font-weight:600}\n.hint{font-size:12px;color:#666;margin-top:4px}\n</style>\n</head>\n<body>\n<div class=\"container\">\n  <div class=\"logo\">\n    <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU\">\n    <h1>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>\n    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡∏£‡∏´‡∏≤‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</p>\n  </div>\n  ${errHtml}\n  ${msgHtml}\n  <form method=\"POST\" action=\"/webhook/auth/register\" onsubmit=\"return validateForm()\">\n    <div class=\"form-group\">\n      <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span>*</span></label>\n      <input type=\"text\" name=\"name\" id=\"name\" placeholder=\"‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ\" required>\n    </div>\n    <div class=\"form-group\">\n      <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå <span>*</span></label>\n      <input type=\"email\" name=\"email\" id=\"email\" placeholder=\"your@spu.ac.th\" required>\n      <div class=\"hint\">‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå @spu.ac.th ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>\n    </div>\n    <div class=\"form-group\">\n      <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏Ñ‡∏ì‡∏∞ <span>*</span></label>\n      <select name=\"department\" required>\n        <option value=\"\">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>\n        <option value=\"‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•\">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>\n        <option value=\"‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå\">‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>\n        <option value=\"‡∏Ñ‡∏ì‡∏∞‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à\">‡∏Ñ‡∏ì‡∏∞‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</option>\n        <option value=\"‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå\">‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>\n        <option value=\"‡∏Ñ‡∏ì‡∏∞‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏≠‡∏≤‡∏£‡πå‡∏ï\">‡∏Ñ‡∏ì‡∏∞‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏≠‡∏≤‡∏£‡πå‡∏ï</option>\n        <option value=\"‡∏Ñ‡∏ì‡∏∞‡∏®‡∏¥‡∏•‡∏õ‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå\">‡∏Ñ‡∏ì‡∏∞‡∏®‡∏¥‡∏•‡∏õ‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>\n        <option value=\"‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå\">‡∏Ñ‡∏ì‡∏∞‡∏ô‡∏¥‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>\n        <option value=\"‡∏≠‡∏∑‡πà‡∏ô‡πÜ\">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>\n      </select>\n    </div>\n    <div class=\"form-group\">\n      <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>\n      <input type=\"tel\" name=\"phone\" placeholder=\"08X-XXX-XXXX\">\n    </div>\n    <div class=\"form-group\">\n      <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span>*</span></label>\n      <input type=\"password\" name=\"password\" id=\"password\" placeholder=\"‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£\" required minlength=\"8\">\n      <div class=\"hint\">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>\n    </div>\n    <div class=\"form-group\">\n      <label>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô <span>*</span></label>\n      <input type=\"password\" name=\"confirm_password\" id=\"confirm_password\" placeholder=\"‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\" required minlength=\"8\">\n    </div>\n    <button type=\"submit\" class=\"btn\">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚Üí</button>\n  </form>\n  <div class=\"footer\">\n    ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href=\"/webhook/auth/login\">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>\n  </div>\n</div>\n<script>\nfunction validateForm() {\n  const email = document.getElementById('email').value;\n  const password = document.getElementById('password').value;\n  const confirmPassword = document.getElementById('confirm_password').value;\n  \n  // Check email domain\n  if (!email.endsWith('@spu.ac.th')) {\n    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå @spu.ac.th ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');\n    return false;\n  }\n  \n  // Check password match\n  if (password !== confirmPassword) {\n    alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');\n    return false;\n  }\n  \n  return true;\n}\n</script>\n</body>\n</html>`;\n\nreturn [{ json: { html } }];"
      },
      "id": "7f736711-391d-40ea-8e72-ea23c038b034",
      "name": "Code ‚Ä¢ Generate Modern Register",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        -1040
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "da14a22a-211e-4af6-b103-93e0fc3afb94",
      "name": "Respond ‚Ä¢ Register",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1952,
        -1040
      ]
    },
    {
      "parameters": {
        "path": "auth/register",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "bbfc2d92-b449-4624-822b-807bad0823ae",
      "name": "Webhook ‚Ä¢ Register GET1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        -1040
      ],
      "webhookId": "spu-modern-register"
    },
    {
      "parameters": {
        "path": "auth/logout",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "bb751206-1583-49fa-8568-28e85edec4d3",
      "name": "Webhook ‚Ä¢ Logout",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        752
      ],
      "webhookId": "0def6345-bd50-48e9-9c7f-5cb61e407b4c"
    },
    {
      "parameters": {
        "jsCode": "// Code ‚Ä¢ Logout Page (JavaScript)\nconst html = String.raw`<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö - SPU</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap\" rel=\"stylesheet\">\n<style>\n* { margin:0; padding:0; box-sizing:border-box; }\nbody{\n  font-family:'Inter', sans-serif;\n  background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);\n  min-height:100vh; display:flex; align-items:center; justify-content:center;\n}\n\n/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≤‡∏ß‡∏´‡∏•‡∏±‡∏Å ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß‡∏£‡∏≠‡∏ö‡∏ô‡∏≠‡∏Å */\n.container{\n  width: 100%;\n  max-width: 460px;\n  background: #FFFFFF;\n  color: #0F172A;\n  border-radius: 22px;\n  box-shadow: 0 20px 40px rgba(2, 6, 23, 0.35);\n  padding: 36px 32px 28px;\n  border: 1px solid #E2E8F0;\n  animation: fadeIn .5s ease;\n}\n@keyframes fadeIn { from{opacity:0; transform: translateY(12px);} to{opacity:1; transform:none;} }\n\n/* ‡πÇ‡∏•‡πÇ‡∏Å‡πâ */\n.logo{\n  display:flex; align-items:center; justify-content:center;\n  margin-bottom: 10px;\n}\n.logo img{\n  height: 56px; width: auto;\n}\n\n/* ‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢ */\n.title{\n  font-size: 26px; font-weight: 700; text-align:center; margin-top: 6px;\n}\n.subtitle{\n  text-align:center; color:#64748B; margin-top: 6px; margin-bottom: 22px;\n}\n\n/* ‡∏õ‡∏∏‡πà‡∏° */\n.btn{\n  display:inline-block; width:100%;\n  padding: 14px 18px; border-radius: 14px;\n  background: linear-gradient(135deg, #E5007D, #C4006B);\n  color:#fff; text-decoration:none; font-weight:700; letter-spacing:.2px;\n  text-align:center; transition: all .2s ease;\n  box-shadow: 0 6px 18px rgba(229,0,125,.35);\n}\n.btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 26px rgba(229,0,125,.45); }\n.btn:active{ transform: translateY(0); box-shadow: 0 3px 10px rgba(229,0,125,.25); }\n\n/* icon */\n.iconBadge{\n  height:64px; width:64px; margin: 0 auto 10px;\n  display:flex; align-items:center; justify-content:center; border-radius:50%;\n  background: linear-gradient(135deg, #E5007D, #C4006B);\n  box-shadow: 0 4px 14px rgba(229,0,125,.35);\n}\n.iconBadge svg{ width:34px; height:34px; stroke:#fff; stroke-width:2; fill:none; }\n\n/* timer */\n.countdown{ margin-top: 14px; font-size: 13px; color:#64748B; text-align:center; }\n</style>\n</head>\n<body>\n\n  <main class=\"container\" role=\"main\" aria-labelledby=\"logout-title\">\n    <div class=\"logo\">\n      <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU Sripatum University\">\n    </div>\n\n    <div class=\"iconBadge\" aria-hidden=\"true\">\n      <svg viewBox=\"0 0 24 24\">\n        <path d=\"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\"></path>\n        <polyline points=\"16 17 21 12 16 7\"></polyline>\n        <line x1=\"21\" y1=\"12\" x2=\"9\" y2=\"12\"></line>\n      </svg>\n    </div>\n\n    <h1 id=\"logout-title\" class=\"title\">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h1>\n    <p class=\"subtitle\">‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ¬∑ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ SPU Recruitment</p>\n\n    <a class=\"btn\" href=\"/webhook/auth/login\">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</a>\n    <p class=\"countdown\">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô <span id=\"timer\">3</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ...</p>\n  </main>\n\n<script>\n  let count = 3;\n  const timer = document.getElementById('timer');\n  const itv = setInterval(() => {\n    count--;\n    timer.textContent = count;\n    if (count <= 0) {\n      clearInterval(itv);\n      window.location.href = '/webhook/auth/login';\n    }\n  }, 1000);\n</script>\n</body>\n</html>`;\n\nreturn [{\n  json: {\n    html,\n    responseHeaders: {\n      'Content-Type': 'text/html; charset=utf-8',\n      'Set-Cookie': 'spu_auth=; Path=/; Max-Age=0; HttpOnly; Secure; SameSite=Strict',\n      'Cache-Control': 'no-store'\n    }\n  }\n}];\n"
      },
      "id": "7f346e79-177b-49d3-8a3c-9c5590f57606",
      "name": "Code ‚Ä¢ Logout Page",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        656
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              },
              {
                "name": "Set-Cookie",
                "value": "spu_auth=; Path=/; Max-Age=0; HttpOnly; Secure; SameSite=Strict"
              }
            ]
          }
        }
      },
      "id": "f6160e5d-32c8-4078-b0ab-80b46834ef8f",
      "name": "Respond ‚Ä¢ Logout",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        656
      ]
    },
    {
      "parameters": {
        "path": "auth/forgot",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "7f442522-5266-4b9e-9007-7751255408bc",
      "name": "Webhook ‚Ä¢ Forgot Password GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        1904
      ],
      "webhookId": "47fe8228-a45a-4ad5-b3e9-86260291cee9"
    },
    {
      "parameters": {
        "jsCode": "const msg = ($json.query || {}).msg || '';\n\nconst html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô - SPU</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n<style>\n:root {\n  --bg: #0F172A;\n  --card: #1E293B;\n  --text: #F1F5F9;\n  --muted: #94A3B8;\n  --accent: #E5007D;\n  --border: #334155;\n}\n* { margin: 0; padding: 0; box-sizing: border-box; }\nbody {\n  font-family: 'Inter', sans-serif;\n  background: var(--bg);\n  color: var(--text);\n  min-height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n}\n.card {\n  background: var(--card);\n  border: 1px solid var(--border);\n  border-radius: 20px;\n  padding: 40px;\n  max-width: 440px;\n  width: 100%;\n  box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n  animation: slideUp 0.5s ease;\n}\n@keyframes slideUp {\n  from { opacity: 0; transform: translateY(30px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n.icon-wrap {\n  width: 64px;\n  height: 64px;\n  background: linear-gradient(135deg, rgba(229,0,125,0.2), rgba(229,0,125,0.1));\n  border-radius: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 auto 24px;\n}\n.icon-wrap svg {\n  width: 32px;\n  height: 32px;\n  stroke: var(--accent);\n  stroke-width: 2;\n  fill: none;\n}\nh1 {\n  text-align: center;\n  font-size: 26px;\n  margin-bottom: 8px;\n  font-weight: 600;\n}\n.subtitle {\n  text-align: center;\n  color: var(--muted);\n  margin-bottom: 32px;\n  line-height: 1.5;\n  font-size: 14px;\n}\n.success-msg {\n  background: rgba(16,185,129,0.1);\n  border: 1px solid rgba(16,185,129,0.3);\n  color: #6EE7B7;\n  padding: 12px 14px;\n  border-radius: 10px;\n  margin-bottom: 20px;\n  font-size: 13px;\n  display: ${msg ? 'flex' : 'none'};\n  align-items: center;\n  gap: 8px;\n}\nlabel {\n  display: block;\n  margin-bottom: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  color: var(--muted);\n}\ninput {\n  width: 100%;\n  padding: 12px 14px;\n  background: var(--bg);\n  border: 1px solid var(--border);\n  border-radius: 10px;\n  color: var(--text);\n  font-size: 14px;\n  margin-bottom: 20px;\n  transition: all 0.2s;\n}\ninput:focus {\n  outline: none;\n  border-color: var(--accent);\n  box-shadow: 0 0 0 3px rgba(229,0,125,0.1);\n}\n.btn {\n  width: 100%;\n  padding: 13px;\n  background: linear-gradient(135deg, var(--accent), #C4006B);\n  color: white;\n  border: none;\n  border-radius: 10px;\n  font-size: 15px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.3s;\n  box-shadow: 0 4px 16px rgba(229,0,125,0.3);\n}\n.btn:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 24px rgba(229,0,125,0.4);\n}\n.btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n  transform: none;\n}\n.back {\n  text-align: center;\n  margin-top: 24px;\n  font-size: 14px;\n}\n.back a {\n  color: var(--accent);\n  text-decoration: none;\n  font-weight: 600;\n}\n.back a:hover {\n  text-decoration: underline;\n}\n</style>\n</head>\n<body>\n<div class=\"card\">\n  <div class=\"icon-wrap\">\n    <svg viewBox=\"0 0 24 24\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\n      <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"></line>\n      <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"></line>\n    </svg>\n  </div>\n  \n  <h1>‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</h1>\n  <p class=\"subtitle\">‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡πâ</p>\n  \n  ${msg ? `<div class=\"success-msg\">\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n      <path fill-rule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\"/>\n    </svg>\n    ${decodeURIComponent(msg)}\n  </div>` : ''}\n  \n  <form id=\"forgotForm\" method=\"POST\" action=\"/webhook/auth/forgot-password\">\n    <label for=\"email\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå</label>\n    <input \n      type=\"email\" \n      id=\"email\" \n      name=\"email\" \n      placeholder=\"your@spu.ac.th\"\n      required\n      autofocus\n    >\n    \n    <button type=\"submit\" class=\"btn\" id=\"submitBtn\">\n      ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô\n    </button>\n  </form>\n  \n  <div class=\"back\">\n    <a href=\"/webhook/auth/login\">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>\n  </div>\n</div>\n\n<script>\ndocument.getElementById('forgotForm').addEventListener('submit', () => {\n  const btn = document.getElementById('submitBtn');\n  btn.disabled = true;\n  btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';\n});\n</script>\n</body>\n</html>`;\n\nreturn [{ json: { html } }];"
      },
      "id": "8d3762a7-96a1-40b0-a1a4-59a8d37f45f3",
      "name": "Code ‚Ä¢ Forgot Password Page",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        1904
      ]
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "id": "c8586fdd-6b1e-4037-acc2-1c7582fd0d0b",
      "name": "Respond ‚Ä¢ Forgot Password",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1952,
        1904
      ]
    },
    {
      "parameters": {
        "path": "portal",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "5bfd2b97-6f55-4c68-b79d-bd821763fa07",
      "name": "Webhook ‚Ä¢ Portal GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        -304
      ],
      "webhookId": "2082812f-aa58-417f-8010-02fb48d5d22c"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.body}}",
        "options": {
          "responseCode": "={{ $json.status || 200 }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "={{$json.headers[\"Content-Type\"] || 'text/html; charset=utf-8'}}"
              }
            ]
          }
        }
      },
      "id": "2e1565a4-86f4-4dec-8061-01b9c6547e19",
      "name": "Respond ‚Ä¢ Portal",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1280,
        -400
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "users",
        "limit": 1,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "email",
              "condition": "eq",
              "keyValue": "={{ $json.email }}"
            },
            {
              "keyName": "status",
              "condition": "eq",
              "keyValue": "active"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1952,
        -720
      ],
      "id": "a21f3cd6-ba0c-439d-a42a-e71b60a9995f",
      "name": "Supabase (Get User)",
      "retryOnFail": false,
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "xsmYJyRh8PQZ60Ge",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "auth/register",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "fb8f35c4-4114-4eb5-81db-8c97ec8f0e0d",
      "name": "Register POST",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2400,
        1168
      ],
      "webhookId": "0def6345-bd50-48e9-9c7f-5cb61e407b4c"
    },
    {
      "parameters": {
        "jsCode": "// Extract form data\nconst name = ($json.body?.name || '').trim();\nconst email = ($json.body?.email || '').toLowerCase().trim();\nconst department = ($json.body?.department || '').trim();\nconst phone = ($json.body?.phone || '').trim();\nconst password = $json.body?.password || '';\nconst confirmPassword = $json.body?.confirm_password || '';\n\n// Validation\nconst errors = [];\n\nif (!name || name.length < 3) {\n  errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');\n}\n\nif (!email || !email.includes('@')) {\n  errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');\n}\n\nif (!email.endsWith('@spu.ac.th')) {\n  errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå @spu.ac.th ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');\n}\n\nif (!department) {\n  errors.push('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô');\n}\n\nif (!password || password.length < 8) {\n  errors.push('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');\n}\n\nif (password !== confirmPassword) {\n  errors.push('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');\n}\n\n// If has errors, redirect back\nif (errors.length > 0) {\n  return [{ json: {\n    status: 302,\n    headers: { \n      'Location': '/webhook/auth/register?err=' + encodeURIComponent(errors.join(', '))\n    }\n  }}];\n}\n\n// Pass validated data to next node\nreturn [{ json: {\n  name,\n  email,\n  department,\n  phone,\n  password\n}}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        1168
      ],
      "id": "3e47f7df-591f-48de-94a3-4a814e3171f3",
      "name": "Code (Validate)"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "users",
        "limit": 1,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "email",
              "condition": "eq",
              "keyValue": "={{ $json.email }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1952,
        1168
      ],
      "id": "6903d0e5-24e2-4935-a042-37c60f5d3c38",
      "name": "Supabase (Check Email)",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "xsmYJyRh8PQZ60Ge",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ----- Import crypto -----\nconst crypto = require('crypto');\n\n// ----- Get validated form data -----\nconst v = $node['Code (Validate)'].json;\n\n// ----- Read result from Supabase (Check Email) -----\n// ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Always Output Data ‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏´‡∏ô‡∏î‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏°‡∏µ 1 item ‡πÄ‡∏™‡∏°‡∏≠\nconst supaItems = $items('Supabase (Check Email)');\nconst existing = (supaItems.length > 0 && supaItems[0]?.json?.email) ? supaItems[0].json : null;\n\n// ‡∏ñ‡πâ‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß -> ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÉ‡∏´‡πâ‡πÑ‡∏õ Respond 302\nif (existing && existing.email) {\n  return [{\n    json: {\n      _redirect: true,\n      location: '/webhook/auth/register?err=' + encodeURIComponent('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß')\n    }\n  }];\n}\n\n// ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥ -> ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ hash ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏ô‡∏î Supabase (Create User)\nconst salt = crypto.randomBytes(16).toString('hex');\nconst iter = 121149;\nconst hash = crypto.pbkdf2Sync(v.password, salt, iter, 32, 'sha256').toString('hex');\n\nreturn [{\n  json: {\n    email: v.email,\n    name: v.name,\n    department: v.department,\n    phone: v.phone || null,\n    pwd_salt: salt,\n    pwd_iter: iter,\n    pwd_hash: hash,\n    status: 'active',\n    _redirect: false\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        1168
      ],
      "id": "5b370e8e-77f5-47fc-98f5-3b9d77981096",
      "name": "Code (Check & Hash)",
      "retryOnFail": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "tableId": "users",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "email",
              "fieldValue": "={{ $json.email }}"
            },
            {
              "fieldId": "name",
              "fieldValue": "={{ $json.name }}"
            },
            {
              "fieldId": "role",
              "fieldValue": "={{ $json.role }}"
            },
            {
              "fieldId": "department",
              "fieldValue": "={{ $json.department }}"
            },
            {
              "fieldId": "phone",
              "fieldValue": "={{ $json.phone }}"
            },
            {
              "fieldId": "pwd_salt",
              "fieldValue": "={{ $json.pwd_salt }}"
            },
            {
              "fieldId": "pwd_iter",
              "fieldValue": "={{ $json.pwd_iter }}"
            },
            {
              "fieldId": "pwd_hash",
              "fieldValue": "={{ $json.pwd_hash }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "={{ $json.status }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1280,
        1264
      ],
      "id": "b4abbc2b-ed87-4839-a12e-24bf7e2c2356",
      "name": "Supabase (Create User)",
      "credentials": {
        "supabaseApi": {
          "id": "xsmYJyRh8PQZ60Ge",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Check if user created successfully\nconst newUser = $input.first().json;\n\nif (newUser && newUser.id) {\n  return [{ json: {\n    status: 302,\n    headers: { \n      'Location': '/webhook/auth/login?msg=' + encodeURIComponent('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö')\n    }\n  }}];\n} else {\n  return [{ json: {\n    status: 302,\n    headers: { \n      'Location': '/webhook/auth/register?err=' + encodeURIComponent('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á')\n    }\n  }}];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1056,
        1264
      ],
      "id": "7013988a-f441-46ce-b9c9-ebe7c54f858b",
      "name": "Code (Success Redirect)"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=",
        "options": {
          "responseCode": "={{ $json.status }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "=Location",
                "value": "={{ $json.headers.Location }}"
              }
            ]
          }
        }
      },
      "id": "ff66683e-9567-45c2-b483-fafefe6053ab",
      "name": "regis res",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -832,
        1264
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d1742183-e605-4375-ae5e-c9978f7716d8",
              "leftValue": "={{ $json._redirect }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1504,
        1168
      ],
      "id": "6241d804-2baf-4ff1-af26-c2b9f3f0d1fe",
      "name": "If"
    },
    {
      "parameters": {
        "respondWith": "text",
        "options": {
          "responseCode": 302,
          "responseHeaders": {
            "entries": [
              {
                "name": "Location",
                "value": "={{$json.location}}"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1280,
        1072
      ],
      "id": "7a14ccf9-fbec-469b-a0ba-d1363d196056",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "users",
        "filters": {
          "conditions": [
            {
              "keyName": "email",
              "keyValue": "={{ $json.userFromToken.sub }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1728,
        -400
      ],
      "id": "ecb9c046-9f95-4883-aba4-b8e9ae059355",
      "name": "Supabase ‚Ä¢ Get User",
      "credentials": {
        "supabaseApi": {
          "id": "xsmYJyRh8PQZ60Ge",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ---------- Safe getters for nodes/items ----------\nconst safeNodeJson = (name) => {\n  try {\n    const j = $node[name]?.json;\n    return (j && typeof j === 'object') ? j : null;\n  } catch { return null; }\n};\n\nconst safeItems = (name) => {\n  try {\n    const arr = $items(name);\n    return Array.isArray(arr) ? arr.map(i => i?.json ?? {}) : [];\n  } catch { return []; }\n};\n\n// ---------- Pull data (with graceful fallbacks) ----------\nconst fromProfile = safeNodeJson('Supabase ‚Ä¢ Get Profile');\nconst fromUser    = safeNodeJson('Supabase ‚Ä¢ Get User');\n\n// ‡∏ñ‡πâ‡∏≤ Code ‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á Supabase ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏ö‡∏≤‡∏á‡∏ó‡∏µ $json ‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß\nconst candidateJson = (Object.keys($json || {}).length ? $json : null);\n\nconst profile = fromProfile || fromUser || candidateJson || {};\n\nconst apps = safeItems('Supabase ‚Ä¢ My Applications'); // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏´‡∏ô‡∏î‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÑ‡∏î‡πâ []\n\n// ---------- Helpers ----------\nconst esc = (s) => String(s ?? '')\n  .replace(/&/g,'&amp;').replace(/</g,'&lt;')\n  .replace(/>/g,'&gt;').replace(/\"/g,'&quot;')\n  .replace(/'/g,'&#39;');\n\nconst thDateTime = (v) => {\n  try {\n    const d = new Date(v);\n    if (Number.isNaN(+d)) return '-';\n    return d.toLocaleString('th-TH', {\n      year: 'numeric', month: 'short', day: '2-digit',\n      hour: '2-digit', minute: '2-digit'\n    });\n  } catch { return '-'; }\n};\n\n// ---------- Derived fields (safe) ----------\nconst user = {\n  id:         profile.id        ?? '',\n  email:      profile.email     ?? '',\n  name:       profile.name      ?? profile.full_name ?? profile.email ?? '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ',\n  department: profile.department ?? profile.dept ?? '-',\n  role:       String(profile.role ?? '').toLowerCase(),\n};\nconst firstName = (user.name || '').split(' ')[0] || user.name;\n\nconst isHR   = ['hr','human_resource','human-resources','staff','committee'].includes(user.role);\nconst isExec = ['exec','executive','director','dean','ceo','president'].includes(user.role);\n\n// ---------- Applications table rows ----------\nconst rows = (apps && apps.length ? apps : []).map(a => `\n  <tr>\n    <td>${esc(a.position_name ?? a.position_id ?? '-')}</td>\n    <td>${esc(a.status ?? '-')}</td>\n    <td>${esc(thDateTime(a.created_at))}</td>\n  </tr>\n`).join('');\n\nconst myAppsBlock = (apps && apps.length)\n  ? `\n  <div class=\"box\" style=\"grid-column:1/-1\">\n    <div class=\"ico\">\n      <svg viewBox=\"0 0 24 24\"><path d=\"M3 4h18v16H3z\"/><path d=\"M8 8h8M8 12h8M8 16h5\"/></svg>\n    </div>\n    <h3>‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>\n    <p class=\"desc\">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>\n    <div style=\"overflow:auto;border:1px solid #e5e7eb;border-radius:12px\">\n      <table style=\"width:100%;border-collapse:collapse;font-size:14px\">\n        <thead>\n          <tr style=\"background:#fafafa\">\n            <th style=\"text-align:left;padding:12px 14px;border-bottom:1px solid #eee\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>\n            <th style=\"text-align:left;padding:12px 14px;border-bottom:1px solid #eee\">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>\n            <th style=\"text-align:left;padding:12px 14px;border-bottom:1px solid #eee\">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>\n          </tr>\n        </thead>\n        <tbody>${rows || `<tr><td colspan=\"3\" style=\"padding:14px;color:#6b7280\">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td></tr>`}</tbody>\n      </table>\n    </div>\n  </div>`\n  : '';\n\n// ---------- HTML ----------\nconst html = `<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>Portal - SPU Recruitment</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap\" rel=\"stylesheet\">\n<style>\n*{margin:0;padding:0;box-sizing:border-box}\nbody{font-family:'Sarabun',sans-serif;background:#f8f9fa;color:#1a1a1a;min-height:100vh}\n.navbar{background:white;border-bottom:1px solid #e5e7eb;padding:18px 0;box-shadow:0 2px 8px rgba(0,0,0,.04);position:sticky;top:0;z-index:100;backdrop-filter:blur(10px)}\n.nav-wrap{max-width:1200px;margin:0 auto;padding:0 24px;display:flex;justify-content:space-between;align-items:center}\n.logo-area{display:flex;align-items:center;gap:14px}\n.logo-area img{height:50px}\n.logo-txt h1{font-size:18px;font-weight:700;color:#E91E8C;margin-bottom:2px}\n.logo-txt p{font-size:11px;color:#6b7280;font-weight:500;letter-spacing:.3px}\n.user-bar{display:flex;align-items:center;gap:20px}\n.user-detail{text-align:right}\n.user-detail .uname{font-size:14px;font-weight:600;color:#1a1a1a}\n.user-detail .udept{font-size:12px;color:#6b7280}\n.btn-out{padding:10px 18px;background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:10px;color:#dc2626;text-decoration:none;font-size:13px;font-weight:600;transition:all .2s}\n.btn-out:hover{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.3);transform:translateY(-1px)}\n.main{max-width:1200px;margin:0 auto;padding:48px 24px}\n.head{margin-bottom:48px;animation:fadeIn .6s ease}\n@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}\n.head h2{font-size:34px;margin-bottom:10px;font-weight:700;color:#1a1a1a}\n.head p{color:#6b7280;font-size:16px;font-weight:400}\n.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:26px;animation:fadeIn .8s ease .2s both}\n.box{background:white;border:1px solid #e5e7eb;border-radius:18px;padding:30px;transition:all .3s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden}\n.box::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,#E91E8C,#C4006B);transform:scaleX(0);transform-origin:left;transition:transform .3s cubic-bezier(.4,0,.2,1)}\n.box:hover{transform:translateY(-6px);box-shadow:0 16px 48px rgba(0,0,0,.1);border-color:#E91E8C}\n.box:hover::before{transform:scaleX(1)}\n.ico{width:58px;height:58px;background:linear-gradient(135deg,rgba(233,30,140,.12),rgba(233,30,140,.06));border-radius:15px;display:flex;align-items:center;justify-content:center;margin-bottom:22px}\n.ico svg{width:28px;height:28px;stroke:#E91E8C;stroke-width:2.2;fill:none}\n.box h3{font-size:21px;margin-bottom:12px;font-weight:700;color:#1a1a1a}\n.box .desc{color:#6b7280;font-size:14px;line-height:1.7;margin-bottom:24px}\n.box-btn{display:inline-flex;align-items:center;gap:8px;padding:12px 20px;background:linear-gradient(135deg,#E91E8C,#C4006B);color:white;text-decoration:none;border-radius:11px;font-size:14px;font-weight:700;transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:0 5px 15px rgba(233,30,140,.3)}\n.box-btn:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(233,30,140,.4)}\n.box-btn svg{width:17px;height:17px}\n@media(max-width:768px){.cards{grid-template-columns:1fr}.user-detail{display:none}.head h2{font-size:28px}}\n</style>\n</head>\n<body>\n<nav class=\"navbar\">\n  <div class=\"nav-wrap\">\n    <div class=\"logo-area\">\n      <img src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU\">\n      <div class=\"logo-txt\">\n        <h1>SPU Recruitment</h1>\n        <p>‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏®‡∏£‡∏µ‡∏õ‡∏ó‡∏∏‡∏°</p>\n      </div>\n    </div>\n    <div class=\"user-bar\">\n      <div class=\"user-detail\">\n        <div class=\"uname\">${esc(user.name)}</div>\n        <div class=\"udept\">${esc(user.department)}</div>\n      </div>\n      <a href=\"/webhook/auth/logout\" class=\"btn-out\">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>\n    </div>\n  </div>\n</nav>\n\n<div class=\"main\">\n  <div class=\"head\">\n    <h2>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${esc(firstName)} üëã</h2>\n    <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠</p>\n  </div>\n\n  <div class=\"cards\">\n    <div class=\"box\">\n      <div class=\"ico\">\n        <svg viewBox=\"0 0 24 24\">\n          <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n          <polyline points=\"14 2 14 8 20 8\"></polyline>\n          <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\n          <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\n        </svg>\n      </div>\n      <h3>‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤</h3>\n      <p class=\"desc\">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏î‡πÅ‡∏ó‡∏ô</p>\n      <a href=\"/webhook/intake/request-position\" class=\"box-btn\">\n        ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"><polyline points=\"9 18 15 12 9 6\"/></svg>\n      </a>\n    </div>\n\n    ${isHR ? `\n    <div class=\"box\">\n      <div class=\"ico\">\n        <svg viewBox=\"0 0 24 24\">\n          <polyline points=\"9 11 12 14 22 4\"></polyline>\n          <path d=\"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11\"></path>\n        </svg>\n      </div>\n      <h3>Shortlist / ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h3>\n      <p class=\"desc\">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ shortlist ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HR</p>\n      <a href=\"/webhook/department/shortlist\" class=\"box-btn\">\n        ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"><polyline points=\"9 18 15 12 9 6\"/></svg>\n      </a>\n    </div>` : ''}\n\n    ${isExec ? `\n    <div class=\"box\">\n      <div class=\"ico\">\n        <svg viewBox=\"0 0 24 24\">\n          <path d=\"M22 11.08V12a10 10 0 1 1-5.93-9.14\"></path>\n          <polyline points=\"22 4 12 14.01 9 11.01\"></polyline>\n        </svg>\n      </div>\n      <h3>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</h3>\n      <p class=\"desc\">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>\n      <a href=\"/webhook/portal/result\" class=\"box-btn\">\n        ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"><polyline points=\"9 18 15 12 9 6\"/></svg>\n      </a>\n    </div>` : ''}\n\n    ${myAppsBlock}\n  </div>\n</div>\n</body>\n</html>`;\n\n// ---------- Return for Respond node ----------\nreturn [{\n  json: {\n    status: 200,\n    headers: { 'Content-Type': 'text/html; charset=utf-8' },\n    body: html,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1504,
        -400
      ],
      "id": "5d6c2060-3b09-4c57-af56-4aea46930645",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fe452183-0ec2-4435-9419-a086a0e57ac8",
              "leftValue": "={{ $json.auth }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1952,
        -304
      ],
      "id": "01273ba0-b022-4da4-9a3d-29b07a3df2c8",
      "name": "If1"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.body}}",
        "options": {
          "responseCode": "={{ $json.status || 200 }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "={{$json.headers[\"Content-Type\"] || 'text/html; charset=utf-8'}}"
              },
              {
                "name": "Location",
                "value": "={{$json.headers?.Location}}"
              }
            ]
          }
        }
      },
      "id": "a2c8187a-c401-47be-8bdf-d64fbd61e474",
      "name": "Respond ‚Ä¢ Portal1",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        -208
      ]
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    status: 302,\n    headers: { Location: '/webhook/auth/login?msg=' + encodeURIComponent('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö') },\n    body: ''\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        -208
      ],
      "id": "0ca7b20f-dc80-4b5d-9590-1f0c25229afb",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "jsCode": "const COOKIE_NAME = 'spu_token'; // ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á cookie ‡∏ï‡∏≠‡∏ô‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô\nconst raw = ($json.headers?.cookie || $json.headers?.Cookie || '');\nconst hasToken = raw.split(';').some(c => c.trim().startsWith(COOKIE_NAME + '='));\nreturn [{ json: { authenticated: hasToken } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        752
      ],
      "id": "fdea68a7-efb8-4704-8cff-6f7e29c03848",
      "name": "Code in JavaScript10"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fe452183-0ec2-4435-9419-a086a0e57ac8",
              "leftValue": "={{$json.authenticated}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1952,
        752
      ],
      "id": "d3732c07-730c-4a20-afa5-4430a3561be7",
      "name": "If6"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    status: 302,\n    headers: { Location: '/webhook/auth/login?msg=' + encodeURIComponent('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö') },\n    body: ''\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        848
      ],
      "id": "0adcf2e0-06e2-41a0-9274-7a2f79512de7",
      "name": "Code in JavaScript11"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.body}}",
        "options": {
          "responseCode": "={{ $json.status || 200 }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "={{$json.headers[\"Content-Type\"] || 'text/html; charset=utf-8'}}"
              },
              {
                "name": "Location",
                "value": "={{$json.headers?.Location}}"
              }
            ]
          }
        }
      },
      "id": "0e9288c7-81b5-4684-b6d4-10672e5259f1",
      "name": "Respond ‚Ä¢ Portal4",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        848
      ]
    },
    {
      "parameters": {
        "jsCode": "// ===== CODE IN JAVASCRIPT4 - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT =====\n\nconst COOKIE_NAME = 'spu_token';\nconst JWT_SECRET = 'SPU-PORTAL-2025-SECRET-KEY-v1';\n\nconsole.log('üîç === AUTHENTICATION CHECK ===');\n\n// ===== HELPER FUNCTIONS =====\nfunction b64UrlToStr(b64Url='') {\n  const b64 = b64Url.replace(/-/g,'+').replace(/_/g,'/');\n  return Buffer.from(b64, 'base64').toString('utf8');\n}\n\nfunction parseJwt(token) {\n  const parts = token.split('.');\n  if (parts.length !== 3) throw new Error('Invalid JWT format');\n  return { payload: JSON.parse(b64UrlToStr(parts[1])) };\n}\n\nfunction verifySignature(token, secret) {\n  const [headerB64, payloadB64, signatureB64] = token.split('.');\n  const crypto = require('crypto');\n  \n  // ‚úÖ ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ - ‡πÉ‡∏ä‡πâ () ‡πÅ‡∏ó‡∏ô backtick\n  const expectedSig = crypto\n    .createHmac('sha256', secret)\n    .update(`${headerB64}.${payloadB64}`)\n    .digest('base64url');\n  \n  const isValid = signatureB64 === expectedSig;\n  console.log('üîí Signature match:', isValid);\n  \n  return isValid;\n}\n\n// ===== PARSE COOKIES =====\nconst cookieHeader = $json.headers?.cookie || '';\nconsole.log('üç™ Cookie header present:', !!cookieHeader);\n\nif (!cookieHeader) {\n  console.log('‚ùå No cookie header');\n  return { auth: false, reason: 'NO_TOKEN', showLoginPage: true };\n}\n\n// Parse cookies carefully\nconst cookies = {};\ncookieHeader.split(';').forEach(c => {\n  const trimmed = c.trim();\n  const firstEqualIndex = trimmed.indexOf('=');\n  \n  if (firstEqualIndex > 0) {\n    const key = trimmed.substring(0, firstEqualIndex);\n    const value = trimmed.substring(firstEqualIndex + 1);\n    cookies[key] = value;\n  }\n});\n\nconsole.log('üîç Found cookies:', Object.keys(cookies));\n\nlet token = cookies[COOKIE_NAME];\n\n// Handle duplicate cookie name\nif (token && token.startsWith('spu_token=')) {\n  console.log('‚ö†Ô∏è Fixing duplicate cookie name');\n  token = token.substring('spu_token='.length);\n}\n\nif (!token) {\n  console.log('‚ùå Token not found');\n  console.log('Available cookies:', Object.keys(cookies).join(', '));\n  return { auth: false, reason: 'NO_TOKEN', showLoginPage: true };\n}\n\nconsole.log('‚úÖ Token found');\nconsole.log('Token preview:', token.substring(0, 30) + '...');\n\n// ===== VERIFY JWT =====\ntry {\n  // Check token format\n  if (token.split('.').length !== 3) {\n    console.log('‚ùå Invalid token format');\n    return { auth: false, reason: 'INVALID_FORMAT', showLoginPage: true };\n  }\n\n  // Verify signature\n  if (!verifySignature(token, JWT_SECRET)) {\n    console.log('‚ùå Invalid signature');\n    return { auth: false, reason: 'INVALID_SIGNATURE', showLoginPage: true };\n  }\n\n  // Parse payload\n  const { payload } = parseJwt(token);\n  console.log('üì¶ Payload:', JSON.stringify(payload, null, 2));\n  \n  // Check expiration\n  if (payload.exp && payload.exp < Math.floor(Date.now() / 1000)) {\n    console.log('‚ùå Token expired');\n    return { auth: false, reason: 'TOKEN_EXPIRED', showLoginPage: true };\n  }\n\n  // ‚úÖ SUCCESS!\n  console.log('‚úÖ‚úÖ‚úÖ Authentication successful!');\n  console.log('User:', payload.sub);\n  \n  return {\n    auth: true,\n    showLoginPage: false,\n    userFromToken: {\n      sub: payload.sub,\n      id: payload.id,\n      email: payload.email || payload.sub,\n      name: payload.name || 'User',\n      role: payload.role || 'user',\n      dept: payload.dept || null\n    }\n  };\n\n} catch (error) {\n  console.error('‚ùå Error:', error.message);\n  console.error('Stack:', error.stack);\n  return { auth: false, reason: 'INVALID_TOKEN', showLoginPage: true };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        -304
      ],
      "id": "f2b9e11d-a073-44cd-9ef1-448a6728999b",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "jsCode": "// ===== CODE ‚Ä¢ VALIDATE INPUT - Fixed =====\n\n// ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å webhook body\nconst body = $json.body || {};\nconst email = (body.email || '').toLowerCase().trim();\nconst password = body.password || '';\n\nconsole.log('üì• Received login request');\nconsole.log('Email:', email || '(empty)');\nconsole.log('Password:', password ? '***' : '(empty)');\n\n// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email\nif (!email || !email.includes('@')) {\n  console.log('‚ùå Invalid email format');\n  return {\n    status: 302,\n    headers: { \n      'Location': '/webhook/auth/login?err=' + encodeURIComponent('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á') \n    }\n  };\n}\n\n// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö password\nif (!password) {\n  console.log('‚ùå No password provided');\n  return {\n    status: 302,\n    headers: { \n      'Location': '/webhook/auth/login?err=' + encodeURIComponent('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô') \n    }\n  };\n}\n\n// ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\nconsole.log('‚úÖ Input validation passed');\n\nreturn {\n  email: email,\n  password: password\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        -720
      ],
      "id": "6b7253ba-0b12-432b-b146-ad19d107cb9f",
      "name": "Code ‚Ä¢ Validate Input"
    },
    {
      "parameters": {
        "jsCode": "// ===== COMPLETE PASSWORD VERIFICATION + JWT =====\n\nconst crypto = require('crypto');\nconst JWT_SECRET = 'SPU-PORTAL-2025-SECRET-KEY-v1';\n\nconsole.log('üîê === PASSWORD VERIFICATION START ===');\n\n// 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user ‡∏à‡∏≤‡∏Å Supabase node\nconst user = $json;\n\n// 2. ‡∏î‡∏∂‡∏á input password ‡∏à‡∏≤‡∏Å webhook POST\nconst webhookData = $('Webhook Check Password').first().json.body || {};\nconst inputPassword = webhookData.password || '';\n\nconsole.log('User email:', user.email);\nconsole.log('Has stored hash:', !!user.pwd_hash);\nconsole.log('Input password provided:', !!inputPassword);\n\n// 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ user data ‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏°\nif (!user || !user.email || !user.pwd_hash || !user.pwd_salt) {\n  console.log('‚ùå User data incomplete');\n  return [{\n    json: {\n      status: 302,\n      location: '/webhook/auth/login?err=' + encodeURIComponent('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ')\n    }\n  }];\n}\n\n// 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ input password ‡πÑ‡∏´‡∏°\nif (!inputPassword) {\n  console.log('‚ùå No password provided');\n  return [{\n    json: {\n      status: 302,\n      location: '/webhook/auth/login?err=' + encodeURIComponent('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô')\n    }\n  }];\n}\n\n// 5. Hash password ‡∏ó‡∏µ‡πà user ‡∏õ‡πâ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤\nconst iterations = Number(user.pwd_iter) || 121149;\nconst calculatedHash = crypto\n  .pbkdf2Sync(inputPassword, user.pwd_salt, iterations, 32, 'sha256')\n  .toString('hex');\n\nconsole.log('Stored hash:', user.pwd_hash.substring(0, 20) + '...');\nconsole.log('Calculated hash:', calculatedHash.substring(0, 20) + '...');\n\n// 6. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö password\nif (calculatedHash !== user.pwd_hash) {\n  console.log('‚ùå Password mismatch!');\n  return [{\n    json: {\n      status: 302,\n      location: '/webhook/auth/login?err=' + encodeURIComponent('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á')\n    }\n  }];\n}\n\nconsole.log('‚úÖ Password correct!');\n\n// 7. ‡∏™‡∏£‡πâ‡∏≤‡∏á JWT Token\nfunction base64url(input) {\n  return Buffer.from(JSON.stringify(input))\n    .toString('base64')\n    .replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\nconst header = { alg: 'HS256', typ: 'JWT' };\nconst payload = {\n  sub: user.email,\n  id: user.id,\n  email: user.email,\n  name: user.name,\n  role: user.role,\n  dept: user.department || user.dept,\n  iat: Math.floor(Date.now() / 1000),\n  exp: Math.floor(Date.now() / 1000) + 28800  // 8 hours\n};\n\nconst headerB64 = base64url(header);\nconst payloadB64 = base64url(payload);\nconst signature = crypto\n  .createHmac('sha256', JWT_SECRET)\n  .update(`${headerB64}.${payloadB64}`)\n  .digest('base64url');\n\nconst jwtToken = `${headerB64}.${payloadB64}.${signature}`;\n\nconsole.log('‚úÖ JWT created:', jwtToken.substring(0, 50) + '...');\n\n// 8. Return ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n// ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: setCookie ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô full cookie string!\nreturn [{\n  json: {\n    status: 302,\n    setCookie: `spu_token=${jwtToken}`,  // ‚úÖ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!\n    location: '/webhook/portal'\n  }\n}];"
      },
      "id": "65dbcc4b-d154-4edc-b1a2-496de7f06bc2",
      "name": "Code password1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1504,
        -720
      ]
    },
    {
      "parameters": {
        "jsCode": "// Code ‚Ä¢ Normalize User (‡∏´‡∏•‡∏±‡∏á Supabase)\nconst row = $input.first()?.json;\nif (!row || Object.keys(row).length === 0) {\n  return [{ json: {} }];   // ‡πÉ‡∏´‡πâ‡∏°‡∏µ item ‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏™‡∏°‡∏≠\n}\nreturn [{ json: row }];\n"
      },
      "id": "ee9ab9d7-467c-4b57-a7bc-5b8a02d8d054",
      "name": "Code ‚Ä¢ Normalize User1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        -720
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0643687b-9e34-4a78-bd4b-290913f55d71",
              "leftValue": "={{ $json.status }}",
              "rightValue": 302,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            },
            {
              "id": "32eb515b-a092-4ce9-8906-918cd060e777",
              "leftValue": "={{ $json.location }}",
              "rightValue": "err",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1280,
        -720
      ],
      "id": "53076304-0e33-4c70-a948-c1b4a94ec221",
      "name": "IF Error"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=",
        "options": {
          "responseCode": 302,
          "responseHeaders": {
            "entries": [
              {
                "name": "=Location",
                "value": "={{ $json.location }}"
              }
            ]
          }
        }
      },
      "id": "78927c71-7141-4ade-83e6-4642dfeb9cb9",
      "name": "Respond ‚Ä¢ Error Redirect",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1056,
        -816
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fe452183-0ec2-4435-9419-a086a0e57ac8",
              "leftValue": "={{ $json.auth }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1952,
        336
      ],
      "id": "859d0b84-aa29-4dcc-a87c-6148739438cc",
      "name": "If2"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.body}}",
        "options": {
          "responseCode": "={{ $json.status || 200 }}",
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "={{$json.headers[\"Content-Type\"] || 'text/html; charset=utf-8'}}"
              },
              {
                "name": "Location",
                "value": "={{$json.headers?.Location}}"
              }
            ]
          }
        }
      },
      "id": "057513b6-537c-4ca8-9cf8-3a71d98c3f98",
      "name": "Respond ‚Ä¢ Portal2",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        -1504,
        432
      ]
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    status: 302,\n    headers: { Location: '/webhook/auth/login?msg=' + encodeURIComponent('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö') },\n    body: ''\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1728,
        432
      ],
      "id": "732a990a-8e1f-46cf-868f-04ba61f8d33a",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "// ===== CODE IN JAVASCRIPT4 - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT =====\n\nconst COOKIE_NAME = 'spu_token';\nconst JWT_SECRET = 'SPU-PORTAL-2025-SECRET-KEY-v1';\n\nconsole.log('üîç === AUTHENTICATION CHECK ===');\n\n// ===== HELPER FUNCTIONS =====\nfunction b64UrlToStr(b64Url='') {\n  const b64 = b64Url.replace(/-/g,'+').replace(/_/g,'/');\n  return Buffer.from(b64, 'base64').toString('utf8');\n}\n\nfunction parseJwt(token) {\n  const parts = token.split('.');\n  if (parts.length !== 3) throw new Error('Invalid JWT format');\n  return { payload: JSON.parse(b64UrlToStr(parts[1])) };\n}\n\nfunction verifySignature(token, secret) {\n  const [headerB64, payloadB64, signatureB64] = token.split('.');\n  const crypto = require('crypto');\n  \n  // ‚úÖ ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ - ‡πÉ‡∏ä‡πâ () ‡πÅ‡∏ó‡∏ô backtick\n  const expectedSig = crypto\n    .createHmac('sha256', secret)\n    .update(`${headerB64}.${payloadB64}`)\n    .digest('base64url');\n  \n  const isValid = signatureB64 === expectedSig;\n  console.log('üîí Signature match:', isValid);\n  \n  return isValid;\n}\n\n// ===== PARSE COOKIES =====\nconst cookieHeader = $json.headers?.cookie || '';\nconsole.log('üç™ Cookie header present:', !!cookieHeader);\n\nif (!cookieHeader) {\n  console.log('‚ùå No cookie header');\n  return { auth: false, reason: 'NO_TOKEN', showLoginPage: true };\n}\n\n// Parse cookies carefully\nconst cookies = {};\ncookieHeader.split(';').forEach(c => {\n  const trimmed = c.trim();\n  const firstEqualIndex = trimmed.indexOf('=');\n  \n  if (firstEqualIndex > 0) {\n    const key = trimmed.substring(0, firstEqualIndex);\n    const value = trimmed.substring(firstEqualIndex + 1);\n    cookies[key] = value;\n  }\n});\n\nconsole.log('üîç Found cookies:', Object.keys(cookies));\n\nlet token = cookies[COOKIE_NAME];\n\n// Handle duplicate cookie name\nif (token && token.startsWith('spu_token=')) {\n  console.log('‚ö†Ô∏è Fixing duplicate cookie name');\n  token = token.substring('spu_token='.length);\n}\n\nif (!token) {\n  console.log('‚ùå Token not found');\n  console.log('Available cookies:', Object.keys(cookies).join(', '));\n  return { auth: false, reason: 'NO_TOKEN', showLoginPage: true };\n}\n\nconsole.log('‚úÖ Token found');\nconsole.log('Token preview:', token.substring(0, 30) + '...');\n\n// ===== VERIFY JWT =====\ntry {\n  // Check token format\n  if (token.split('.').length !== 3) {\n    console.log('‚ùå Invalid token format');\n    return { auth: false, reason: 'INVALID_FORMAT', showLoginPage: true };\n  }\n\n  // Verify signature\n  if (!verifySignature(token, JWT_SECRET)) {\n    console.log('‚ùå Invalid signature');\n    return { auth: false, reason: 'INVALID_SIGNATURE', showLoginPage: true };\n  }\n\n  // Parse payload\n  const { payload } = parseJwt(token);\n  console.log('üì¶ Payload:', JSON.stringify(payload, null, 2));\n  \n  // Check expiration\n  if (payload.exp && payload.exp < Math.floor(Date.now() / 1000)) {\n    console.log('‚ùå Token expired');\n    return { auth: false, reason: 'TOKEN_EXPIRED', showLoginPage: true };\n  }\n\n  // ‚úÖ SUCCESS!\n  console.log('‚úÖ‚úÖ‚úÖ Authentication successful!');\n  console.log('User:', payload.sub);\n  \n  return {\n    auth: true,\n    showLoginPage: false,\n    userFromToken: {\n      sub: payload.sub,\n      id: payload.id,\n      email: payload.email || payload.sub,\n      name: payload.name || 'User',\n      role: payload.role || 'user',\n      dept: payload.dept || null\n    }\n  };\n\n} catch (error) {\n  console.error('‚ùå Error:', error.message);\n  console.error('Stack:', error.stack);\n  return { auth: false, reason: 'INVALID_TOKEN', showLoginPage: true };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        336
      ],
      "id": "2c9b81ee-86f0-44ef-b31f-8f757442ee3a",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1d095099-558e-45dc-aa43-b953dea1b823",
              "name": "WEBHOOK_URL",
              "value": "https://n8nkrub.n8n.cloud/webhook/hr-decision",
              "type": "string"
            },
            {
              "id": "45f37c96-71cf-40a7-9bff-71fa8c287627",
              "name": "HR_EMAIL",
              "value": "hrspuaiclub@gmail.com",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -336,
        3424
      ],
      "id": "3101113b-4af3-4398-93a7-13c660b6b5bb",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "Upload File to PDF.co",
        "binaryData": true,
        "binaryPropertyName": "={{ $binary.resume ? 'resume' : ($binary.resume0 ? 'resume0' : Object.keys($binary || {})[0]) }}",
        "name": "={{ $binary.resume?.fileName || $binary.resume0?.fileName || 'resume.pdf' }}"
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        -1728,
        3424
      ],
      "id": "ef2b4fa5-d75e-48c2-90b0-57f8c18c1c60",
      "name": "Upload PDF1",
      "credentials": {
        "pdfcoApi": {
          "id": "KWvDmUHAn5gozrFp",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "operation": "Convert from PDF",
        "url": "={{ $json.url }}",
        "advancedOptions": {}
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        -1504,
        3424
      ],
      "id": "603ccc0c-7e81-4e48-8950-420ba95accf8",
      "name": "Convert/Extract from PDF1",
      "credentials": {
        "pdfcoApi": {
          "id": "KWvDmUHAn5gozrFp",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2ed52c71-1f98-4b33-afd3-e5f371d89715",
              "name": "pdfText",
              "value": "={{ \n  (\n    $json.body || $json.text || $node[\"Convert/Extract from PDF1\"].json.body || \"\"\n  )\n  .replace(/\\r/g,\"\")\n  .replace(/[ \\t]+\\n/g,\"\\n\")\n  .trim()\n  .slice(0,5000)     // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô\n}}",
              "type": "string"
            },
            {
              "id": "8b7e5410-0816-48fd-a2e7-11d72217d7d7",
              "name": "name",
              "value": "={{ $('If4').item.json.name }}",
              "type": "string"
            },
            {
              "id": "f80aa6cd-0101-4f3f-8c67-fbc6e33908ca",
              "name": "email",
              "value": "={{ $('If4').item.json.email }}",
              "type": "string"
            },
            {
              "id": "7b6dda29-e99f-4d07-9dfb-08ae55625db9",
              "name": "position",
              "value": "={{ $('If4').item.json.position }}",
              "type": "string"
            },
            {
              "id": "157201ca-53ab-4156-95b0-08c4d949b356",
              "name": "department",
              "value": "={{ $('If4').item.json.department }}",
              "type": "string"
            },
            {
              "id": "6c3071db-8d82-45f4-bbc3-2e45afad4ca8",
              "name": "years_exp",
              "value": "={{ $('If4').item.json.years_exp }}",
              "type": "number"
            },
            {
              "id": "27260fc4-cfe2-4321-b615-fc0c9a91c416",
              "name": "education",
              "value": "={{ $('If4').item.json.education }}",
              "type": "string"
            },
            {
              "id": "ab59644b-8e17-4d57-a356-a883bca389fe",
              "name": "skill",
              "value": "={{ $('If4').item.json.skills }}",
              "type": "string"
            },
            {
              "id": "fe900f48-b635-4b7f-8164-e8a7476f1b6b",
              "name": "motivation",
              "value": "={{ $('If4').item.json.motivation }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1280,
        3424
      ],
      "id": "a46dd1ae-f523-4f2b-b11f-c256f33d10b7",
      "name": "Prepare Text from PDF1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=‡∏á‡∏≤‡∏ô: ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{ $node[\"Prepare Text from PDF1\"].json.position }}\n‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (threshold): 70\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (metadata):\n- ‡∏ä‡∏∑‡πà‡∏≠: {{ $node[\"Prepare Text from PDF1\"].json.name }}\n- ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: {{ $node[\"Prepare Text from PDF1\"].json.email }}\n- ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå (‡∏õ‡∏µ): {{ $node[\"Prepare Text from PDF1\"].json.years_exp }}\n- ‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î/‡∏Ñ‡∏ì‡∏∞: {{ $json.department }}\n- ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤: {{ $node[\"Prepare Text from PDF1\"].json.education }}\n- ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤: {{ $json.motivation }}\n- ‡∏™‡∏Å‡∏¥‡∏•: {{ $json.skill }}\n\n‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤/‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å PDF; ‡∏≠‡∏≤‡∏à‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ):\n{{ $json.pdfText }}\n\n‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô\n1) ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 0‚Äì100 ‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ñ‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ô‡∏µ‡πâ (‡∏£‡∏ß‡∏° 100):\n   - Technical depth & relevance: 40\n   - Experience & impact (‡∏Ç‡∏ô‡∏≤‡∏î‡∏á‡∏≤‡∏ô ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç/‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î): 25\n   - Problem solving & architecture thinking: 15\n   - Communication & documentation: 10\n   - Culture/ownership & collaboration: 10\n   ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ‡∏≠‡∏¥‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô pdfText + metadata; ‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ö‡∏ö conservative ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠\n2) ‡∏™‡∏£‡∏∏‡∏õ verdict:\n   - \"pass\" ‡∏ñ‡πâ‡∏≤ score ‚â• threshold\n   - \"fail\" ‡∏ñ‡πâ‡∏≤ score < threshold\n3) reasons: 1‚Äì5 ‡∏Ç‡πâ‡∏≠ ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÉ‡∏ô‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà/metadata ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)\n4) ‡∏™‡∏£‡πâ‡∏≤‡∏á \"questions\" ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‚Äòexactly 7‚Äô ‡∏Ç‡πâ‡∏≠ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:\n   - technical, experience, problem_solving, communication, culture\n   ‡πÇ‡∏î‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ ‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (technical/experience) ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ ‚â•2 ‡∏Ç‡πâ‡∏≠\n   ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏:\n   - question: ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥/‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏≤‡∏á‡∏ñ‡∏∂‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\n   - expected: ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á (‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å/‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô)\n   - signal: ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå (red/green flags)\n   ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡πÑ‡∏°‡πà‡∏¢‡∏∑‡∏î‡πÄ‡∏¢‡∏∑‡πâ‡∏≠\n\n‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç\n- ‡∏≠‡∏¥‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏î‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç/‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï\n- ‡∏ñ‡πâ‡∏≤ pdfText ‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏Å‡∏±‡∏î ‡πÉ‡∏´‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î\n- ‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏û‡∏∏‡∏ï‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏≠‡∏∑‡πà‡∏ô‡∏õ‡∏∞‡∏õ‡∏ô:\n\n‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤‡πÄ‡∏≠‡∏≤‡∏ï‡πå‡∏û‡∏∏‡∏ï (JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô):\n{\n  \"score_percent\": <number 0-100>,\n  \"verdict\": \"pass\" | \"fail\",\n  \"reasons\": [ \"<string>\", ... ],   // 1-5 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n  \"questions\": [\n    {\n      \"topic\": \"technical\" | \"experience\" | \"problem_solving\" | \"communication\" | \"culture\",\n      \"question\": \"<string>\",\n      \"expected\": \"<string>\",\n      \"signal\": \"<string>\"\n    }\n    // ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏ß‡∏° 7 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏≠‡∏î‡∏µ\n  ]\n}\n\n‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (‡πÇ‡∏Ñ‡∏£‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á):\n{\n  \"score_percent\": 78,\n  \"verdict\": \"pass\",\n  \"reasons\": [\"‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡πÅ‡∏ï‡πá‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á\", \"‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô\"],\n  \"questions\": [\n    {\"topic\":\"technical\",\"question\":\"...\", \"expected\":\"...\", \"signal\":\"...\"},\n    {\"topic\":\"technical\",\"question\":\"...\", \"expected\":\"...\", \"signal\":\"...\"},\n    {\"topic\":\"experience\",\"question\":\"...\", \"expected\":\"...\", \"signal\":\"...\"},\n    {\"topic\":\"experience\",\"question\":\"...\", \"expected\":\"...\", \"signal\":\"...\"},\n    {\"topic\":\"problem_solving\",\"question\":\"...\", \"expected\":\"...\", \"signal\":\"...\"},\n    {\"topic\":\"communication\",\"question\":\"...\", \"expected\":\"...\", \"signal\":\"...\"},\n    {\"topic\":\"culture\",\"question\":\"...\", \"expected\":\"...\", \"signal\":\"...\"}\n  ]\n}\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ HR\n‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á ‚Äú‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå 7 ‡∏Ç‡πâ‡∏≠‚Äù\n\n‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å):\n1) ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô ‚ÄúJSON ‡πÄ‡∏û‡∏µ‡∏¢‡∏ß ‡πÜ‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\n   - ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ Markdown / ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ / ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ü‡∏ô‡∏ã‡πå / ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏î‡∏Å‡πà‡∏≠‡∏ô-‡∏´‡∏•‡∏±‡∏á JSON\n   - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ UTF-8, ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå, ‡πÑ‡∏°‡πà‡∏°‡∏µ comma ‡πÄ‡∏Å‡∏¥‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏ñ‡∏ß\n2) ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‚Äù ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ô‡∏µ‡πâ:\n   - score_percent: number ‡∏ä‡πà‡∏ß‡∏á 0..100 (‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå %)\n   - verdict: string ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô \"pass\" ‡∏´‡∏£‡∏∑‡∏≠ \"fail\" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\n   - reasons: string[] ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 1..5 (‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà \"\" ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß ‡πÄ‡∏ä‡πà‡∏ô [\"\"])\n   - questions: array ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß ‚Äú7 ‡∏û‡∏≠‡∏î‡∏µ‚Äù ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏õ‡πá‡∏ô object ‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ:\n       {\n         \"question\": string,\n         \"topic\": \"technical\" | \"experience\" | \"problem_solving\" | \"communication\" | \"culture\",\n         \"expected\": string,\n         \"signal\": string\n       }\n   - ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏î\n3) ‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡∏£‡∏¥‡∏á‡∏ß‡πà‡∏≤‡∏á \"\" (‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà null/undefined)\n4) ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏õ‡∏ô)\n5) ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡πÉ‡∏´‡πâ‡∏¢‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏ô‡∏à‡∏ö‡πÉ‡∏ô 1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô\n\n‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∂‡∏î‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ):\n{\n  \"score_percent\": <number 0..100>,\n  \"verdict\": \"pass\" | \"fail\",\n  \"reasons\": [\"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\", \"... (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5)\"],\n  \"questions\": [\n    { \"question\": \"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\", \"topic\": \"technical|experience|problem_solving|communication|culture\", \"expected\": \"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\", \"signal\": \"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" }\n  ]\n}\n\n‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î:\n- ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô \"\" ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (reasons 1..5, questions = 7)\n- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô ‚Äú‡πÇ‡∏Ñ‡∏£‡∏á JSON ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‚Äù ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á \"\" ‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢\n- ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏≤‡∏Å JSON\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1024,
        3424
      ],
      "id": "7a8bbef7-089d-431f-b41d-295435a4a1b7",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1056,
        3648
      ],
      "id": "898f59cf-aadc-447c-8ab0-3a3b1858ee53",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "Kcq9aT8se4vz7gtG",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏à‡∏≤‡∏Å AI Agent (‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô Structured Output Parser ‡πÅ‡∏•‡πâ‡∏ß)\nconst data = $json;\n\n// ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 7 ‡∏Ç‡πâ‡∏≠ ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ LLM ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô\nconst qs = Array.isArray(data.questions) ? data.questions.slice(0,7) : [];\n\n// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô HTML\nconst rows = qs.map((q, i) => `\n  <tr>\n    <td style=\"padding:8px 12px;vertical-align:top;width:32px\">${i+1}.</td>\n    <td style=\"padding:8px 12px\">\n      <div style=\"font-weight:600\">${q.question || '-'}</div>\n      <div style=\"font-size:12px;opacity:.8;margin-top:4px\">\n        ‡∏´‡∏°‡∏ß‡∏î: ${q.category || '-'} ‚Ä¢ ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${q.difficulty || '-'}\n      </div>\n      ${q.rationale ? `<div style=\"font-size:12px;margin-top:6px\">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${q.rationale}</div>` : ''}\n    </td>\n  </tr>\n`).join('');\n\n// ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö HTML ‡∏ó‡∏±‡πâ‡∏á‡∏â‡∏ö‡∏±‡∏ö (‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ + ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°)\nconst html = `\n<div style=\"font-family:Segoe UI,Tahoma,Arial\">\n  <h3 style=\"margin:0 0 8px\">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå (7 ‡∏Ç‡πâ‡∏≠)</h3>\n  <div style=\"margin:0 0 10px\">\n    ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: ${data.name || '-'} |\n    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${data.position || '-'} |\n    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô AI: ${data.ai_result?.score_percent ?? data.score ?? '-'}%\n  </div>\n  <table style=\"border-collapse:collapse;width:100%;background:#fff\">${rows}</table>\n</div>\n`;\n\nreturn [{\n  json: {\n    ...data,\n    html,                           // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•\n    subject: `‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå - ${data.position || ''} / ${data.name || ''}`\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -560,
        3424
      ],
      "id": "f776a7f4-7cef-4c33-9c19-face208a6b6b",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -2176,
        3424
      ],
      "id": "09c45df9-4a48-409b-ac1f-f6bd32ee69ec",
      "name": "Wait1",
      "webhookId": "8a3b0111-2f32-4dfa-ae6b-2b5d2fccdc35"
    },
    {
      "parameters": {
        "fromEmail": "ai@gmail.com",
        "toEmail": "=nurfafa81@gmail.com",
        "subject": "=[REVIEW] AI Screening ‚Äì {{ $json.name }} / {{ $json.position }} ({{ $json.score }}%)",
        "html": "=<!doctype html>\n<html lang=\"th\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <title>AI Screening ‚Äì Review Required</title>\n  </head>\n  <body style=\"margin:0;background:#fafafc;padding:24px;font-family:'Sarabun','Segoe UI',Tahoma,Arial,sans-serif;color:#111827;\">\n    <div style=\"display:none;max-height:0;overflow:hidden;opacity:0\">\n      ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• AI Screening ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß\n    </div>\n\n    <div style=\"max-width:680px;margin:0 auto;background:#ffffff;border:1px solid #eee;border-radius:16px;overflow:hidden;box-shadow:0 6px 24px rgba(17,24,39,.08)\">\n      <!-- Header -->\n      <div style=\"background:#E5007D;color:#ffffff;padding:18px 22px;text-align:center\">\n        <div style=\"font-size:18px;font-weight:800;letter-spacing:.2px\">AI Screening ‚Äî Review Required</div>\n      </div>\n\n      <!-- Body -->\n      <div style=\"padding:24px 28px;\">\n        <div style=\"font-size:18px;font-weight:800;margin-bottom:10px;color:#E5007D;\">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>\n        <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse;font-size:15px;\">\n          <tr><td style=\"padding:6px 0\"><b>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</b> {{ $json.name || '-' }}</td></tr>\n          <tr><td style=\"padding:6px 0\"><b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> {{ $json.email || '-' }}</td></tr>\n          <tr><td style=\"padding:6px 0\"><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> {{ $json.position || '-' }}</td></tr>\n          <tr><td style=\"padding:6px 0\"><b>‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå:</b> {{ $json.years_exp ?? 0 }} ‡∏õ‡∏µ</td></tr>\n          <tr><td style=\"padding:6px 0\"><b>‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</b> {{ $json.education || '-' }}</td></tr>\n        </table>\n\n        <hr style=\"border:none;border-top:1px solid #f0f0f0;margin:20px 0\">\n\n        <div style=\"font-size:18px;font-weight:800;margin-bottom:8px;color:#E5007D;\">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô AI</div>\n\n        <div style=\"margin:4px 0\"><b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</b> {{ $json.score ?? 0 }}%</div>\n        <div style=\"margin:4px 0\">\n          <b>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á:</b> {{ $json.verdict || '-' }}\n          <span style=\"display:inline-block;margin-left:8px;padding:2px 10px;border-radius:999px;font-size:12px;\n                       background: {{ ($json.verdict||'') === 'pass' ? '#E6FFF2' : '#FFECEC' }};\n                       color:      {{ ($json.verdict||'') === 'pass' ? '#008856' : '#DC2626' }};\">\n            {{ ($json.verdict||'') === 'pass' ? '‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô' }}\n          </span>\n        </div>\n\n        <!-- Gradient progress -->\n        <div style=\"margin:10px 0 6px;background:#f1f1f1;border-radius:8px;height:10px;overflow:hidden;\">\n          <div style=\"height:10px;\n                      background:linear-gradient(90deg,#E5007D,#FF70C5);\n                      width:{{ Math.min(100, Math.max(0, Number($json.score)||0)) }}%;\n                      transition:width .3s ease;\">\n          </div>\n        </div>\n\n        <div style=\"margin-top:14px\">\n          <b>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:</b>\n          <ul style=\"margin:8px 0 0 20px;padding:0;line-height:1.6\">\n            {{\n              (($json.reasons || '')\n                .split('|')\n                .map(s => s.trim())\n                .filter(Boolean)\n                .map(r => `<li>${r}</li>`)\n                .join('')) || '<li>-</li>'\n            }}\n          </ul>\n        </div>\n\n        <div style=\"margin-top:22px\">\n          <div style=\"font-size:18px;font-weight:800;margin-bottom:10px;color:#E5007D;\">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>\n          {{\n            (()=>{\n              let qs = [];\n              try { qs = JSON.parse($json.questions_json || '[]'); } catch(e) {}\n              if (!Array.isArray(qs) || !qs.length) return `<div style=\"color:#6b7280\">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>`;\n              return `<ol style=\"margin:8px 0 0 18px;padding:0;line-height:1.6\">`\n                + qs.map(q => {\n                    const topic = q?.topic ? `<span style=\"display:inline-block;background:#FFE0F1;color:#C60063;border-radius:999px;padding:2px 8px;font-size:12px;margin-right:6px\">${q.topic}</span>` : '';\n                    const expected = q?.expected ? `<div style=\"color:#6b7280;font-size:12px;margin-top:2px\">‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: ${q.expected}</div>` : '';\n                    const signal = q?.signal ? `<div style=\"color:#6b7280;font-size:12px;margin-top:2px\">‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï: ${q.signal}</div>` : '';\n                    const body = q?.question || '';\n                    return `<li style=\"margin:10px 0\"><div>${topic}${body}</div>${expected}${signal}</li>`;\n                  }).join('')\n                + `</ol>`;\n            })()\n          }}\n        </div>\n\n        <hr style=\"border:none;border-top:1px solid #f0f0f0;margin:24px 0\">\n\n        <div style=\"text-align:center\">\n          <a href=\"https://nun9.app.n8n.cloud/webhook/hr-decision?action=approve&subId={{$json.submission_id || ''}}&name={{encodeURIComponent($json.name || '')}}\"\n             style=\"display:inline-block;background:#00B386;color:#fff;text-decoration:none;\n                    padding:14px 22px;border-radius:10px;font-weight:700;margin:6px;min-width:220px;\">\n            ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå\n          </a>\n          <a href=\"https://nun9.app.n8n.cloud/webhook/hr-decision?action=reject&subId={{$json.submission_id || ''}}&name={{encodeURIComponent($json.name || '')}}\"\n             style=\"display:inline-block;background:#DC2626;color:#fff;text-decoration:none;\n                    padding:14px 22px;border-radius:10px;font-weight:700;margin:6px;min-width:140px;\">\n            ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥\n          </a>\n        </div>\n\n        <div style=\"color:#9ca3af;font-size:12px;margin-top:18px;text-align:center;\">\n          Submission ID: {{ $json.submission_id || '-' }}\n        </div>\n      </div>\n    </div>\n  </body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        560,
        3424
      ],
      "id": "7422c53c-75e7-4ce8-bb76-f70faacb8503",
      "name": "Send email3",
      "webhookId": "49f6cf74-29cc-4d26-8dd9-afb635a8f7c6",
      "credentials": {
        "smtp": {
          "id": "J3CgwUwFlXIpPIDC",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"score_percent\": { \"type\": \"number\", \"minimum\": 0, \"maximum\": 100 },\n    \"verdict\": { \"type\": \"string\", \"enum\": [\"pass\", \"fail\", \"unknown\"] },\n    \"reasons\": {\n      \"type\": \"array\",\n      \"items\": { \"type\": \"string\" }\n    },\n    \"questions\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"question\": { \"type\": \"string\" },\n          \"topic\":     { \"type\": \"string\" },\n          \"expected\":  { \"type\": \"string\" },\n          \"signal\":    { \"type\": \"string\" }\n        },\n        \"required\": [\"question\"]\n      }\n    }\n  },\n  \"required\": [\"score_percent\", \"verdict\"],\n  \"additionalProperties\": false\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -928,
        3648
      ],
      "id": "9b210a18-bceb-42e4-834b-140ffc5edc34",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -848,
        3856
      ],
      "id": "494a501f-759a-4705-9c4b-c884c9f24d5d",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "Kcq9aT8se4vz7gtG",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "19z7I9obKVJzV_Zh4XCYNRSWqTDkV5_h5gDCXhprKXuY",
          "mode": "list",
          "cachedResultName": "Hr",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19z7I9obKVJzV_Zh4XCYNRSWqTDkV5_h5gDCXhprKXuY/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "‡∏ä‡∏µ‡∏ï1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19z7I9obKVJzV_Zh4XCYNRSWqTDkV5_h5gDCXhprKXuY/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "submission_id",
              "displayName": "submission_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "position",
              "displayName": "position",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "years_exp",
              "displayName": "years_exp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "education",
              "displayName": "education",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "verdict",
              "displayName": "verdict",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reasons",
              "displayName": "reasons",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "questions_json",
              "displayName": "questions_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q1",
              "displayName": "q1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic1",
              "displayName": "topic1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected1",
              "displayName": "expected1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal1",
              "displayName": "signal1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q2",
              "displayName": "q2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic2",
              "displayName": "topic2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected2",
              "displayName": "expected2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal2",
              "displayName": "signal2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q3",
              "displayName": "q3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic3",
              "displayName": "topic3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected3",
              "displayName": "expected3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal3",
              "displayName": "signal3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q4",
              "displayName": "q4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic4",
              "displayName": "topic4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected4",
              "displayName": "expected4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal4",
              "displayName": "signal4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q5",
              "displayName": "q5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic5",
              "displayName": "topic5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected5",
              "displayName": "expected5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal5",
              "displayName": "signal5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q6",
              "displayName": "q6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic6",
              "displayName": "topic6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected6",
              "displayName": "expected6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal6",
              "displayName": "signal6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q7",
              "displayName": "q7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic7",
              "displayName": "topic7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected7",
              "displayName": "expected7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal7",
              "displayName": "signal7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "submissionId",
              "displayName": "submissionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "candidate",
              "displayName": "candidate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ai_result",
              "displayName": "ai_result",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "approveUrl",
              "displayName": "approveUrl",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "rejectUrl",
              "displayName": "rejectUrl",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        336,
        3424
      ],
      "id": "bf628508-f5f8-4a5e-971a-75d6dbfa0a66",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "l9NRl6KMlOIOCf0N",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "25e88a71-5025-4b2a-9118-7b609440d4e7",
              "leftValue": "={{ $json.lastUpdatedAt }}",
              "rightValue": "={{ $json.submissionTime }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1952,
        3424
      ],
      "id": "81a1ba08-785d-4932-94ce-8a2c024332ca",
      "name": "If4"
    },
    {
      "parameters": {
        "jsCode": "// ---- helper ‡∏™‡∏±‡πâ‡∏ô ‡πÜ ----\nconst get = (name) => {\n  try { return $node[name].json || {}; } catch { return {}; }\n};\n\n// ---- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á ‡πÜ ----\nconst src = get('Prepare Text from PDF1');         // name, email, position, years_exp, education\nconst aiRawNode = get('AI Agent1');\n\n// ‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á AI Agent ‡∏à‡∏∞‡∏´‡πà‡∏≠‡∏ú‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô .output\nconst aiOut = aiRawNode.output ?? aiRawNode;\n\n// ---- normalize AI result ----\nconst reasons = Array.isArray(aiOut.reasons)\n  ? aiOut.reasons\n  : (aiOut.reasons ? [aiOut.reasons] : []);\n\nconst questions = Array.isArray(aiOut.questions) ? aiOut.questions : [];\n\nconst ai_result = {\n  score_percent: Number(aiOut.score_percent ?? 0),\n  verdict: String(aiOut.verdict ?? 'fail').toLowerCase(),\n  reasons,\n  questions,\n};\n\n// ---- ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ----\nconst candidate = {\n  name: src.name ?? '',\n  email: src.email ?? '',\n  position: src.position ?? '',\n  // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å candidate ‡∏Å‡πá‡πÉ‡∏™‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢\n  score: ai_result.score_percent,\n};\n\n// ---- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Edit Fields) ----\nconst cfg = get('Edit Fields');                 // ‡∏°‡∏µ WEBHOOK_URL, HR_EMAIL ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ\nconst submissionId = Date.now().toString(36);  // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ id ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß\n\nconst base = cfg.WEBHOOK_URL || 'https://YOUR-SUBDOMAIN.n8n.cloud/webhook/hr-decision';\nconst q = (o) => Object.entries(o)\n  .map(([k,v]) => `${encodeURIComponent(k)}=${encodeURIComponent(String(v??''))}`)\n  .join('&');\n\nconst common = { subId: submissionId, name: candidate.name, email: candidate.email, pos: candidate.position, score: ai_result.score_percent };\nconst approveUrl = `${base}?action=approve&${q(common)}`;\nconst rejectUrl  = `${base}?action=reject&${q(common)}`;\n\n// ---- ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô item ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ----\nreturn [{\n  json: {\n    submissionId,\n    candidate,\n    ai_result,\n    approveUrl,\n    rejectUrl,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        3424
      ],
      "id": "69e4f8b3-9b2e-4709-9476-a017e3803dce",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "jsCode": "/** ---------- helpers ---------- **/\nconst gp = (o, p) => (o && p)\n  ? p.split('.').reduce((x, k) => (x && x[k] !== undefined ? x[k] : undefined), o)\n  : undefined;\n\nconst nz = v => v !== undefined && v !== null && String(v).trim() !== '' &&\n                String(v).trim().toLowerCase() !== 'empty';\n\nconst toNum = v => {\n  const n = Number(String(v ?? '').replace(/[^\\d.-]/g, '').trim());\n  return Number.isFinite(n) ? n : NaN;\n};\n\n/** ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡πâ‡∏≤‡∏á node ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏ô workflow (‡∏à‡∏∞‡πÑ‡∏°‡πà throw) */\nconst nodeJson = (name) => {\n  try {\n    const n = $node[name];\n    return (n && n.json) ? n.json : {};\n  } catch (_) {\n    return {};\n  }\n};\n\n/** ---------- pull upstream nodes (‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô workflow) ---------- **/\nconst PT = nodeJson(\"Prepare Text from PDF1\");  // ‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡∏•‡∏á/‡∏™‡∏Å‡∏±‡∏î‡∏à‡∏≤‡∏Å PDF\nconst FO = nodeJson(\"Fillout Trigger1\");        // ‡∏Ñ‡πà‡∏≤ fillout (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)\n\n/** ---------- candidate basics ---------- **/\nconst submission_id =\n  $json.submissionId || $json.subId || $json.submissionid || $json.submission_id || '';\n\nconst name     = $json.candidate?.name     ?? $json.name     ?? '';\nconst email    = $json.candidate?.email    ?? $json.email    ?? '';\nconst position = $json.candidate?.position ?? $json.position ?? '';\n\n/** ---------- years_exp ---------- **/\nlet years_exp = '';\nconst candYears = toNum($json.candidate?.years_exp);\nif (Number.isFinite(candYears) && candYears > 0) {\n  years_exp = candYears;\n} else if (Number.isFinite(toNum(PT.years_exp)) && toNum(PT.years_exp) > 0) {\n  years_exp = toNum(PT.years_exp);\n} else {\n  const f = toNum(gp(FO, 'questions.6zS8.value'));\n  if (Number.isFinite(f) && f > 0) years_exp = f;\n}\n\n/** ---------- education ---------- **/\nlet education = '';\nif (nz($json.candidate?.education))        education = String($json.candidate.education);\nelse if (nz($json.education))              education = String($json.education);\nelse if (nz(PT.education))                 education = String(PT.education);\nelse if (nz(gp(FO, 'questions.auoa.value'))) education = String(gp(FO, 'questions.auoa.value'));\n\n/** ---------- AI result ---------- **/\nconst score   = Number.isFinite(toNum($json.ai_result?.score_percent))\n  ? toNum($json.ai_result.score_percent) : '';\n\nconst verdict = nz($json.ai_result?.verdict)\n  ? String($json.ai_result.verdict)\n  : ($json.verdict || '');\n\nconst reasonsSrc = $json.ai_result?.reasons ?? $json.reasons ?? [];\nconst reasons = (Array.isArray(reasonsSrc) ? reasonsSrc : [reasonsSrc])\n  .filter(nz).map(String).join(' | ');\n\n/** ---------- questions (normalize 7 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£) ---------- **/\nconst qRaw = Array.isArray($json.ai_result?.questions)\n  ? $json.ai_result.questions\n  : (Array.isArray($json.questions) ? $json.questions : []);\n\nconst norm = (i) => {\n  const q = qRaw[i] || {};\n  return {\n    question: String(q.question ?? ''),\n    topic:    String(q.topic ?? ''),\n    expected: String(q.expected ?? ''),\n    signal:   String(q.signal ?? ''),\n  };\n};\nconst q = Array.from({ length: 7 }, (_, i) => norm(i));\n\n/** ---------- build row ---------- **/\nconst row = {\n  timestamp: new Date().toISOString(),\n  submission_id,\n  name, email, position,\n  years_exp, education,\n  score, verdict, reasons,\n  questions_json: JSON.stringify(q),\n\n  q1: q[0].question, topic1: q[0].topic, expected1: q[0].expected, signal1: q[0].signal,\n  q2: q[1].question, topic2: q[1].topic, expected2: q[1].expected, signal2: q[1].signal,\n  q3: q[2].question, topic3: q[2].topic, expected3: q[2].expected, signal3: q[2].signal,\n  q4: q[3].question, topic4: q[3].topic, expected4: q[3].expected, signal4: q[3].signal,\n  q5: q[4].question, topic5: q[4].topic, expected5: q[4].expected, signal5: q[4].signal,\n  q6: q[5].question, topic6: q[5].topic, expected6: q[5].expected, signal6: q[5].signal,\n  q7: q[6].question, topic7: q[6].topic, expected7: q[6].expected, signal7: q[6].signal,\n};\n\nreturn [{ json: row }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        112,
        3424
      ],
      "id": "72e27fbe-584a-48fc-a1f6-c307540e2a2b",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "jsCode": "// gen short id\nconst rid = () => 'sub_' + Date.now().toString(36) + Math.random().toString(36).slice(2,7);\n\nconst b = $json.body || {};\nconst out = {\n  submission_id: b.submission_id || rid(),\n  first_name: (b.first_name || '').trim(),\n  last_name:  (b.last_name  || '').trim(),\n  name:       ((b.first_name || '') + ' ' + (b.last_name || '')).trim(),\n  email:      (b.email || '').trim().toLowerCase(),     // ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß\n  phone:      (b.phone || '').trim(),\n  position:   (b.position || '').trim(),\n  department: (b.department || '').trim(),\n  education:  (b.education || '').trim(),\n  years_exp:  Number(b.experience_years || 0) || 0,\n  skills:     (b.skills || '').trim(),\n  motivation: (b.motivation || '').trim(),\n};\n\n// ‡∏£‡∏∞‡∏ö‡∏∏ binary ‡∏ä‡∏∑‡πà‡∏≠ 'resume' ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÅ‡∏ô‡∏ö\nif ($binary?.resume) {\n  out.resume = {\n    binaryPropertyName: 'resume',\n    fileName: $binary.resume.fileName,\n    mimeType: $binary.resume.mimeType,\n    fileSize: $binary.resume.fileSize,\n  };\n}\n\nreturn [{ json: out, binary: $binary }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2176,
        2992
      ],
      "id": "b8a9e226-b6e8-455a-9816-a78f3ca966cf",
      "name": "Code in JavaScript12"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -2400,
        3424
      ],
      "id": "6039f844-fab4-44df-82fd-c5ffb42bb6c7",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "7QGtCbNFsgfV1181",
          "mode": "list",
          "cachedResultUrl": "/workflow/7QGtCbNFsgfV1181",
          "cachedResultName": "SPU Modern Portal - Dark Theme"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -1504,
        2992
      ],
      "id": "3ef77c0f-341d-4bd6-80f2-5abc011b4ebd",
      "name": "Call 'SPU Modern Portal - Dark Theme'",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "/**\n * SPU ‚Äî Apply Success (‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏á‡∏≤‡∏ô)\n * Return HTML + JSON (fields + resume binary)\n */\n\n// ---------- safe getters ----------\nconst gp = (o, p) => (o && p)\n  ? p.split('.').reduce((x, k) => (x != null ? x[k] : undefined), o)\n  : undefined;\n\nconst esc = (v) => String(v ?? \"\")\n  .replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\")\n  .replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\");\n\n// ---------- map candidate fields ----------\nconst subId     = $json.submission_id || $json.submissionId || $json.subId || '';\nconst name      = $json.name || gp($json,'candidate.name') || [\n  ($json.first_name || gp($json,'candidate.first_name') || '').trim(),\n  ($json.last_name  || gp($json,'candidate.last_name')  || '').trim(),\n].filter(Boolean).join(' ');\nconst email     = $json.email || gp($json,'candidate.email') || '';\nconst phone     = $json.phone || gp($json,'candidate.phone') || '';\nconst position  = $json.position || gp($json,'candidate.position') || '';\nconst dept      = $json.department || $json.dept || gp($json,'candidate.department') || '';\nconst education = $json.education || gp($json,'candidate.education') || '';\nconst yearsExp  = gp($json,'candidate.years_exp') ?? $json.years_exp ?? '0';\nconst skills    = $json.skills || gp($json,'candidate.skills') || '';\nconst motivation = $json.motivation || gp($json,'candidate.motivation') || '';\n\n// ---------- HTML ----------\nconst html = String.raw`<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß - SPU</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap\" rel=\"stylesheet\">\n<style>\n:root{--ink:#0F172A;--slate:#1E293B;--line:#E2E8F0;--bg:#F8FAFC;--spu-pink:#E5007D;--radius:22px}\n*{box-sizing:border-box} html,body{height:100%}\nbody{margin:0;padding:24px;color:var(--ink);font-family:'Inter','Sarabun',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;\n  background:radial-gradient(1100px 600px at -10% -10%, rgba(229,0,125,.18), transparent 60%),\n             radial-gradient(900px 520px at 110% -30%, rgba(229,0,125,.12), transparent 65%),\n             linear-gradient(135deg,var(--ink),var(--slate));\n  display:flex;align-items:center;justify-content:center}\n.card{width:min(780px,100%);background:#fff;border:1px solid var(--line);border-radius:var(--radius);\n  box-shadow:0 24px 60px rgba(0,0,0,.35);overflow:hidden}\n.header{display:flex;align-items:center;gap:12px;padding:18px 22px;border-bottom:1px solid var(--line);\n  background:linear-gradient(#fff,#fbfbfe)}\n.logo{height:48px}.title{font-weight:800;letter-spacing:.2px;font-size:18px}\n.badge{margin-left:auto;display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;color:#fff;\n  background:linear-gradient(135deg,#16a34a,#22c55e);font-weight:800;box-shadow:0 6px 16px rgba(0,0,0,.18)}\n.badge svg{width:18px;height:18px;stroke:#fff;fill:none;stroke-width:2.4;stroke-linecap:round;stroke-linejoin:round}\n.body{background:var(--bg);padding:22px}.panel{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}\n.kv{display:grid;grid-template-columns:200px 1fr;gap:12px;padding:10px 12px}.kv+.kv{border-top:1px dashed var(--line)}\n.k{color:#334155;font-weight:700}.v{color:#0F172A}.note{color:#64748B;font-size:14px;margin-top:14px}\n.footer{padding:12px 22px;border-top:1px solid var(--line);background:#fff;color:#64748B;font-size:12px}\n@media (max-width:560px){.kv{grid-template-columns:1fr}.badge{margin-top:8px}.header{flex-direction:column;align-items:flex-start}}\n</style>\n</head>\n<body>\n  <article class=\"card\" role=\"region\" aria-label=\"‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£\">\n    <header class=\"header\">\n      <img class=\"logo\" src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU\">\n      <div class=\"title\">‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß</div>\n      <span class=\"badge\" aria-label=\"success\">\n        <svg viewBox=\"0 0 24 24\"><path d=\"M20 6l-11 11-5-5\"/></svg> SUCCESS\n      </span>\n    </header>\n\n    <section class=\"body\">\n      <div class=\"panel\" aria-label=\"‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£\">\n        <div class=\"kv\"><div class=\"k\">‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</div><div class=\"v\">${esc(subId)}</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div><div class=\"v\">${esc(name)}</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div><div class=\"v\">${esc(position)}</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à</div><div class=\"v\">${esc(dept)}</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div><div class=\"v\">${esc(email)}</div></div>\n        <div class=\"kv\"><div class=\"k\">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</div><div class=\"v\">${esc(phone)}</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div><div class=\"v\">${esc(education)}</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå (‡∏õ‡∏µ)</div><div class=\"v\">${esc(yearsExp)}</div></div>\n      \n      </div>\n\n      <p class=\"note\">\n        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢ AI ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á\n        ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <em>Spam/Promotions</em> ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•\n      </p>\n    </section>\n\n    <footer class=\"footer\">¬© Sripatum University ‚Äî Recruitment & Selection System</footer>\n  </article>\n</body>\n</html>`;\n\n// ---------- attach binary resume (if exists) ----------\nconst inItem = $input.first();\nconst inBin  = (inItem && inItem.binary) || {};\nconst resumeBin =\n  inBin.resume ||\n  inBin.resume0 ||\n  inBin.file ||\n  inBin.data ||\n  inBin.attachment_0 ||\n  null;\n\n// ---------- output ----------\nreturn [{\n  json: {\n    html,\n    submission_id: subId,\n    name, email, phone, position,\n    department: dept, education, years_exp: yearsExp,\n    skills, motivation,\n    has_resume_binary: !!resumeBin\n  },\n  binary: resumeBin ? { resume: resumeBin } : undefined\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1952,
        2992
      ],
      "id": "9ac88f94-7b6b-43ba-8759-2ef70712137a",
      "name": "Code in JavaScript13"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -2192,
        -1264
      ],
      "id": "793dc257-7c21-4613-9f57-6bf332866e26",
      "name": "HTTP Request"
    }
  ],
  "pinData": {
    "Register POST": [
      {
        "json": {
          "headers": {
            "host": "nun9.app.n8n.cloud",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 OPR/122.0.0.0",
            "content-length": "206",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
            "accept-encoding": "gzip, br",
            "accept-language": "th,en;q=0.9,pl;q=0.8",
            "cache-control": "max-age=0",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "202.176.127.170",
            "cf-ew-via": "15",
            "cf-ipcountry": "TH",
            "cf-ray": "999ab011a2eaf305-BKK",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/x-www-form-urlencoded",
            "origin": "null",
            "priority": "u=0, i",
            "sec-ch-ua": "\"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"138\", \"Opera GX\";v=\"122\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Windows\"",
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "cross-site",
            "sec-fetch-user": "?1",
            "upgrade-insecure-requests": "1",
            "x-forwarded-for": "202.176.127.170, 172.68.44.137",
            "x-forwarded-host": "nun9.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-47-58bbcd9445-jmnj8",
            "x-is-trusted": "yes",
            "x-real-ip": "202.176.127.170"
          },
          "params": {},
          "query": {},
          "body": {
            "name": "Nurfadil Yumae",
            "email": "admin@spu.ac.th",
            "department": "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•",
            "phone": "0964038835",
            "password": "12114900",
            "confirm_password": "12114900"
          },
          "webhookUrl": "https://nun9.app.n8n.cloud/webhook/auth/register",
          "executionMode": "production"
        }
      }
    ],
    "Webhook ‚Ä¢ Approval Position GET": [
      {
        "json": {
          "headers": {
            "host": "nun9.app.n8n.cloud",
            "user-agent": "Mozilla/5.0 (iPhone; CPU iPhone OS 26_0_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/142.0.7444.77 Mobile/15E148 Safari/604.1",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
            "accept-encoding": "gzip, br",
            "accept-language": "th-TH,th;q=0.9",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "49.237.45.111",
            "cf-ew-via": "15",
            "cf-ipcountry": "TH",
            "cf-ray": "99b3047ea0a39fe0-HKG",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "cookie": "ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%2231136163ec85b38b4090bb16499b6c2967fb2bd596e079e645f406d7f337adb8%23f52af9cb-7455-45b8-be6c-7ab47f473d79%22%2C%22%24sesid%22%3A%5B1762006975956%2C%22019a3fc3-d305-7a99-a7cc-2b5c32a74a1a%22%2C1762006389508%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22https%3A%2F%2Fnnn333.app.n8n.cloud%2Fsignin%22%7D%7D; rl_session=RudderEncrypt%3AU2FsdGVkX186Z52HU7IMIuCvuilG9lwAGftWOtZgEqnzb6WmH7BvJYzSnpbbYqAUJp%2FW%2B5N%2BrULz6x%2FHGOSDH1EnSRBU3ihqzTl2%2F0sHnF67ADKs7%2F3NaXYAzUn%2FqN2zoDbq8ZScLOTrW1OZau4aJg%3D%3D; n8n_anonymous_id=de71a3bc-5419-4bb6-9284-7540f9ccaba3; rl_trait=RudderEncrypt%3AU2FsdGVkX19E7pEAvQa4wk6DiRX%2BfbvsSAXgXObIEN7mgyAY%2Bz7Fez79OqIMIPfxUoJpc3ZV%2BoRxf42dKLf4aubbCmss6GBIqODbCLH4HTK6ofUWdI0Gxj%2FQz0F6FIe3A9zJuNyJnRxAAuXtuOwZxswBdsC9nOZonhw1JPlpnOFWFyTi8K%2Fgt8C%2FpMgOVYWhw%2BLiCLv4%2BxRCoeYVtKMW2w%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX18w%2BekzQUe4wxVsMocrWT8bA1SO8VSZB8w1k%2FEYfIiVYNTWVcdgzsEBuGwLu3Kj83lIa3OWJFKZ%2BPd9B0UMNWh%2FuK5N2Y02n3Cq5sVWS%2FTgpwbVBZsFqlwGr4M%2BcgdCxdBqySoI93BlsYH8hUGDR4tWn2xHgwFlG5M%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2Bp8GTH0ZCBOFoYPmQm4SLnr7IqZQZ3mkUKtX6XgmGMRwn%2BhG05K3Y2hN2L5Fe67Bjd28amd2csTw%3D%3D; _ga_0SC4FF2FH9=GS2.1.s1762006238$o9$g1$t1762006384$j56$l0$h0; _fbp=fb.1.1758718680922.84040963590950588; _gcl_au=1.1.1678037233.1758797533; _ga=GA1.1.1261444461.1758718681; rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX19qvOy9WPtouGW1JxnmcfC7qkkLyU0%2FjII%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FQdsxIoQV9y%2BU1dQjy7f%2FLesXS9gmQgqs%3D",
            "priority": "u=0, i",
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "none",
            "x-forwarded-for": "49.237.45.111, 162.158.193.159",
            "x-forwarded-host": "nun9.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-47-58bbcd9445-gl5l4",
            "x-is-trusted": "yes",
            "x-real-ip": "49.237.45.111"
          },
          "params": {},
          "query": {
            "decision": "approve",
            "reqid": "REQ25681108-351426",
            "dept": "test",
            "pos": "111",
            "owner": "del@spu.ac.th"
          },
          "body": {},
          "webhookUrl": "https://nun9.app.n8n.cloud/webhook/approval/position",
          "executionMode": "production"
        }
      }
    ],
    "Webhook ‚Ä¢ Intake Submit POST": [
      {
        "json": {
          "headers": {
            "host": "nun9.app.n8n.cloud",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36",
            "content-length": "106",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
            "accept-encoding": "gzip, br",
            "accept-language": "en-US,en;q=0.9",
            "cache-control": "max-age=0",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "49.237.45.111",
            "cf-ew-via": "15",
            "cf-ipcountry": "TH",
            "cf-ray": "99b3999de3a703d7-HKG",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/x-www-form-urlencoded",
            "origin": "null",
            "priority": "u=0, i",
            "sec-ch-ua": "\"Not_A Brand\";v=\"99\", \"Chromium\";v=\"142\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "cross-site",
            "sec-fetch-user": "?1",
            "upgrade-insecure-requests": "1",
            "x-forwarded-for": "49.237.45.111, 162.158.193.159",
            "x-forwarded-host": "nun9.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-47-58bbcd9445-q6ps6",
            "x-is-trusted": "yes",
            "x-real-ip": "49.237.45.111"
          },
          "params": {},
          "query": {},
          "body": {
            "request_type": "new",
            "department": "test",
            "position": "test",
            "qualifications": "test",
            "reason": "test",
            "owner_email": "del@spu.ac.th"
          },
          "webhookUrl": "https://nun9.app.n8n.cloud/webhook/intake/request-position",
          "executionMode": "production"
        }
      }
    ],
    "Webhook ‚Ä¢ Apply Form GET": [
      {
        "json": {
          "headers": {
            "host": "nun9.app.n8n.cloud",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
            "accept-encoding": "gzip, br",
            "accept-language": "en-US,en;q=0.9",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "49.237.45.111",
            "cf-ew-via": "15",
            "cf-ipcountry": "TH",
            "cf-ray": "99b4569183cd03d7-HKG",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "cookie": "rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX19qvqk0UbzLpfWnTnIFhgq8ts9XpxTOfhU%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2FcTlO9nLKVS0lcd7EWArWkM8IVAUBrq3c%3D; _ga=GA1.1.251154927.1762187691; _fbp=fb.1.1762187691469.824314811949797627; _ga_0SC4FF2FH9=GS2.1.s1762268890$o2$g0$t1762268894$j56$l0$h0; spu_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBzcHUuYWMudGgiLCJpZCI6ImVjYWNlNTlkLTYwNDMtNDM4YS04ZWY0LTkwYjk3NjM1NDYwZSIsImVtYWlsIjoiYWRtaW5Ac3B1LmFjLnRoIiwibmFtZSI6Ik51cmZhZGlsIFl1bWFlIiwicm9sZSI6InVzZXIiLCJkZXB0Ijoi4Liq4Liz4LiZ4Lix4LiB4Lia4Li44LiE4LiE4LilIiwiaWF0IjoxNzYyNTgyOTk3LCJleHAiOjE3NjI2MTE3OTd9.zzkPVa6UjQOIUgcgoT-RGfuViYyd4S_EZP3_lyrtHu8; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX19C5DcZLvAzDjpeUb9QhiUkfCKNSIB5J5FlK3aCeLlUUJBaOYnQ9%2FbTDC7VGRJCoZ67kOd4o2JMBA%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX1%2B9WVBFqJ7PiGr%2F%2Br0SyVpJzLhFZpcJ3BzA9Md4CPe6diTKvoqpi2LdUxB81eQKkE%2FgZC4%2BW7C2nUyfeADXFut3ZwT6WzlJ%2FmfH131VisLJcTHZ4StB9r5ujDlo5x5%2F0XhqaReOSLv5qXqgq6Ft4xkQjoyh5nw0%2FpA%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19VVqsBvALNPdC4UJSqWVgHfo8VkBfltbrc2qQUfYG%2BoQB2FNPBJJGykHoR%2FVBwgOCsziHwir%2BPene5lIFiId8g4agFSWiKfws7WKwThDyq%2FTL8XdRMdI6pD8YGzuBMxcMInlU2KPGdXAYX%2FZy8ehJ4yonbKPMtxwpzcFw05Y%2FBifN%2B%2FozTRxOmausyd7aknpv0bQhLJj%2FLeg%3D%3D; n8n_anonymous_id=eec49fbc-2f52-4937-9da8-a94a75cbddbd; rl_session=RudderEncrypt%3AU2FsdGVkX1%2FRqfGNpjxQs0Iok2K%2Fc3XRP9t85CJ2lEK8bHcoEgvD0fuCeMhYX0feE4%2FdhybNgOTbPiXV1H3W0lpGp60PcXrYiVBqWCFtLF75q1kqQ1VW1XfjPhbb4c1IDs8AJCHpmPUvSKgnWC%2FMMQ%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%2231136163ec85b38b4090bb16499b6c2967fb2bd596e079e645f406d7f337adb8%23f52af9cb-7455-45b8-be6c-7ab47f473d79%22%2C%22%24sesid%22%3A%5B1762597226011%2C%22019a62e0-d9ad-7a51-b4e5-daed7ea67a9f%22%2C1762595494316%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22https%3A%2F%2Fnun9.app.n8n.cloud%2Fsignin%22%7D%7D",
            "priority": "u=0, i",
            "sec-ch-ua": "\"Not_A Brand\";v=\"99\", \"Chromium\";v=\"142\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "none",
            "sec-fetch-user": "?1",
            "upgrade-insecure-requests": "1",
            "x-forwarded-for": "49.237.45.111, 162.158.193.159",
            "x-forwarded-host": "nun9.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-47-58bbcd9445-q6ps6",
            "x-is-trusted": "yes",
            "x-real-ip": "49.237.45.111"
          },
          "params": {},
          "query": {},
          "body": {},
          "webhookUrl": "https://nun9.app.n8n.cloud/webhook/apply",
          "executionMode": "production"
        }
      }
    ],
    "Webhook ‚Ä¢ Apply Submit POST": [
      {
        "json": {
          "headers": {
            "host": "nun9.app.n8n.cloud",
            "user-agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36",
            "content-length": "5353",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
            "accept-encoding": "gzip, br",
            "accept-language": "en-US,en;q=0.9",
            "cache-control": "max-age=0",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "49.237.34.65",
            "cf-ew-via": "15",
            "cf-ipcountry": "TH",
            "cf-ray": "99b5e2c0b7aad13f-HKG",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "multipart/form-data; boundary=----WebKitFormBoundary5p01QtuQnIoAycsO",
            "if-none-match": "W/\"1345-u29tSVOzQ9kntzy+bKkyIflRrYA\"",
            "origin": "null",
            "priority": "u=0, i",
            "sec-ch-ua": "\"Not_A Brand\";v=\"99\", \"Chromium\";v=\"142\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Linux\"",
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "cross-site",
            "sec-fetch-user": "?1",
            "upgrade-insecure-requests": "1",
            "x-forwarded-for": "49.237.34.65, 162.158.193.158",
            "x-forwarded-host": "nun9.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-47-58bbcd9445-jmnj8",
            "x-is-trusted": "yes",
            "x-real-ip": "49.237.34.65"
          },
          "params": {},
          "query": {},
          "body": {
            "first_name": "‡∏ô‡∏∏‡∏£‡∏ü‡∏≤‡∏î‡∏µ‡∏•",
            "last_name": "‡∏¢‡∏π‡πÅ‡∏°",
            "email": "nurfafa81@gmail.com",
            "phone": "0616373390",
            "position": "‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤",
            "department": "‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®",
            "education": "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å",
            "experience_years": "6",
            "skills": "tt",
            "motivation": "tt"
          },
          "webhookUrl": "https://nun9.app.n8n.cloud/webhook/apply",
          "executionMode": "production"
        },
        "binary": {
          "resume0": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "data": "filesystem-v2",
            "fileName": "SPU_Resume_Mockup (1).pdf",
            "id": "filesystem-v2:workflows/7QGtCbNFsgfV1181/executions/temp/binary_data/6c526395-6046-4659-95a2-b9c9cc18c982",
            "fileSize": "3.98 kB"
          }
        }
      }
    ],
    "When Executed by Another Workflow": [
      {
        "json": {
          "html": "<!DOCTYPE html>\n<html lang=\"th\">\n<head>\n<meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß - SPU</title>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap\" rel=\"stylesheet\">\n<style>\n:root{--ink:#0F172A;--slate:#1E293B;--line:#E2E8F0;--bg:#F8FAFC;--spu-pink:#E5007D;--radius:22px}\n*{box-sizing:border-box} html,body{height:100%}\nbody{margin:0;padding:24px;color:var(--ink);font-family:'Inter','Sarabun',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;\n  background:radial-gradient(1100px 600px at -10% -10%, rgba(229,0,125,.18), transparent 60%),\n             radial-gradient(900px 520px at 110% -30%, rgba(229,0,125,.12), transparent 65%),\n             linear-gradient(135deg,var(--ink),var(--slate));\n  display:flex;align-items:center;justify-content:center}\n.card{width:min(780px,100%);background:#fff;border:1px solid var(--line);border-radius:var(--radius);\n  box-shadow:0 24px 60px rgba(0,0,0,.35);overflow:hidden}\n.header{display:flex;align-items:center;gap:12px;padding:18px 22px;border-bottom:1px solid var(--line);\n  background:linear-gradient(#fff,#fbfbfe)}\n.logo{height:48px}.title{font-weight:800;letter-spacing:.2px;font-size:18px}\n.badge{margin-left:auto;display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;color:#fff;\n  background:linear-gradient(135deg,#16a34a,#22c55e);font-weight:800;box-shadow:0 6px 16px rgba(0,0,0,.18)}\n.badge svg{width:18px;height:18px;stroke:#fff;fill:none;stroke-width:2.4;stroke-linecap:round;stroke-linejoin:round}\n.body{background:var(--bg);padding:22px}.panel{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}\n.kv{display:grid;grid-template-columns:200px 1fr;gap:12px;padding:10px 12px}.kv+.kv{border-top:1px dashed var(--line)}\n.k{color:#334155;font-weight:700}.v{color:#0F172A}.note{color:#64748B;font-size:14px;margin-top:14px}\n.footer{padding:12px 22px;border-top:1px solid var(--line);background:#fff;color:#64748B;font-size:12px}\n@media (max-width:560px){.kv{grid-template-columns:1fr}.badge{margin-top:8px}.header{flex-direction:column;align-items:flex-start}}\n</style>\n</head>\n<body>\n  <article class=\"card\" role=\"region\" aria-label=\"‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£\">\n    <header class=\"header\">\n      <img class=\"logo\" src=\"https://www.spu.ac.th/wp-content/uploads/2024/12/new_logo_spu01.png\" alt=\"SPU\">\n      <div class=\"title\">‡∏£‡∏±‡∏ö‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß</div>\n      <span class=\"badge\" aria-label=\"success\">\n        <svg viewBox=\"0 0 24 24\"><path d=\"M20 6l-11 11-5-5\"/></svg> SUCCESS\n      </span>\n    </header>\n\n    <section class=\"body\">\n      <div class=\"panel\" aria-label=\"‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£\">\n        <div class=\"kv\"><div class=\"k\">‡∏£‡∏´‡∏±‡∏™‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</div><div class=\"v\">sub_mhqezyohzjw1g</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div><div class=\"v\">‡∏ô‡∏∏‡∏£‡∏ü‡∏≤‡∏î‡∏µ‡∏• ‡∏¢‡∏π‡πÅ‡∏°</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div><div class=\"v\">‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏Ñ‡∏ì‡∏∞/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à</div><div class=\"v\">‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div><div class=\"v\">nurfafa81@gmail.com</div></div>\n        <div class=\"kv\"><div class=\"k\">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</div><div class=\"v\">0616373390</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏ß‡∏∏‡∏í‡∏¥‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div><div class=\"v\">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å</div></div>\n        <div class=\"kv\"><div class=\"k\">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå (‡∏õ‡∏µ)</div><div class=\"v\">6</div></div>\n      \n      </div>\n\n      <p class=\"note\">\n        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢ AI ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á\n        ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <em>Spam/Promotions</em> ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•\n      </p>\n    </section>\n\n    <footer class=\"footer\">¬© Sripatum University ‚Äî Recruitment & Selection System</footer>\n  </article>\n</body>\n</html>",
          "submission_id": "sub_mhqezyohzjw1g",
          "name": "‡∏ô‡∏∏‡∏£‡∏ü‡∏≤‡∏î‡∏µ‡∏• ‡∏¢‡∏π‡πÅ‡∏°",
          "email": "nurfafa81@gmail.com",
          "phone": "0616373390",
          "position": "‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤",
          "department": "‡∏Ñ‡∏ì‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®",
          "education": "‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å",
          "years_exp": 6,
          "skills": "tt",
          "motivation": "tt",
          "has_resume_binary": true
        },
        "binary": {
          "resume": {
            "mimeType": "application/pdf",
            "fileType": "pdf",
            "fileExtension": "pdf",
            "fileName": "SPU_Resume_Mockup (1).pdf",
            "id": "filesystem-v2:workflows/7QGtCbNFsgfV1181/executions/temp/binary_data/f591af28-e706-48a2-8171-b005cf961ef9",
            "fileSize": "3.98 kB"
          }
        }
      }
    ]
  },
  "connections": {
    "Webhook ‚Ä¢ Intake Form GET": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Intake Form": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Intake Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Apply Form GET": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Apply Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Apply Form": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Apply Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Apply Submit POST": {
      "main": [
        [
          {
            "node": "Code in JavaScript12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Shortlist Form GET": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Shortlist Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Shortlist Form": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Shortlist Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Shortlist Submit POST": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Normalize Shortlist Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Normalize Shortlist Data": {
      "main": [
        [
          {
            "node": "Google Calendar ‚Ä¢ Create Event",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Calendar ‚Ä¢ Create Event": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Shortlist Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Shortlist Success": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Shortlist Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Interview Score GET": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Interview Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Interview Form": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Interview Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Interview Score POST": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Normalize Interview Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Normalize Interview Data": {
      "main": [
        [
          {
            "node": "Google Sheets ‚Ä¢ Log Evaluation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets ‚Ä¢ Log Evaluation": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Interview Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Interview Success": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Interview Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Result Helper GET": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Result Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Result Page": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Result Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Approval Final GET": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Process Final Approval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Process Final Approval": {
      "main": [
        [
          {
            "node": "IF ‚Ä¢ Check Final Approved",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF ‚Ä¢ Check Final Approved": {
      "main": [
        [
          {
            "node": "Email ‚Ä¢ Send Offer Letter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Email ‚Ä¢ Notify Department Start",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email ‚Ä¢ Send Offer Letter": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Final Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Normalize Intake Data": {
      "main": [
        [
          {
            "node": "Google Sheets ‚Ä¢ Log Applicant1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets ‚Ä¢ Log Applicant1": {
      "main": [
        [
          {
            "node": "Email ‚Ä¢ Notify HR Director & Asst President",
            "type": "main",
            "index": 0
          },
          {
            "node": "Code ‚Ä¢ Generate Success Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email ‚Ä¢ Notify HR Director & Asst President": {
      "main": [
        []
      ]
    },
    "Code ‚Ä¢ Generate Success Page": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Intake Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Intake Submit POST": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Normalize Intake Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Approval Position GET": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Process Position Approval",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Process Position Approval": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [],
        [
          {
            "node": "Send email4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email4": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Respond to Webhook5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [],
        [
          {
            "node": "Send email5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email5": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Respond to Webhook7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Check Password": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Validate Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Portal Home3": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Portal Home3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Logout": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Portal Home3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Login GET": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Modern Login": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Login",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Register GET1": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Modern Register",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Generate Modern Register": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Register",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Logout": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Logout Page": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Logout",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Forgot Password GET": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Forgot Password Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Forgot Password Page": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Forgot Password",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook ‚Ä¢ Portal GET": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase (Get User)": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Normalize User1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Register POST": {
      "main": [
        [
          {
            "node": "Code (Validate)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code (Validate)": {
      "main": [
        [
          {
            "node": "Supabase (Check Email)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase (Check Email)": {
      "main": [
        [
          {
            "node": "Code (Check & Hash)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code (Check & Hash)": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase (Create User)": {
      "main": [
        [
          {
            "node": "Code (Success Redirect)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code (Success Redirect)": {
      "main": [
        [
          {
            "node": "regis res",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase (Create User)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase ‚Ä¢ Get User": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Portal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Supabase ‚Ä¢ Get User",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Portal1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript10": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Logout Page",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript11": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Portal4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Validate Input": {
      "main": [
        [
          {
            "node": "Supabase (Get User)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code password1": {
      "main": [
        [
          {
            "node": "IF Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code ‚Ä¢ Normalize User1": {
      "main": [
        [
          {
            "node": "Code password1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Error": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Error Redirect",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond ‚Ä¢ Portal Home2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Intake Form",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Portal2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload PDF1": {
      "main": [
        [
          {
            "node": "Convert/Extract from PDF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert/Extract from PDF1": {
      "main": [
        [
          {
            "node": "Prepare Text from PDF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Text from PDF1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Send email3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Upload PDF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email3": {
      "main": [
        []
      ]
    },
    "Code in JavaScript12": {
      "main": [
        [
          {
            "node": "Code in JavaScript13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond ‚Ä¢ Apply Success": {
      "main": [
        [
          {
            "node": "Call 'SPU Modern Portal - Dark Theme'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript13": {
      "main": [
        [
          {
            "node": "Respond ‚Ä¢ Apply Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code ‚Ä¢ Generate Modern Login",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2a9cff03-1cf8-4f0e-a506-74c20523f67c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "31136163ec85b38b4090bb16499b6c2967fb2bd596e079e645f406d7f337adb8"
  },
  "id": "7QGtCbNFsgfV1181",
  "tags": []
}