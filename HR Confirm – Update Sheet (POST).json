{
  "name": "HR Confirm ‚Äì Update Sheet (POST)",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1d095099-558e-45dc-aa43-b953dea1b823",
              "name": "WEBHOOK_URL",
              "value": "https://n8nkrub.n8n.cloud/webhook/hr-decision",
              "type": "string"
            },
            {
              "id": "45f37c96-71cf-40a7-9bff-71fa8c287627",
              "name": "HR_EMAIL",
              "value": "hrspuaiclub@gmail.com",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4448,
        1952
      ],
      "id": "676d7c33-3d58-4f63-a516-0e4a94d761f4",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "operation": "Upload File to PDF.co",
        "binaryData": true,
        "binaryPropertyName": "pdf",
        "name": "={{\n  (Object.values($node[\"Fillout Trigger1\"].json.questions)\n    .find(q => q?.value?.[0]?.filename))?.value?.[0]?.filename || 'resume.pdf'\n}}\n"
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        3056,
        1952
      ],
      "id": "9d24ec6a-cc5c-4e03-b1f3-afd11c76a9a1",
      "name": "Upload PDF1",
      "credentials": {
        "pdfcoApi": {
          "id": "wz3s7k9GwyxhHJyn",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "operation": "Convert from PDF",
        "url": "={{$node[\"Upload PDF1\"].json[\"url\"]}}",
        "advancedOptions": {}
      },
      "type": "n8n-nodes-pdfco.PDFco Api",
      "typeVersion": 1,
      "position": [
        3280,
        1952
      ],
      "id": "a9c041da-e5d7-4af9-b2e6-6a901ca415de",
      "name": "Convert/Extract from PDF1",
      "credentials": {
        "pdfcoApi": {
          "id": "wz3s7k9GwyxhHJyn",
          "name": "PDF.co account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2ed52c71-1f98-4b33-afd3-e5f371d89715",
              "name": "pdfText",
              "value": "={{ \n  (\n    $json.body || $json.text || $node[\"Convert/Extract from PDF1\"].json.body || \"\"\n  )\n  .replace(/\\r/g,\"\")\n  .replace(/[ \\t]+\\n/g,\"\\n\")\n  .trim()\n  .slice(0,5000)     // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô\n}}",
              "type": "string"
            },
            {
              "id": "8b7e5410-0816-48fd-a2e7-11d72217d7d7",
              "name": "name",
              "value": "={{ $('Fillout Trigger1').item.json.questions['3iYA'].value }}",
              "type": "string"
            },
            {
              "id": "f80aa6cd-0101-4f3f-8c67-fbc6e33908ca",
              "name": "email",
              "value": "={{ $('Fillout Trigger1').item.json.questions.pRi4.value }}",
              "type": "string"
            },
            {
              "id": "7b6dda29-e99f-4d07-9dfb-08ae55625db9",
              "name": "position",
              "value": "={{ $('Fillout Trigger1').item.json.questions['1Ran'].value }}",
              "type": "string"
            },
            {
              "id": "6c3071db-8d82-45f4-bbc3-2e45afad4ca8",
              "name": "years_exp",
              "value": "={{ $('Fillout Trigger1').item.json.questions['6zS8'].value }}",
              "type": "number"
            },
            {
              "id": "157201ca-53ab-4156-95b0-08c4d949b356",
              "name": "education",
              "value": "={{ $('Fillout Trigger1').item.json.questions.auoa.value }}",
              "type": "string"
            },
            {
              "id": "27260fc4-cfe2-4321-b615-fc0c9a91c416",
              "name": "threshold",
              "value": "={{ Number($node[\"Fillout Trigger1\"].json.questions.threshold?.value || 70) }}",
              "type": "string"
            },
            {
              "id": "ab59644b-8e17-4d57-a356-a883bca389fe",
              "name": "skill",
              "value": "={{ $('Fillout Trigger1').item.json.questions.gzp6.value }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3504,
        1952
      ],
      "id": "120bbd8f-51e8-46ea-b61b-6f6be71358a2",
      "name": "Prepare Text from PDF1"
    },
    {
      "parameters": {
        "form": "mu9xZDUPY5us"
      },
      "type": "n8n-nodes-fillout.filloutTrigger",
      "typeVersion": 1,
      "position": [
        2160,
        1952
      ],
      "id": "409b01a5-3da9-4551-828e-e8645343ed50",
      "name": "Fillout Trigger1",
      "webhookId": "0179b3e6-cbb9-4f59-955e-ac4143452743",
      "credentials": {
        "filloutApi": {
          "id": "LxGNiAQyQaKlBTVD",
          "name": "Fillout account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ \n  (Object.values($node[\"Fillout Trigger1\"].json.questions)\n   .find(q => q?.value?.[0]?.url))?.value?.[0]?.url || ''\n}}\n",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file",
              "outputPropertyName": "pdf"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2832,
        1952
      ],
      "id": "27eee87d-c79c-44b6-a90e-39c681c90958",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=‡∏á‡∏≤‡∏ô: ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{ $node[\"Prepare Text from PDF1\"].json.position }} \n‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥:{{ $json.threshold }}%\n\n‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:\n- ‡∏ä‡∏∑‡πà‡∏≠: {{ $node[\"Prepare Text from PDF1\"].json.name }}\n- ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: {{ $node[\"Prepare Text from PDF1\"].json.email }}\n- ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå (‡∏õ‡∏µ): {{ $node[\"Prepare Text from PDF1\"].json.years_exp }}\n- ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤: {{ $node[\"Prepare Text from PDF1\"].json.education }}\n\n‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤/‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏ã‡∏π‡πÄ‡∏°‡πà (pdf):\n{{ $json.pdfText }}\n\n‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:\n1) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô 0-100 ‡πÅ‡∏•‡∏∞ verdict ‡∏à‡∏≤‡∏Å threshold\n2) ‡πÉ‡∏´‡πâ reasons ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 1-5 ‡∏Ç‡πâ‡∏≠\n3) ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå 7 ‡∏Ç‡πâ‡∏≠ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ technical/experience/problem_solving/communication/culture ‡∏û‡∏£‡πâ‡∏≠‡∏° expected ‡πÅ‡∏•‡∏∞ signal\n**‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏ï‡∏≤‡∏°‡∏™‡∏Ñ‡∏µ‡∏°‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô**\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ HR\n‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à: ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á ‚Äú‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå 7 ‡∏Ç‡πâ‡∏≠‚Äù\n\n‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å):\n1) ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô ‚ÄúJSON ‡πÄ‡∏û‡∏µ‡∏¢‡∏ß ‡πÜ‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\n   - ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ Markdown / ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ / ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ü‡∏ô‡∏ã‡πå / ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏î‡∏Å‡πà‡∏≠‡∏ô-‡∏´‡∏•‡∏±‡∏á JSON\n   - ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ UTF-8, ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå, ‡πÑ‡∏°‡πà‡∏°‡∏µ comma ‡πÄ‡∏Å‡∏¥‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏ñ‡∏ß\n2) ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‚Äù ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏µ‡∏¢‡πå‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ô‡∏µ‡πâ:\n   - score_percent: number ‡∏ä‡πà‡∏ß‡∏á 0..100 (‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå %)\n   - verdict: string ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô \"pass\" ‡∏´‡∏£‡∏∑‡∏≠ \"fail\" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô\n   - reasons: string[] ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 1..5 (‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà \"\" ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ï‡∏±‡∏ß ‡πÄ‡∏ä‡πà‡∏ô [\"\"])\n   - questions: array ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß ‚Äú7 ‡∏û‡∏≠‡∏î‡∏µ‚Äù ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏õ‡πá‡∏ô object ‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ:\n       {\n         \"question\": string,\n         \"topic\": \"technical\" | \"experience\" | \"problem_solving\" | \"communication\" | \"culture\",\n         \"expected\": string,\n         \"signal\": string\n       }\n   - ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏µ‡∏¢‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏î\n3) ‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡∏£‡∏¥‡∏á‡∏ß‡πà‡∏≤‡∏á \"\" (‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏™‡πà null/undefined)\n4) ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏´‡∏ô‡πà‡∏ß‡∏¢/‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏õ‡∏ô)\n5) ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡πÉ‡∏´‡πâ‡∏¢‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏ô‡∏à‡∏ö‡πÉ‡∏ô 1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô\n\n‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏∂‡∏î‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ):\n{\n  \"score_percent\": <number 0..100>,\n  \"verdict\": \"pass\" | \"fail\",\n  \"reasons\": [\"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\", \"... (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 5)\"],\n  \"questions\": [\n    { \"question\": \"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\", \"topic\": \"technical|experience|problem_solving|communication|culture\", \"expected\": \"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\", \"signal\": \"<string ‡∏´‡∏£‡∏∑‡∏≠ \"\">\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" },\n    { \"question\": \"<...>\", \"topic\": \"<...>\", \"expected\": \"<...>\", \"signal\": \"<...>\" }\n  ]\n}\n\n‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏á‡∏ß‡∏î:\n- ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô \"\" ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î (reasons 1..5, questions = 7)\n- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô ‚Äú‡πÇ‡∏Ñ‡∏£‡∏á JSON ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‚Äù ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á \"\" ‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢\n- ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏≤‡∏Å JSON\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3760,
        1952
      ],
      "id": "8a228f65-68c4-4920-945f-3da8272ac311",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3728,
        2176
      ],
      "id": "e1a84cc8-00f8-4124-bb3b-ec71aa836678",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "OUXcWQe3XFoAc4nv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏à‡∏≤‡∏Å AI Agent (‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô Structured Output Parser ‡πÅ‡∏•‡πâ‡∏ß)\nconst data = $json;\n\n// ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 7 ‡∏Ç‡πâ‡∏≠ ‡πÄ‡∏ú‡∏∑‡πà‡∏≠ LLM ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô\nconst qs = Array.isArray(data.questions) ? data.questions.slice(0,7) : [];\n\n// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô HTML\nconst rows = qs.map((q, i) => `\n  <tr>\n    <td style=\"padding:8px 12px;vertical-align:top;width:32px\">${i+1}.</td>\n    <td style=\"padding:8px 12px\">\n      <div style=\"font-weight:600\">${q.question || '-'}</div>\n      <div style=\"font-size:12px;opacity:.8;margin-top:4px\">\n        ‡∏´‡∏°‡∏ß‡∏î: ${q.category || '-'} ‚Ä¢ ‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${q.difficulty || '-'}\n      </div>\n      ${q.rationale ? `<div style=\"font-size:12px;margin-top:6px\">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${q.rationale}</div>` : ''}\n    </td>\n  </tr>\n`).join('');\n\n// ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö HTML ‡∏ó‡∏±‡πâ‡∏á‡∏â‡∏ö‡∏±‡∏ö (‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ + ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°)\nconst html = `\n<div style=\"font-family:Segoe UI,Tahoma,Arial\">\n  <h3 style=\"margin:0 0 8px\">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå (7 ‡∏Ç‡πâ‡∏≠)</h3>\n  <div style=\"margin:0 0 10px\">\n    ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: ${data.name || '-'} |\n    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${data.position || '-'} |\n    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô AI: ${data.ai_result?.score_percent ?? data.score ?? '-'}%\n  </div>\n  <table style=\"border-collapse:collapse;width:100%;background:#fff\">${rows}</table>\n</div>\n`;\n\nreturn [{\n  json: {\n    ...data,\n    html,                           // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•\n    subject: `‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå - ${data.position || ''} / ${data.name || ''}`\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4224,
        1952
      ],
      "id": "4883e66d-67b8-4d41-8113-420e2fdf7ad9",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "25e88a71-5025-4b2a-9118-7b609440d4e7",
              "leftValue": "={{ $json.lastUpdatedAt }}",
              "rightValue": "={{ $json.submissionTime }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2608,
        1952
      ],
      "id": "cf6dabb0-e1c6-4ca9-bbce-d670484b0f8d",
      "name": "If2"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2384,
        1952
      ],
      "id": "a571edd5-0879-4111-b79a-36850f57aaf6",
      "name": "Wait1",
      "webhookId": "714b9ccc-9d72-4aea-b54d-6514bd4f62ff"
    },
    {
      "parameters": {
        "jsCode": "// ---- helper ‡∏™‡∏±‡πâ‡∏ô ‡πÜ ----\nconst get = (name) => {\n  try { return $node[name].json || {}; } catch { return {}; }\n};\n\n// ---- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á ‡πÜ ----\nconst src = get('Prepare Text from PDF1');         // name, email, position, years_exp, education\nconst aiRawNode = get('AI Agent1');\n\n// ‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á AI Agent ‡∏à‡∏∞‡∏´‡πà‡∏≠‡∏ú‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ô .output\nconst aiOut = aiRawNode.output ?? aiRawNode;\n\n// ---- normalize AI result ----\nconst reasons = Array.isArray(aiOut.reasons)\n  ? aiOut.reasons\n  : (aiOut.reasons ? [aiOut.reasons] : []);\n\nconst questions = Array.isArray(aiOut.questions) ? aiOut.questions : [];\n\nconst ai_result = {\n  score_percent: Number(aiOut.score_percent ?? 0),\n  verdict: String(aiOut.verdict ?? 'fail').toLowerCase(),\n  reasons,\n  questions,\n};\n\n// ---- ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ----\nconst candidate = {\n  name: src.name ?? '',\n  email: src.email ?? '',\n  position: src.position ?? '',\n  // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å candidate ‡∏Å‡πá‡πÉ‡∏™‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢\n  score: ai_result.score_percent,\n};\n\n// ---- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Edit Fields) ----\nconst cfg = get('Edit Fields');                 // ‡∏°‡∏µ WEBHOOK_URL, HR_EMAIL ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ\nconst submissionId = Date.now().toString(36);  // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ id ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß\n\nconst base = cfg.WEBHOOK_URL || 'https://YOUR-SUBDOMAIN.n8n.cloud/webhook/hr-decision';\nconst q = (o) => Object.entries(o)\n  .map(([k,v]) => `${encodeURIComponent(k)}=${encodeURIComponent(String(v??''))}`)\n  .join('&');\n\nconst common = { subId: submissionId, name: candidate.name, email: candidate.email, pos: candidate.position, score: ai_result.score_percent };\nconst approveUrl = `${base}?action=approve&${q(common)}`;\nconst rejectUrl  = `${base}?action=reject&${q(common)}`;\n\n// ---- ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô item ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ----\nreturn [{\n  json: {\n    submissionId,\n    candidate,\n    ai_result,\n    approveUrl,\n    rejectUrl,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4672,
        1952
      ],
      "id": "b5e212f8-4a34-4e07-9f7f-b6a118998d0a",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "fromEmail": "ai@gmail.com",
        "toEmail": "={{ $('Edit Fields').item.json.HR_EMAIL }}",
        "subject": "=[REVIEW] AI Screening ‚Äì {{ $json.name }} / {{ $json.position }} ({{ $json.score }}%)",
        "html": "=<!doctype html>\n<html lang=\"th\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n    <title>AI Screening ‚Äì Review Required</title>\n  </head>\n  <body style=\"margin:0;background:#f5f7fb;padding:24px;font-family:Segoe UI,Tahoma,Arial,sans-serif;color:#111827;\">\n    <!-- Preheader -->\n    <div style=\"display:none;max-height:0;overflow:hidden;opacity:0\">\n      ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• AI Screening ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß\n    </div>\n\n    <div style=\"max-width:680px;margin:0 auto;background:#ffffff;border:1px solid #e6e9ef;border-radius:14px;overflow:hidden;box-shadow:0 6px 24px rgba(17,24,39,.06)\">\n      <!-- Header -->\n      <div style=\"background:#4f46e5;color:#ffffff;padding:18px 22px\">\n        <div style=\"font-size:16px;font-weight:800;letter-spacing:.2px\">AI Screening ‚Äî Review Required</div>\n      </div>\n\n      <!-- Body -->\n      <div style=\"padding:22px\">\n        <!-- Candidate -->\n        <div style=\"font-size:18px;font-weight:800;margin-bottom:10px\">Candidate</div>\n\n        <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse\">\n          <tr><td style=\"padding:8px 0\"><b>Name:</b> {{ $json.name || '-' }}</td></tr>\n          <tr><td style=\"padding:8px 0\"><b>Email:</b> {{ $json.email || '-' }}</td></tr>\n          <tr><td style=\"padding:8px 0\"><b>Position:</b> {{ $json.position || '-' }}</td></tr>\n          <tr><td style=\"padding:8px 0\"><b>Experience:</b> {{ $json.years_exp ?? 0 }} years</td></tr>\n          <tr><td style=\"padding:8px 0\"><b>Education:</b> {{ $json.education || '-' }}</td></tr>\n        </table>\n\n        <hr style=\"border:none;border-top:1px solid #eef2f7;margin:18px 0\">\n\n        <!-- AI Result -->\n        <div style=\"font-size:18px;font-weight:800;margin-bottom:10px\">AI Result</div>\n\n        <div style=\"margin:2px 0\"><b>Score:</b> {{ $json.score ?? 0 }}%</div>\n        <div style=\"margin:2px 0\">\n          <b>Verdict:</b> {{ $json.verdict || '-' }}\n          <span style=\"display:inline-block;margin-left:8px;padding:2px 8px;border-radius:999px;font-size:12px;\n                       background: {{ ($json.verdict||'') === 'pass' ? '#e6fbe8' : '#fee2e2' }};\n                       color:      {{ ($json.verdict||'') === 'pass' ? '#15803d' : '#b91c1c' }};\">\n            {{ ($json.verdict||'') === 'pass' ? '‡∏ú‡πà‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô' }}\n          </span>\n        </div>\n\n        <!-- Progress bar -->\n        <div style=\"margin:10px 0 6px 0;background:#eef2f7;border-radius:8px;height:10px;overflow:hidden;\">\n          <div style=\"height:10px;background:#22c55e;width: {{ Math.min(100, Math.max(0, Number($json.score)||0)) }}%;\"></div>\n        </div>\n\n        <!-- Reasons -->\n        <div style=\"margin-top:12px\">\n          <b>Reasons:</b>\n          <ul style=\"margin:8px 0 0 18px;padding:0;line-height:1.55\">\n            {{\n              (($json.reasons || '')\n                .split('|')\n                .map(s => s.trim())\n                .filter(Boolean)\n                .map(r => `<li>${r}</li>`)\n                .join('')) || '<li>-</li>'\n            }}\n          </ul>\n        </div>\n\n        <!-- Suggested Interview Questions -->\n        <div style=\"margin-top:18px\">\n          <div style=\"font-size:18px;font-weight:800;margin-bottom:8px\">Suggested Interview Questions</div>\n          {{\n            (()=>{\n              let qs = [];\n              try { qs = JSON.parse($json.questions_json || '[]'); } catch(e) {}\n              if (!Array.isArray(qs) || !qs.length) return `<div style=\"color:#6b7280\">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>`;\n              return `<ol style=\"margin:8px 0 0 18px;padding:0;line-height:1.6\">`\n                + qs.map(q => {\n                    const topic = q?.topic ? `<span style=\"display:inline-block;background:#eef2ff;color:#3730a3;border-radius:999px;padding:2px 8px;font-size:12px;margin-right:6px\">${q.topic}</span>` : '';\n                    const expected = q?.expected ? `<div style=\"color:#6b7280;font-size:12px;margin-top:2px\">‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: ${q.expected}</div>` : '';\n                    const signal = q?.signal ? `<div style=\"color:#6b7280;font-size:12px;margin-top:2px\">‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï: ${q.signal}</div>` : '';\n                    const body = q?.question || '';\n                    return `<li style=\"margin:10px 0\"><div>${topic}${body}</div>${expected}${signal}</li>`;\n                  }).join('')\n                + `</ol>`;\n            })()\n          }}\n        </div>\n\n        <hr style=\"border:none;border-top:1px solid #eef2f7;margin:22px 0\">\n\n        <!-- Actions -->\n        <div style=\"text-align:center\">\n          <a href=\"https://n8nkrub.app.n8n.cloud/webhook-test/hr-decision?action=approve&subId={{$json.submission_id || $json.submissionId || ''}}&name={{encodeURIComponent($json.name || '')}}&email={{encodeURIComponent($json.email || '')}}&pos={{encodeURIComponent($json.position || '')}}&score={{$json.score || 0}}\"\n             style=\"display:inline-block;background:#16a34a;color:#ffffff;text-decoration:none;\n                    padding:12px 18px;border-radius:10px;font-weight:800;margin:4px 6px;min-width:220px\">\n            ‚úÖ Approve & Invite Interview\n          </a>\n          <a href=\"https://n8nkrub.app.n8n.cloud/webhook-test/hr-decision?action=reject&subId={{$json.submission_id || $json.submissionId || ''}}&name={{encodeURIComponent($json.name || '')}}&email={{encodeURIComponent($json.email || '')}}&pos={{encodeURIComponent($json.position || '')}}&score={{$json.score || 0}}\"\n             style=\"display:inline-block;background:#ef4444;color:#ffffff;text-decoration:none;\n                    padding:12px 18px;border-radius:10px;font-weight:800;margin:4px 6px;min-width:140px\">\n            ‚ùå Reject\n          </a>\n        </div>\n\n        <div style=\"color:#6b7280;font-size:12px;margin-top:16px\">\n          Submission: {{ $json.submission_id || $json.submissionId || '-' }}\n        </div>\n      </div>\n    </div>\n\n    <div style=\"height:24px\"></div>\n  </body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        5344,
        1952
      ],
      "id": "38013bc6-6e29-4138-b1da-63adf09e5bb9",
      "name": "Send email3",
      "webhookId": "3086752d-ab23-4677-b68e-ca107f75b0ed",
      "credentials": {
        "smtp": {
          "id": "cjndGMtRHrAmOvgu",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "path": "hr-decision",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2160,
        2480
      ],
      "id": "1b3c03b5-cf02-4028-b30a-8610b72b24ec",
      "name": "Webhook1",
      "webhookId": "5464317f-da8a-48e3-b10c-19336d488bd4"
    },
    {
      "parameters": {
        "jsCode": "// 1) ‡∏≠‡πà‡∏≤‡∏ô query\nconst q = $json.query || {};\nconst data = {\n  action: String(q.action || '').toLowerCase(),   // approve | reject\n  submissionId: q.subId || q.subid || '',\n  candidate: {\n    name: q.name || '',\n    email: q.email || '',\n    position: q.pos || q.position || '',\n    score: Number(q.score) || 0,\n  }\n};\n\n// 2) ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ã‡πâ‡∏≥‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥ (‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏ã‡∏™)\nconst store = globalThis.__hrClicks || (globalThis.__hrClicks = {});\nconst key = `${data.action}:${data.submissionId}:${data.candidate.email}`;\nconst duplicated = !!store[key];\nif (!duplicated) store[key] = Date.now();\n\n// 3) ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠\nreturn [{\n  json: {\n    ...data,\n    meta: { duplicated }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        2480
      ],
      "id": "5baae54c-2dd7-456c-b74d-68a2a818c83c",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "approve",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "367cc9b0-d0ec-4ca1-b392-5e5ed50cb05c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "approve"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "163892ac-ad68-4809-b3b1-434a290bfb7e",
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "reject",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reject"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        2608,
        2480
      ],
      "id": "196e1fa7-1340-4deb-bc1b-072d8632429c",
      "name": "Switch1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "adfead1d-7caf-492f-9829-29d7599cf901",
              "leftValue": "={{ $json.meta.duplicated.toBoolean() }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2832,
        2384
      ],
      "id": "4c1db176-8034-4544-ab63-7355326dda60",
      "name": "If3"
    },
    {
      "parameters": {
        "fromEmail": "ai@gmail.com",
        "toEmail": "={{$json.candidate.email}}",
        "subject": "=SPU AI CLUB ‚Äì ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{$json.candidate.position}}",
        "html": "=<!-- PASS EMAIL (pretty + email-safe, TEST URL) -->\n<table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#f5f7fb;margin:0;padding:24px;font-family:Segoe UI,Tahoma,Arial,sans-serif;\">\n  <tr>\n    <td align=\"center\">\n      <table role=\"presentation\" width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;background:#ffffff;border:1px solid #e6e9ef;border-radius:14px;overflow:hidden\">\n        <!-- Header -->\n        <tr>\n          <td align=\"center\" style=\"background:#4f46e5;color:#ffffff;padding:22px 20px\">\n            <div style=\"font-size:18px;font-weight:800;letter-spacing:.3px;\">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‚úÖ</div>\n            <div style=\"opacity:.9;font-size:13px;margin-top:6px;\">SPU AI CLUB ‚Äì Screening Result (Test)</div>\n          </td>\n        </tr>\n\n        <!-- Body -->\n        <tr>\n          <td style=\"padding:24px 22px;color:#111827;\">\n            <!-- Greeting -->\n            <div style=\"font-size:18px;font-weight:700;margin-bottom:8px\">\n              ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì {{$json.candidate.name}} üëã\n            </div>\n\n            <!-- Highlight card -->\n            <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse;margin-top:6px\">\n              <tr>\n                <td style=\"background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:16px 18px\">\n                  <div style=\"margin:2px 0\">\n                    <span style=\"display:inline-block;font-size:12px;color:#6b7280;letter-spacing:.04em;text-transform:uppercase\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</span><br>\n                    <span style=\"font-weight:700\">{{$json.candidate.position}}</span>\n                  </div>\n                  <div style=\"margin:10px 0 0 0\">\n                    <span style=\"display:inline-block;font-size:12px;color:#6b7280;letter-spacing:.04em;text-transform:uppercase\">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô AI</span><br>\n                    <span style=\"display:inline-block;font-size:32px;font-weight:800;color:#22c55e;line-height:1\">\n                      {{ $json.ai_result?.score_percent || $json.candidate?.score || '-' }}%\n                    </span>\n                  </div>\n                </td>\n              </tr>\n            </table>\n\n            <!-- Copy -->\n            <div style=\"margin-top:16px;line-height:1.7\">\n              ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á\n            </div>\n\n            <!-- CTA : ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ GET Webhook (TEST URL) -->\n            <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin:20px 0 6px 0\">\n              <tr>\n                <td align=\"center\">\n                  <a href=\"https://n8nkrub.app.n8n.cloud/webhook-test/confirm-interview?subId={{$json.submissionId}}&name={{encodeURIComponent($json.candidate.name)}}&email={{encodeURIComponent($json.candidate.email)}}&pos={{encodeURIComponent($json.candidate.position)}}&score={{$json.ai_result?.score_percent || $json.candidate?.score || ''}}\"\n                     style=\"display:inline-block;background:#16a34a;color:#ffffff;text-decoration:none;\n                            padding:12px 20px;border-radius:10px;font-weight:800;min-width:240px;text-align:center\">\n                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏ó‡∏î‡∏™‡∏≠‡∏ö)\n                  </a>\n                </td>\n              </tr>\n            </table>\n\n            <!-- Alt line + raw link fallback (TEST URL) -->\n            <div style=\"font-size:12px;color:#6b7280;margin-top:8px;line-height:1.6\">\n              ‡∏´‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå:<br>\n              <span style=\"word-break:break-all;color:#4f46e5\">\n                https://n8nkrub.app.n8n.cloud/webhook-test/confirm-interview?subId={{$json.submissionId}}&amp;name={{encodeURIComponent($json.candidate.name)}}&amp;email={{encodeURIComponent($json.candidate.email)}}&amp;pos={{encodeURIComponent($json.candidate.position)}}&amp;score={{$json.ai_result?.score_percent || $json.candidate?.score || ''}}\n              </span>\n            </div>\n\n            <!-- Divider -->\n            <div style=\"border-top:1px solid #eef2f7;margin:20px 0\"></div>\n\n            <!-- Footer -->\n            <div style=\"font-size:12px;color:#6b7280\">\n              *‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î ‚ÄúListen for test event‚Äù ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏ô‡∏î Webhook ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå*<br>\n              ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô: <a href=\"mailto:aiclub@spu.ac.th\" style=\"color:#4f46e5;text-decoration:none\">aiclub@spu.ac.th</a><br>\n              Submission ID: {{$json.submissionId}}\n            </div>\n          </td>\n        </tr>\n      </table>\n    </td>\n  </tr>\n</table>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        3056,
        2384
      ],
      "id": "4e2942cf-1e93-49e2-949c-4981e1ac0b85",
      "name": "Send email4",
      "webhookId": "10f1bfd3-278b-4033-81b4-ef9a3986fe16",
      "credentials": {
        "smtp": {
          "id": "cjndGMtRHrAmOvgu",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3504,
        2384
      ],
      "id": "5b6aa8af-2172-49eb-99b0-221bafa77a44",
      "name": "Respond to Webhook5"
    },
    {
      "parameters": {
        "jsCode": "/**\n * HR Decision (approve / reject / cancel / reschedule) + Animated HTML (centered content)\n */\n\nconst src = (() => { try { return $node[\"Webhook1\"]?.json || {}; } catch { return {}; } })();\nconst q = src.query || $json.query || {};\n\nconst toNum = (x) => Number.isFinite(Number(x)) ? Number(x) : null;\nconst esc = (v) => String(v ?? \"\")\n  .replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\")\n  .replace(/\"/g,\"&quot;\").replace(/>/g,\"&gt;\");\n\nconst action = String(q.action ?? $json.action ?? \"approve\").toLowerCase();\n\nconst candidate = {\n  name:     (q.name ?? $json?.candidate?.name ?? \"-\").toString(),\n  email:    (q.email ?? $json?.candidate?.email ?? \"\").toString(),\n  position: (q.pos ?? q.position ?? $json?.candidate?.position ?? \"-\").toString(),\n};\n\nconst score        = toNum(q.score ?? $json.score);\nconst submissionId = q.subId || q.subid || $json.submissionId || null;\n\nconst ACTIONS = {\n  approve:    { th: \"‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß\",   color: \"#22c55e\" },\n  reject:     { th: \"‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß\",    color: \"#ef4444\" },\n  cancel:     { th: \"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß\",    color: \"#f59e0b\" },\n  reschedule: { th: \"‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤\",  color: \"#3b82f6\" },\n};\nconst aKey = ([\"approve\",\"reject\",\"cancel\",\"reschedule\"].includes(action) ? action : \"approve\");\nconst meta = ACTIONS[aKey];\n\nconst paletteByAction = {\n  approve:    [\"#22c55e\",\"#86efac\",\"#34d399\",\"#16a34a\"],\n  reject:     [\"#ef4444\",\"#fecaca\",\"#f87171\",\"#dc2626\"],\n  cancel:     [\"#f59e0b\",\"#fde68a\",\"#fbbf24\",\"#d97706\"],\n  reschedule: [\"#3b82f6\",\"#93c5fd\",\"#60a5fa\",\"#2563eb\"],\n};\nconst confettiPalette = paletteByAction[aKey] ?? [\"#60a5fa\",\"#a78bfa\",\"#22c55e\",\"#f59e0b\"];\n\nconst html = `<!doctype html><html lang=\"th\"><head>\n<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>${esc(meta.th)}</title>\n<style>\n:root{\n  --bg:#0b1020;--card:#111827;--line:#334155;--muted:#9ca3af;--text:#e5e7eb;\n  --accent:${esc(meta.color)};--g1:#60a5fa33;--g2:#a78bfa33;--g3:#22c55e33;\n}\n*{box-sizing:border-box}html,body{height:100%}\nbody{\n  margin:0;background:var(--bg);color:var(--text);\n  font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans Thai\",Arial;\n  overflow:hidden;\n}\n.stage{position:fixed;inset:0;overflow:hidden;z-index:0}\n.aurora{position:absolute;inset:-20% -20%;\n  background:\n    radial-gradient(40% 60% at 20% 10%, #1d4ed880 0%, transparent 60%),\n    radial-gradient(50% 65% at 80% 0%,  #7c3aed7a 0%, transparent 60%),\n    radial-gradient(60% 60% at 0% 100%, #0ea5e97a 0%, transparent 60%),\n    radial-gradient(55% 55% at 100% 100%, #22c55e66 0%, transparent 60%);\n  filter:blur(44px) saturate(1.05);animation:drift 22s linear infinite;opacity:.9}\n@keyframes drift{\n  0%{transform:translate3d(0,0,0) rotate(0)}\n  50%{transform:translate3d(-3%,2%,0) rotate(180deg)}\n  100%{transform:translate3d(0,0,0) rotate(360deg)}\n}\n.particles{position:absolute;inset:0;pointer-events:none}\n.p{\n  position:absolute;width:6px;height:6px;border-radius:999px;\n  background:radial-gradient(#fff,#c7d2fe);opacity:.55;\n  box-shadow:0 0 12px 2px rgba(167,139,250,.45);filter:blur(.2px)\n}\n@keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-40vh)}}\n\n/* === center the whole card === */\n.centerWrap{\n  position:fixed; inset:0; z-index:2;\n  display:grid; place-items:center; padding:16px;\n}\n\n/* === card & inner content centered === */\n.card{\n  width:min(560px,92vw);\n  border-radius:18px;\n  padding:20px 22px;\n  background:\n    linear-gradient(var(--card),var(--card)) padding-box,\n    conic-gradient(from 120deg,var(--g1),var(--g2),var(--g3),var(--g1)) border-box;\n  border:1px solid transparent;\n  box-shadow:0 20px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.04);\n  animation:pop .6s cubic-bezier(.22,1,.36,1);\n\n  /* ‡πÉ‡∏à‡∏Å‡∏•‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î */\n  display:flex; flex-direction:column; align-items:center;\n  text-align:center;\n}\n@keyframes pop{from{opacity:0;transform:translateY(12px) scale(.985)}to{opacity:1;transform:translateY(0) scale(1)}}\n\n.badge{\n  display:inline-grid; place-items:center; gap:6px; grid-auto-flow:column;\n  background:var(--accent); color:#072b11; padding:8px 12px; border-radius:999px; font-weight:900;\n  align-self:center; /* ‡∏ï‡∏£‡∏∂‡∏á‡∏Å‡∏•‡∏≤‡∏á */\n}\n.badge svg{color:#072b11}\n\n.kv{margin-top:10px; line-height:1.7; text-align:center}\n.kv b{color:#fff}\n\n.muted{color:var(--muted); font-size:12px; margin-top:10px; text-align:center}\n\n.hr{height:1px; background:var(--line); margin:14px 0; border-radius:999px; opacity:.6; width:100%}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div>\n    <div class=\"particles\" id=\"particles\"></div>\n  </div>\n\n  <div class=\"centerWrap\">\n    <div class=\"card\" id=\"card\">\n      <div class=\"badge\">\n        <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\" opacity=\".25\"/>\n          <path d=\"M7 12.5l3.2 3.2L17.5 8.5\" stroke=\"currentColor\" stroke-width=\"2.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n        <span>${esc(meta.th)}</span>\n      </div>\n\n      <div class=\"kv\">\n        <div><b>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> ${esc(candidate.name)}</div>\n        <div><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</b> ${esc(candidate.position)}</div>\n        <div><b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</b> ${score ?? \"-\"}${score != null ? \"%\" : \"\"}</div>\n        ${candidate.email ? `<div class=\"muted\">${esc(candidate.email)}</div>` : ``}\n      </div>\n\n      <div class=\"hr\"></div>\n      <div class=\"muted\">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ</div>\n      ${submissionId ? `<div class=\"muted\">Ref: ${esc(submissionId)}</div>` : ``}\n    </div>\n  </div>\n\n<script>\n  // ‡∏î‡∏≤‡∏ß‡∏•‡∏≠‡∏¢\n  const part = document.getElementById('particles'); const N = 36;\n  for (let i = 0; i < N; i++) {\n    const s = document.createElement('span'); s.className = 'p';\n    s.style.left = (Math.random() * 100) + 'vw';\n    s.style.top  = (Math.random() * 100) + 'vh';\n    s.style.animation = 'floaty ' + (20 + Math.random()*16) + 's linear ' + (-Math.random()*30) + 's infinite';\n    s.style.width = s.style.height = (Math.random() > 0.6 ? 4 : 6) + 'px';\n    part.appendChild(s);\n  }\n  // ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏µ‡πâ\n  const palette = ${JSON.stringify(confettiPalette)};\n  function confetti(cx, cy){\n    const n = 24;\n    for (let i = 0; i < n; i++) {\n      const a = document.createElement('span');\n      a.style.position='fixed'; a.style.left=cx+'px'; a.style.top=cy+'px';\n      a.style.width=a.style.height='8px'; a.style.background=palette[i%palette.length];\n      a.style.borderRadius='2px'; a.style.pointerEvents='none'; a.style.zIndex=9999;\n      const dx=(Math.random()-.5)*2, dy=(Math.random()-.8)*2.6, rot=Math.random()*720;\n      a.animate(\n        [{transform:'translate(0,0) rotate(0)',opacity:1},\n         {transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],\n        {duration:650+Math.random()*250,easing:'cubic-bezier(.22,1,.36,1)'}\n      );\n      setTimeout(()=>a.remove(),900);\n      document.body.appendChild(a);\n    }\n  }\n  window.addEventListener('load', () => confetti(innerWidth/2, innerHeight/2));\n</script>\n</body></html>`;\n\n/* ---------- return ---------- */\nreturn [{\n  json: {\n    action: aKey,\n    candidate,\n    score,\n    submissionId,\n    html,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3280,
        2384
      ],
      "id": "2a8345da-3de7-4550-9e01-15cc59426c5c",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "adfead1d-7caf-492f-9829-29d7599cf901",
              "leftValue": "={{ $json.meta.duplicated.toBoolean() }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2832,
        2576
      ],
      "id": "5e8dd297-5dd8-4079-a622-8a3be736c10f",
      "name": "If5"
    },
    {
      "parameters": {
        "fromEmail": "ai@gmail.com",
        "toEmail": "={{$json.candidate.email}}",
        "subject": "=SPU AI CLUB ‚Äì ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á {{$json.candidate.position}}",
        "html": "=<!-- REJECT EMAIL (pretty + email-safe) -->\n<table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#f5f7fb;margin:0;padding:24px;font-family:Segoe UI,Tahoma,Arial,sans-serif;\">\n  <tr>\n    <td align=\"center\">\n      <table role=\"presentation\" width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;background:#ffffff;border:1px solid #e6e9ef;border-radius:14px;overflow:hidden\">\n        <!-- Header -->\n        <tr>\n          <td align=\"center\" style=\"background:#ef4444;color:#ffffff;padding:22px 20px\">\n            <div style=\"font-size:18px;font-weight:800;letter-spacing:.3px;\">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô</div>\n            <div style=\"opacity:.9;font-size:13px;margin-top:6px\">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ‚ùå</div>\n          </td>\n        </tr>\n\n        <!-- Body -->\n        <tr>\n          <td style=\"padding:24px 22px;color:#111827;\">\n            <!-- Greeting -->\n            <div style=\"font-size:18px;font-weight:700;margin-bottom:8px\">\n              ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì {{$json.candidate.name}} üëã\n            </div>\n\n            <div style=\"line-height:1.7\">\n              ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <b>{{$json.candidate.position}}</b> ‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤<br>\n              ‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô AI: {{$json.candidate.score}}%)<br>\n              ‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞ üôè\n            </div>\n\n            <!-- Highlight card -->\n            <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse:collapse;margin:16px 0 4px 0\">\n              <tr>\n                <td style=\"background:#fef2f2;border:1px solid #fecaca;border-radius:12px;padding:14px 16px\">\n                  <div style=\"font-size:12px;color:#991b1b;letter-spacing:.04em;text-transform:uppercase;margin-bottom:6px\">‡∏™‡∏£‡∏∏‡∏õ</div>\n                  <div style=\"color:#991b1b\">\n                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ\n                  </div>\n                </td>\n              </tr>\n            </table>\n\n            <!-- What next -->\n            <div style=\"margin-top:14px;line-height:1.7\">\n              ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞<br>\n              ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà\n              <a href=\"mailto:aiclub@spu.ac.th\" style=\"color:#4f46e5;text-decoration:none\">aiclub@spu.ac.th</a>\n            </div>\n\n            <!-- Divider -->\n            <div style=\"border-top:1px solid #eef2f7;margin:20px 0\"></div>\n\n            <!-- Footer -->\n            <div style=\"font-size:12px;color:#6b7280;line-height:1.6\">\n              ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡πÅ‡∏•‡∏∞‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏´‡∏ô‡πâ‡∏≤<br><br>\n              ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠<br>\n              ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô HR / SPU AI CLUB\n            </div>\n          </td>\n        </tr>\n      </table>\n    </td>\n  </tr>\n</table>",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        3056,
        2576
      ],
      "id": "ddeca03c-56af-4603-8181-5ff4b2c8342b",
      "name": "Send email5",
      "webhookId": "10f1bfd3-278b-4033-81b4-ef9a3986fe16",
      "credentials": {
        "smtp": {
          "id": "cjndGMtRHrAmOvgu",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3504,
        2576
      ],
      "id": "9bd554cc-afbe-460a-9bae-05e95ec7ee35",
      "name": "Respond to Webhook7"
    },
    {
      "parameters": {
        "jsCode": "/**\n * HR Decision: REJECT (‡∏û‡∏£‡πâ‡∏≠‡∏° Animated HTML + ‡∏≠‡∏µ‡πÄ‡∏°‡∏• HR/‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ + ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏µ‡∏ï)\n * ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå: /hr-decision?action=reject&subId=...&name=...&email=...&pos=...&score=...\n * ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å $node[\"Webhook1\"].json.query ‡πÅ‡∏•‡∏∞ $json.query\n */\n\n/* ---------- helpers ---------- */\nconst src = (() => { try { return $node[\"Webhook1\"]?.json || {}; } catch { return {}; } })();\nconst q   = src.query || $json.query || {};\n\nconst toNum = (x) => Number.isFinite(Number(x)) ? Number(x) : null;\nconst esc = (v) => String(v ?? \"\")\n  .replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\")\n  .replace(/\"/g,\"&quot;\").replace(/>/g,\"&gt;\");\n\n/* ---------- normalize ---------- */\nconst action = \"reject\"; // ‡πÇ‡∏´‡∏ô‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö reject ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞\nconst candidate = {\n  name:     (q.name ?? $json?.candidate?.name ?? \"-\").toString(),\n  email:    (q.email ?? $json?.candidate?.email ?? \"\").toString().toLowerCase(),\n  position: (q.pos ?? q.position ?? $json?.candidate?.position ?? \"-\").toString(),\n};\nconst score        = toNum(q.score ?? $json.score);\nconst submissionId = q.subId || q.subid || $json.submissionId || null;\nconst reason       = (q.reason || q.note || $json.reason || \"\").toString().trim(); // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÅ‡∏ô‡∏ö‡∏°‡∏≤\n\n/* ---------- UI meta / palette ---------- */\nconst meta = { th: \"‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß\", color: \"#ef4444\" };\nconst confettiPalette = [\"#ef4444\",\"#fecaca\",\"#f87171\",\"#dc2626\"];\n\n/* ---------- Animated HTML (center ‡∏à‡∏£‡∏¥‡∏á) ---------- */\nconst html = `<!doctype html><html lang=\"th\"><head>\n<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>${esc(meta.th)}</title>\n<style>\n:root{\n  --bg:#0b1020;--card:#111827;--line:#334155;--muted:#9ca3af;--text:#e5e7eb;\n  --accent:${esc(meta.color)};--g1:#ef444433;--g2:#f59e0b33;--g3:#a78bfa33;\n}\n*{box-sizing:border-box}html,body{height:100%}\nbody{margin:0;background:var(--bg);color:var(--text);\n     font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans Thai\",Arial;overflow:hidden}\n.stage{position:fixed;inset:0;overflow:hidden;z-index:0}\n.aurora{position:absolute;inset:-20% -20%;\n  background:\n    radial-gradient(40% 60% at 20% 10%, #ef444480 0%, transparent 60%),\n    radial-gradient(55% 65% at 80% 0%,  #7c3aed70 0%, transparent 60%),\n    radial-gradient(60% 60% at 0% 100%, #f59e0b60 0%, transparent 60%),\n    radial-gradient(55% 55% at 100% 100%, #ef444455 0%, transparent 60%);\n  filter:blur(44px) saturate(1.05);animation:drift 22s linear infinite;opacity:.9}\n@keyframes drift{0%{transform:translate3d(0,0,0) rotate(0)}\n  50%{transform:translate3d(-3%,2%,0) rotate(180deg)}\n  100%{transform:translate3d(0,0,0) rotate(360deg)}}\n.particles{position:absolute;inset:0;pointer-events:none}\n.p{position:absolute;width:6px;height:6px;border-radius:999px;background:radial-gradient(#fff,#fecaca);\n   opacity:.55;box-shadow:0 0 12px 2px rgba(248,113,113,.45);filter:blur(.2px)}\n@keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-40vh)}}\n\n.centerWrap{position:fixed;inset:0;z-index:2;display:grid;place-items:center;padding:16px}\n.card{\n  width:min(560px,92vw);\n  border-radius:18px;padding:20px 22px;\n  background:linear-gradient(var(--card),var(--card)) padding-box,\n             conic-gradient(from 120deg,var(--g1),var(--g2),var(--g3),var(--g1)) border-box;\n  border:1px solid transparent;box-shadow:0 20px 60px rgba(0,0,0,.55),inset 0 1px 0 rgba(255,255,255,.04);\n  animation:pop .6s cubic-bezier(.22,1,.36,1);\n  display:flex;flex-direction:column;align-items:center;text-align:center;\n}\n@keyframes pop{from{opacity:0;transform:translateY(12px) scale(.985)}to{opacity:1;transform:translateY(0) scale(1)}}\n.badge{display:inline-grid;place-items:center;gap:6px;grid-auto-flow:column;\n  background:var(--accent);color:#2b0a0a;padding:8px 12px;border-radius:999px;font-weight:900}\n.badge svg{color:#2b0a0a}\n.kv{margin-top:10px;line-height:1.7}\n.kv b{color:#fff}\n.muted{color:var(--muted);font-size:12px;margin-top:10px}\n.hr{height:1px;background:var(--line);margin:14px 0;border-radius:999px;opacity:.6;width:100%}\n.reason{margin-top:8px;color:#fecaca;background:#7f1d1d33;border:1px solid #7f1d1d55;border-radius:12px;padding:10px 12px}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div><div class=\"particles\" id=\"particles\"></div>\n  </div>\n  <div class=\"centerWrap\">\n    <div class=\"card\" id=\"card\">\n      <div class=\"badge\">\n        <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" aria-hidden=\"true\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\" opacity=\".25\"/>\n          <path d=\"M7 12.5l3.2 3.2L17.5 8.5\" stroke=\"currentColor\" stroke-width=\"2.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n        <span>${esc(meta.th)}</span>\n      </div>\n\n      <div class=\"kv\">\n        <div><b>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> ${esc(candidate.name)}</div>\n        <div><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</b> ${esc(candidate.position)}</div>\n        <div><b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</b> ${score ?? \"-\"}${score!=null?\"%\":\"\"}</div>\n        ${candidate.email ? `<div class=\"muted\">${esc(candidate.email)}</div>` : ``}\n      </div>\n\n      ${reason ? `<div class=\"reason\"><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> ${esc(reason)}</div>` : ``}\n      <div class=\"hr\"></div>\n      <div class=\"muted\">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ</div>\n      ${submissionId ? `<div class=\"muted\">Ref: ${esc(submissionId)}</div>` : ``}\n    </div>\n  </div>\n<script>\n  const part=document.getElementById('particles'); const N=36;\n  for(let i=0;i<N;i++){const s=document.createElement('span'); s.className='p';\n    s.style.left=(Math.random()*100)+'vw'; s.style.top=(Math.random()*100)+'vh';\n    s.style.animation='floaty '+(20+Math.random()*16)+'s linear '+(-Math.random()*30)+'s infinite';\n    s.style.width=s.style.height=(Math.random()>0.6?4:6)+'px'; part.appendChild(s);}\n\n  const palette=${JSON.stringify(confettiPalette)};\n  function confetti(cx,cy){const n=24;for(let i=0;i<n;i++){const a=document.createElement('span');\n    a.style.position='fixed';a.style.left=cx+'px';a.style.top=cy+'px';\n    a.style.width=a.style.height='8px';a.style.background=palette[i%palette.length];\n    a.style.borderRadius='2px';a.style.pointerEvents='none';a.style.zIndex=9999;\n    const dx=(Math.random()-.5)*2,dy=(Math.random()-.8)*2.6,rot=Math.random()*720;\n    a.animate([{transform:'translate(0,0) rotate(0)',opacity:1},\n      {transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],\n      {duration:650+Math.random()*250,easing:'cubic-bezier(.22,1,.36,1)'}); setTimeout(()=>a.remove(),900);\n    document.body.appendChild(a);} }\n  window.addEventListener('load',()=>confetti(innerWidth/2,innerHeight/2));\n</script>\n</body></html>`;\n\n/* ---------- HR email (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß) ---------- */\nconst hr_subject = `‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô HR ‚Äì ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò: ${candidate.name} (${candidate.position})`;\nconst hr_html = `\n  <div style=\"font-family:Segoe UI,Tahoma,Arial;color:#111;background:#fff\">\n    <div style=\"max-width:680px;margin:auto;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden\">\n      <div style=\"padding:14px 18px;background:#111827;color:#fff\">\n        <div style=\"font-weight:800\">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô HR ‚Äì ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</div>\n        <div style=\"color:#9ca3af;font-size:12px\">Submission: ${esc(submissionId || \"-\")}</div>\n      </div>\n      <div style=\"padding:18px\">\n        <p style=\"margin:.3em 0\"><b>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> ${esc(candidate.name)} &lt;${esc(candidate.email)}&gt;</p>\n        <p style=\"margin:.3em 0\"><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</b> ${esc(candidate.position)}</p>\n        <p style=\"margin:.3em 0\"><b>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</b> ${score ?? \"-\"}${score!=null?\"%\":\"\"}</p>\n        ${reason ? `<p style=\"margin:.6em 0\"><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> ${esc(reason)}</p>` : \"\"}\n        <div style=\"margin-top:12px;padding:10px 12px;border-radius:10px;background:#fee2e2;color:#991b1b;border:1px solid #fecaca;width:max-content;font-weight:700\">REJECTED</div>\n      </div>\n    </div>\n  </div>\n`;\n\n/* ---------- Candidate email (‡πÇ‡∏ó‡∏ô‡∏™‡∏∏‡∏†‡∏≤‡∏û) ---------- */\nconst cand_subject = `‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‚Äì ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ`;\nconst cand_html = `\n  <div style=\"font-family:Segoe UI,Tahoma,Arial;color:#111;background:#fff\">\n    <div style=\"max-width:680px;margin:auto;border:1px solid #e5e7eb;border-radius:14px;overflow:hidden\">\n      <div style=\"padding:16px 18px;background:#ef4444;color:#fff\">\n        <div style=\"font-weight:900\">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>\n        <div style=\"opacity:.9;font-size:12px\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ${esc(candidate.position)}</div>\n      </div>\n      <div style=\"padding:18px\">\n        <p>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏ì ${esc(candidate.name)},</p>\n        <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡∏°‡πÄ‡∏£‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì<strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</strong>‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö</p>\n        ${reason ? `<p><b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</b> ${esc(reason)}</p>` : \"\"}\n        <p>‡πÄ‡∏£‡∏≤‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ ‡πÅ‡∏•‡∏∞‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏´‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏ì‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</p>\n        <p style=\"color:#64748b;font-size:12px\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÇ‡∏õ‡∏£‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏µ‡πâ</p>\n      </div>\n    </div>\n  </div>\n`;\n\n/* ---------- return (‡πÉ‡∏´‡πâ node ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ä‡πâ) ---------- */\nreturn [{\n  json: {\n    // core data\n    action: \"reject\",\n    status: \"rejected\",\n    hr_decision: \"reject\",\n    hr_decided_at: new Date().toISOString(),\n    candidate,\n    score,\n    submissionId,\n    reason,\n\n    // emails\n    hr_subject,  hr_html,\n    cand_subject, cand_html,\n\n    // thank-you/summary page\n    html,\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3280,
        2576
      ],
      "id": "c83ef35a-34b0-44a5-843d-e2a38e6a2c98",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"score_percent\": { \"type\": \"number\", \"minimum\": 0, \"maximum\": 100 },\n    \"verdict\": { \"type\": \"string\", \"enum\": [\"pass\", \"fail\", \"unknown\"] },\n    \"reasons\": {\n      \"type\": \"array\",\n      \"items\": { \"type\": \"string\" }\n    },\n    \"questions\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"question\": { \"type\": \"string\" },\n          \"topic\":     { \"type\": \"string\" },\n          \"expected\":  { \"type\": \"string\" },\n          \"signal\":    { \"type\": \"string\" }\n        },\n        \"required\": [\"question\"]\n      }\n    }\n  },\n  \"required\": [\"score_percent\", \"verdict\"],\n  \"additionalProperties\": false\n}\n",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3856,
        2176
      ],
      "id": "e5ef0de8-5ae5-442b-ad23-8bf36b12aa4b",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3936,
        2384
      ],
      "id": "b766a9f3-b57d-444d-8785-13a70f793208",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "OUXcWQe3XFoAc4nv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/** ---------- safe getters ---------- **/\nconst gp = (o, p) => (o && p)\n  ? p.split('.').reduce((x, k) => (x && x[k] !== undefined ? x[k] : undefined), o)\n  : undefined;\nconst nz = v => v !== undefined && v !== null && String(v).trim() !== '' &&\n                String(v).trim().toLowerCase() !== 'empty';\nconst toNum = v => {\n  const n = Number(String(v ?? '').replace(/[^\\d.-]/g, '').trim());\n  return Number.isFinite(n) ? n : NaN;\n};\n\n/** ---------- pull upstream nodes (‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á) ---------- **/\nconst PT = $node[\"Prepare Text from PDF1\"]?.json || {};         // node ‡∏ó‡∏µ‡πà‡∏™‡∏Å‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å PDF/‡∏ü‡∏≠‡∏£‡πå‡∏°\nconst FO = $node[\"Fillout Trigger1\"]?.json || {};               // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Fillout ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤\n\n/** ---------- candidate basics ---------- **/\nconst submission_id = $json.submissionId || $json.subId || $json.submissionid || $json.submission_id || '';\nconst name     = $json.candidate?.name  || $json.name  || '';\nconst email    = $json.candidate?.email || $json.email || '';\nconst position = $json.candidate?.position || $json.position || '';\n\n/** ---------- years_exp: ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤ >0 ‡∏Å‡πà‡∏≠‡∏ô, ‡πÑ‡∏•‡πà fallback ---------- **/\nlet years_exp = '';\nconst candYears = toNum($json.candidate?.years_exp);\nif (Number.isFinite(candYears) && candYears > 0) {\n  years_exp = candYears;\n} else if (Number.isFinite(toNum(PT.years_exp)) && toNum(PT.years_exp) > 0) {\n  years_exp = toNum(PT.years_exp);\n} else if (Number.isFinite(toNum(gp(FO, 'questions.6zS8.value'))) && toNum(gp(FO, 'questions.6zS8.value')) > 0) {\n  years_exp = toNum(gp(FO, 'questions.6zS8.value'));\n}\n\n/** ---------- education: ‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡∏ï‡∏£‡∏¥‡∏á 'empty' ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ fallback ---------- **/\nlet education = '';\nif (nz($json.candidate?.education))      education = String($json.candidate.education);\nelse if (nz($json.education))            education = String($json.education);\nelse if (nz(PT.education))               education = String(PT.education);\nelse if (nz(gp(FO,'questions.auoa.value'))) education = String(gp(FO,'questions.auoa.value'));\n\n/** ---------- AI result ---------- **/\nconst score   = Number.isFinite(toNum($json.ai_result?.score_percent)) ? toNum($json.ai_result.score_percent) : '';\nconst verdict = nz($json.ai_result?.verdict) ? String($json.ai_result.verdict) : ($json.verdict || '');\nconst reasonsSrc = $json.ai_result?.reasons ?? $json.reasons ?? [];\nconst reasons = (Array.isArray(reasonsSrc) ? reasonsSrc : [reasonsSrc])\n  .filter(nz).map(String).join(' | ');\n\n/** ---------- questions (7 ‡∏Ç‡πâ‡∏≠) ---------- **/\nconst qRaw = $json.ai_result?.questions || $json.questions || [];\nconst norm = (i) => {\n  const q = qRaw[i] || {};\n  return {\n    question: String(q.question ?? ''),\n    topic:    String(q.topic ?? ''),\n    expected: String(q.expected ?? ''),\n    signal:   String(q.signal ?? ''),\n  };\n};\nconst q = Array.from({length:7}, (_,i)=>norm(i));\n\n/** ---------- build row ---------- **/\nconst row = {\n  timestamp: new Date().toISOString(),\n  submission_id,\n  name, email, position,\n  years_exp, education,\n  score, verdict, reasons,\n  questions_json: JSON.stringify(q),\n\n  q1: q[0].question, topic1: q[0].topic, expected1: q[0].expected, signal1: q[0].signal,\n  q2: q[1].question, topic2: q[1].topic, expected2: q[1].expected, signal2: q[1].signal,\n  q3: q[2].question, topic3: q[2].topic, expected3: q[2].expected, signal3: q[2].signal,\n  q4: q[3].question, topic4: q[3].topic, expected4: q[3].expected, signal4: q[3].signal,\n  q5: q[4].question, topic5: q[4].topic, expected5: q[4].expected, signal5: q[4].signal,\n  q6: q[5].question, topic6: q[5].topic, expected6: q[5].expected, signal6: q[5].signal,\n  q7: q[6].question, topic7: q[6].topic, expected7: q[6].expected, signal7: q[6].signal,\n};\n\nreturn [{ json: row }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4896,
        1952
      ],
      "id": "e0347f87-c382-41a8-8f67-7031c153d340",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "19z7I9obKVJzV_Zh4XCYNRSWqTDkV5_h5gDCXhprKXuY",
          "mode": "list",
          "cachedResultName": "Hr",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19z7I9obKVJzV_Zh4XCYNRSWqTDkV5_h5gDCXhprKXuY/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "‡∏ä‡∏µ‡∏ï1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/19z7I9obKVJzV_Zh4XCYNRSWqTDkV5_h5gDCXhprKXuY/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "submission_id",
              "displayName": "submission_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "position",
              "displayName": "position",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "years_exp",
              "displayName": "years_exp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "education",
              "displayName": "education",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "verdict",
              "displayName": "verdict",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "reasons",
              "displayName": "reasons",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "questions_json",
              "displayName": "questions_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q1",
              "displayName": "q1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic1",
              "displayName": "topic1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected1",
              "displayName": "expected1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal1",
              "displayName": "signal1",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q2",
              "displayName": "q2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic2",
              "displayName": "topic2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected2",
              "displayName": "expected2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal2",
              "displayName": "signal2",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q3",
              "displayName": "q3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic3",
              "displayName": "topic3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected3",
              "displayName": "expected3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal3",
              "displayName": "signal3",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q4",
              "displayName": "q4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic4",
              "displayName": "topic4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected4",
              "displayName": "expected4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal4",
              "displayName": "signal4",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q5",
              "displayName": "q5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic5",
              "displayName": "topic5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected5",
              "displayName": "expected5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal5",
              "displayName": "signal5",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q6",
              "displayName": "q6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic6",
              "displayName": "topic6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected6",
              "displayName": "expected6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal6",
              "displayName": "signal6",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "q7",
              "displayName": "q7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "topic7",
              "displayName": "topic7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "expected7",
              "displayName": "expected7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "signal7",
              "displayName": "signal7",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "submissionId",
              "displayName": "submissionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "candidate",
              "displayName": "candidate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ai_result",
              "displayName": "ai_result",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "approveUrl",
              "displayName": "approveUrl",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "rejectUrl",
              "displayName": "rejectUrl",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        5120,
        1952
      ],
      "id": "4e557d03-6aa2-4001-9bb6-418439716a1c",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "BBHeKadvAXSi0PbO",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "confirm-interview-submit",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2160,
        3024
      ],
      "id": "03cdf7b7-85ee-438e-9cb3-2638eda39b61",
      "name": "WB-Interview-POST",
      "webhookId": "01a386a3-6d89-4331-a2bd-f6a2513677b1"
    },
    {
      "parameters": {
        "path": "confirm-interview",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2160,
        2800
      ],
      "id": "7acabcff-4aec-4914-b979-2cdcf8602023",
      "name": "WB-Interview-GET",
      "webhookId": "d1ba39a7-8f96-4e65-893f-0055d252aa71"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2608,
        2800
      ],
      "id": "0b384f6e-7b35-48a4-ba21-1d017dee3e2b",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "jsCode": "// ---------- Read query params from GET ----------\nconst q = $json.query ?? {};\nconst subId = q.subId ?? q.subID ?? q.subid ?? '';\nconst name  = q.name  ?? '';\nconst email = (q.email ?? '').toLowerCase();\nconst pos   = q.pos   ?? q.position ?? '';\nconst score = Number(q.score ?? 0) || 0;\n\n// ---------- Helpers ----------\nconst esc = (s) => String(s ?? '')\n  .replace(/&/g,'&amp;')\n  .replace(/</g,'&lt;')\n  .replace(/\"/g,'&quot;')\n  .replace(/>/g,'&gt;');\n\n// ‡πÉ‡∏ä‡πâ URL production\nconst postUrl = 'https://n8nkrub.app.n8n.cloud/webhook/confirm-interview-submit';\n\n// ---------- Page HTML ----------\nconst html = `<!doctype html>\n<html lang=\"th\"><head>\n<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</title>\n<style>\n  :root{\n    --bg:#0b1020;--card:#111827;--line:#334155;--muted:#9ca3af;--text:#e5e7eb;\n    --chip:#0f172a;--ok:#16a34a;--g1:#60a5fa33;--g2:#a78bfa33;--g3:#22c55e33;\n  }\n  *{box-sizing:border-box}\n  html,body{height:100%}\n  body{\n    margin:0;background:var(--bg);color:var(--text);\n    font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans Thai\",Arial;\n    overflow:hidden;\n  }\n\n  /* --- Animated background --- */\n  .stage{position:fixed;inset:0;overflow:hidden;z-index:0}\n  .aurora{\n    position:absolute;inset:-20% -20%;\n    background:\n      radial-gradient(40% 65% at 10% 10%, #1d4ed880 0%, transparent 60%),\n      radial-gradient(55% 60% at 85% 0%,  #7c3aed80 0%, transparent 60%),\n      radial-gradient(60% 55% at 0% 100%, #0ea5e980 0%, transparent 60%),\n      radial-gradient(55% 55% at 100% 100%, #22c55e66 0%, transparent 60%);\n    filter:blur(44px) saturate(1.05);\n    animation:drift 22s linear infinite;opacity:.9\n  }\n  @keyframes drift{\n    0%{transform:translate3d(0,0,0) rotate(0)}\n    50%{transform:translate3d(-3%,2%,0) rotate(180deg)}\n    100%{transform:translate3d(0,0,0) rotate(360deg)}\n  }\n  .particles{position:absolute;inset:0;pointer-events:none}\n  .p{\n    position:absolute;width:6px;height:6px;border-radius:999px;\n    background:radial-gradient(#fff,#c7d2fe);opacity:.55;\n    box-shadow:0 0 12px 2px rgba(167,139,250,.45);filter:blur(.2px)\n  }\n  @keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-40vh)}}\n\n  /* --- Layout --- */\n  .wrap{\n    position:relative;z-index:2;min-height:100vh;\n    display:grid;place-items:center;padding:28px\n  }\n  .card{\n    width:min(620px,94vw);border-radius:18px;padding:22px;\n    background:linear-gradient(var(--card),var(--card)) padding-box,\n               conic-gradient(from 120deg,var(--g1),var(--g2),var(--g3),var(--g1)) border-box;\n    border:1px solid transparent;box-shadow:0 22px 60px rgba(0,0,0,.55),inset 0 1px 0 rgba(255,255,255,.04);\n    animation:cardIn .6s cubic-bezier(.22,1,.36,1)\n  }\n  @keyframes cardIn{from{opacity:0;transform:translateY(14px) scale(.985)}to{opacity:1;transform:translateY(0) scale(1)}}\n\n  h1{margin:0 0 6px 0;font-size:22px}\n  .muted{color:var(--muted);font-size:13px}\n  .chips{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}\n  .chip{background:var(--chip);border:1px solid var(--line);border-radius:999px;padding:4px 10px;font-size:12px}\n  .hr{height:1px;background:var(--line);margin:16px 0;border-radius:999px;opacity:.6}\n\n  .row{display:grid;gap:10px;margin-top:12px}\n  label{font-size:13px;color:#e5e7eb}\n\n  input,select{\n    width:100%;padding:10px 12px;border-radius:12px;border:1px solid #374151;\n    background:#0f172a;color:#fff;outline:none\n  }\n  input:focus,select:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.25)}\n  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}\n\n  /* --- WHITE calendar icon on datetime-local --- */\n  input[type=\"datetime-local\"]::-webkit-calendar-picker-indicator{\n    opacity:1; cursor:pointer;\n    filter: invert(1) sepia(1) saturate(0) hue-rotate(0deg) brightness(2);\n  }\n  input[type=\"datetime-local\"]::-webkit-clear-button,\n  input[type=\"datetime-local\"]::-webkit-inner-spin-button{display:none}\n\n  .btn{\n    display:inline-block;background:linear-gradient(92deg,#22c55e,#16a34a);\n    color:#06290f;border:0;border-radius:12px;padding:12px 16px;font-weight:900;cursor:pointer;\n    box-shadow:0 16px 38px rgba(22,163,74,.35), inset 0 1px 0 rgba(255,255,255,.08)\n  }\n  .btn[disabled]{opacity:.7;cursor:not-allowed}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div>\n    <div class=\"particles\" id=\"particles\"></div>\n  </div>\n\n  <div class=\"wrap\">\n    <div class=\"card\">\n      <h1>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</h1>\n      <div class=\"muted\">‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‚Äì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å (HR ‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á)</div>\n\n      <div class=\"chips\">\n        <span class=\"chip\">${esc(pos) || '‚Äî'}</span>\n        <span class=\"chip\">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${Number.isFinite(score) ? score : 0}%</span>\n      </div>\n\n      <div class=\"row\" style=\"margin-top:14px\">\n        <div><b>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> ${esc(name) || '-'}</div>\n        <div><b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> ${esc(email) || '-'}</div>\n      </div>\n\n      <div class=\"hr\"></div>\n\n      <!-- POST ‡πÑ‡∏õ production webhook -->\n      <form class=\"row\" method=\"POST\" action=\"${postUrl}\"\n            onsubmit=\"this.btn.disabled=true;this.btn.innerText='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';shootConfetti();\">\n        <div class=\"row\">\n          <label for=\"pref_dt\">‡∏ß‡∏±‡∏ô‚Äì‡πÄ‡∏ß‡∏•‡∏≤ ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å (‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)</label>\n          <input type=\"datetime-local\" name=\"pref_dt\" id=\"pref_dt\" required>\n        </div>\n\n        <div class=\"grid2\">\n          <div>\n            <label for=\"mode\">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</label>\n            <select name=\"mode\" id=\"mode\" required>\n              <option value=\"online\" selected>‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Google Meet/Zoom)</option>\n              <option value=\"onsite\">‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (On-site)</option>\n            </select>\n          </div>\n          <div>\n            <label for=\"tz\">Time zone</label>\n            <input type=\"text\" name=\"timezone\" id=\"tz\" required>\n          </div>\n        </div>\n\n        <!-- anti-bot -->\n        <input type=\"text\" name=\"website\" style=\"display:none\">\n\n        <!-- ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢ -->\n        <input type=\"hidden\" name=\"subId\" value=\"${esc(subId)}\">\n        <input type=\"hidden\" name=\"name\"  value=\"${esc(name)}\">\n        <input type=\"hidden\" name=\"email\" value=\"${esc(email)}\">\n        <input type=\"hidden\" name=\"pos\"   value=\"${esc(pos)}\">\n        <input type=\"hidden\" name=\"score\" value=\"${Number.isFinite(score) ? score : ''}\">\n\n        <div style=\"margin-top:8px\">\n          <button class=\"btn\" name=\"btn\" type=\"submit\">‡∏™‡πà‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡∏±‡∏ô/‡πÄ‡∏ß‡∏•‡∏≤</button>\n        </div>\n      </form>\n\n      <div class=\"muted\" style=\"margin-top:12px\">\n        ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏á HR ‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏ä‡∏¥‡∏ç‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì\n      </div>\n    </div>\n  </div>\n\n<script>\n  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô timezone + datetime-local\n  (function(){\n    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Asia/Bangkok';\n    document.getElementById('tz').value = tz;\n\n    const pad = n => String(n).padStart(2,'0');\n    const toLocalInput = (dt) => (\n      dt.getFullYear() + '-' + pad(dt.getMonth()+1) + '-' + pad(dt.getDate()) +\n      'T' + pad(dt.getHours()) + ':' + pad(dt.getMinutes())\n    );\n\n    // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏≠‡∏µ‡∏Å 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô min ‡∏î‡πâ‡∏ß‡∏¢\n    const nowPlus1h = new Date(Date.now() + 60*60*1000);\n    const v = toLocalInput(nowPlus1h);\n    const el = document.getElementById('pref_dt');\n    el.min = v; el.value = v;\n  })();\n\n  // ‡∏û‡∏≤‡∏£‡πå‡∏ï‡∏¥‡πÄ‡∏Ñ‡∏¥‡∏•‡∏•‡∏≠‡∏¢‡πÜ\n  const part=document.getElementById('particles'); const N=28;\n  for(let i=0;i<N;i++){\n    const s=document.createElement('span'); s.className='p';\n    s.style.left=(Math.random()*100)+'vw';\n    s.style.top =(Math.random()*100)+'vh';\n    s.style.animation='floaty '+(20+Math.random()*16)+'s linear '+(-Math.random()*30)+'s infinite';\n    s.style.width=s.style.height=(Math.random()>0.6?4:6)+'px';\n    part.appendChild(s);\n  }\n\n  // ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏¥‡πÄ‡∏•‡πá‡∏Å‡πÜ‡∏ï‡∏≠‡∏ô submit\n  function shootConfetti(){\n    const cx=innerWidth/2, cy=innerHeight/2, n=22, pal=['#60a5fa','#22c55e','#a78bfa','#f59e0b'];\n    for(let i=0;i<n;i++){\n      const a=document.createElement('span');\n      a.style.position='fixed';a.style.left=cx+'px';a.style.top=cy+'px';\n      a.style.width=a.style.height='8px';a.style.background=pal[i%pal.length];\n      a.style.borderRadius='2px';a.style.pointerEvents='none';a.style.zIndex=9999;\n      const dx=(Math.random()-.5)*2,dy=(Math.random()-.8)*2.6,rot=Math.random()*720;\n      a.animate(\n        [{transform:'translate(0,0) rotate(0)',opacity:1},\n         {transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],\n        {duration:650+Math.random()*250,easing:'cubic-bezier(.22,1,.36,1)'}\n      );\n      setTimeout(()=>a.remove(),900); document.body.appendChild(a);\n    }\n  }\n</script>\n</body></html>`;\n\nreturn [{ json: { html } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        2800
      ],
      "id": "9d506b13-b32c-476b-9612-4dcf4442c3b2",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "jsCode": "// ----- helper -----\nconst gp = (o, k) => k.split('.').reduce((a,c)=> (a && a[c]!==undefined)? a[c] : undefined, o);\nconst pickFrom = (src, ...keys) => {\n  for (const k of keys) {\n    const v = gp(src, k);\n    if (v !== undefined && v !== null && String(v).trim() !== '') return String(v).trim();\n  }\n  return '';\n};\n\n// ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á POST (body) ‡πÅ‡∏•‡∏∞ GET (query)\nconst src = $json.body ?? $json.query ?? {};\n\n// map ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ\nconst subId    = pickFrom(src, 'subId','submission_id','subid','sid');\nconst name     = pickFrom(src, 'name');\nconst email    = pickFrom(src, 'email');\nconst pos      = pickFrom(src, 'pos','position');\nconst scoreRaw = pickFrom(src, 'score');\nconst score    = Number(scoreRaw || 0) || 0;\n\nconst pref_dt  = pickFrom(src, 'pref_dt','datetime','date');   // ‚òÖ ‡πÄ‡∏ß‡∏•‡∏≤/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£\nconst timezone = pickFrom(src, 'timezone') || 'Asia/Bangkok';\nconst mode     = pickFrom(src, 'mode') || 'online';\n\n// validate ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥\nif (!pref_dt) {\n  return [{ json: { ok:false, error:'missing_pref_dt', message:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤' } }];\n}\nif (!email || !name) {\n  return [{ json: { ok:false, error:'missing_fields', message:'‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡πÄ‡∏°‡∏•' } }];\n}\n\n// ‡∏ú‡πà‡∏≤‡∏ô\nreturn [{\n  json: {\n    ok: true,\n    subId, name, email, pos, score, pref_dt, timezone, mode\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        3024
      ],
      "id": "85fb367d-550f-48f6-adc1-51cea45584bd",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "jsCode": "// ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏ô‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÇ‡∏≠‡πÄ‡∏Ñ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏¢ ‡πÜ (‡πÑ‡∏õ‡∏™‡∏≤‡∏Ç‡∏≤ error)\nif ($json.ok === false) {\n  return [{ json: $json }];\n}\n\n// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google Sheets\nconst row = {\n  timestamp: new Date().toISOString(),\n  subId:    $json.subId || '',\n  name:     $json.name || '',\n  email:    ($json.email || '').toLowerCase(),\n  pos:      $json.pos || '',\n  score:    Number($json.score) || 0,\n  pref_dt:  $json.pref_dt || '',\n  timezone: $json.timezone || 'Asia/Bangkok',\n  mode:     $json.mode || 'online',\n  status:   'pending',   // ‡∏£‡∏≠ HR confirm/‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤\n};\n\nreturn [{ json: row }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2608,
        3024
      ],
      "id": "2ee966f0-606f-4bcf-ac88-7f6d89d1a4f3",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0",
          "mode": "list",
          "cachedResultName": "interview_requests",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "‡∏ä‡∏µ‡∏ï1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "subId",
              "displayName": "subId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pos",
              "displayName": "pos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "pref_dt",
              "displayName": "pref_dt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "timezone",
              "displayName": "timezone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "mode",
              "displayName": "mode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2832,
        3024
      ],
      "id": "469c1a60-b759-473f-a1f0-2980bafac84e",
      "name": "Append row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "BBHeKadvAXSi0PbO",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "={{$json.FROM_NAME}} <aiclub@spu.ac.th>",
        "toEmail": "={{ $json.CC_EMAIL }}",
        "subject": "={{$json.subject}}",
        "html": "=<!-- HR: New Interview Request (White background / Purple header / Green CTA) -->\n<div style=\"margin:0;padding:0;background:#ffffff;\">\n  <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#ffffff;\">\n    <tr>\n      <td align=\"center\" style=\"padding:24px 16px;\">\n        <table role=\"presentation\" width=\"720\" cellpadding=\"0\" cellspacing=\"0\" style=\"width:720px;max-width:720px;background:#ffffff;border-radius:16px;overflow:hidden;border:1px solid #e5e7eb;box-shadow:0 12px 32px rgba(2,6,23,.08);font-family:Segoe UI,Roboto,'Noto Sans Thai',Tahoma,Arial,sans-serif;color:#111;\">\n          <!-- Header -->\n          <tr>\n            <td style=\"background:#5b5cf0;color:#ffffff;padding:20px 24px;border-radius:16px 16px 0 0;\">\n              <div style=\"font-size:18px;font-weight:900;letter-spacing:.2px;\">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HR ‚úÖ</div>\n              <div style=\"opacity:.95;font-size:12px;margin-top:2px;\">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏ô‡∏±‡∏î</div>\n            </td>\n          </tr>\n\n          <!-- Body -->\n          <tr>\n            <td style=\"padding:22px 24px;\">\n              <!-- Summary card -->\n              <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"border:1px solid #e5e7eb;border-radius:12px;background:#fafafa;\">\n                <tr>\n                  <td style=\"padding:16px 18px;\">\n                    <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                      <tr>\n                        <!-- Candidate -->\n                        <td style=\"vertical-align:top;padding-right:12px;\">\n                          <div style=\"font-size:12px;color:#6b7280;margin-bottom:4px;\">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>\n                          <div style=\"font-size:15px;font-weight:800;color:#111;\">\n                            {{ $json.name }}\n                            <span style=\"font-weight:600;color:#6b7280;\">({{ $json.email }})</span>\n                          </div>\n                        </td>\n                        <!-- Position -->\n                        <td style=\"vertical-align:top;padding:0 12px;\">\n                          <div style=\"font-size:12px;color:#6b7280;margin-bottom:4px;\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>\n                          <div style=\"font-size:15px;font-weight:800;color:#111;\">{{ $json.pos }}</div>\n                        </td>\n                        <!-- Score -->\n                        <td style=\"vertical-align:top;padding-left:12px;text-align:right;\">\n                          <div style=\"font-size:12px;color:#6b7280;margin-bottom:4px;\">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>\n                          <div style=\"font-size:26px;font-weight:900;color:#16a34a;line-height:1;\">{{ $json.score }}%</div>\n                        </td>\n                      </tr>\n                    </table>\n\n                    <!-- Time / TZ / Mode -->\n                    <table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-top:12px;\">\n                      <tr>\n                        <td style=\"font-size:12px;color:#6b7280;vertical-align:middle;width:160px;\">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å (‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£)</td>\n                        <td style=\"font-weight:800;color:#111;vertical-align:middle;\">{{ $json.pref_dt }}</td>\n                        <td style=\"vertical-align:middle;text-align:right;\">\n                          <span style=\"display:inline-block;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;margin-left:6px;\">\n                            {{ $json.timezone }}\n                          </span>\n                          <span style=\"display:inline-block;background:#ecfeff;color:#155e75;border:1px solid #a5f3fc;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;text-transform:lowercase;margin-left:6px;\">\n                            {{ $json.mode }}\n                          </span>\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n\n              <!-- CTA Button -->\n              <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" style=\"margin-top:16px;\">\n                <tr>\n                  <td>\n                    <a href=\"https://n8nkrub.app.n8n.cloud/webhook-test/hr-review?subId={{$json.subId}}&amp;name={{encodeURIComponent($json.name)}}&amp;email={{encodeURIComponent($json.email)}}&amp;pos={{encodeURIComponent($json.pos)}}&amp;score={{$json.score}}&amp;pref={{encodeURIComponent($json.pref_dt)}}&amp;tz={{encodeURIComponent($json.timezone)}}&amp;mode={{$json.mode}}\"\n                       style=\"display:inline-block;background:#16a34a;color:#0b2816;text-decoration:none;font-weight:900;border-radius:12px;padding:12px 18px;box-shadow:0 10px 22px rgba(22,163,74,.28);\">\n                      ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏ô‡∏±‡∏î (HR)\n                    </a>\n                  </td>\n                </tr>\n              </table>\n\n              <!-- Fallback Link -->\n              <div style=\"font-size:12px;color:#6b7280;line-height:1.7;margin-top:10px;\">\n                ‡∏´‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå:<br>\n                <span style=\"word-break:break-all;color:#374151;\">\n                  https://n8nkrub.app.n8n.cloud/webhook-test/hr-review?subId={{$json.subId}}&amp;name={{encodeURIComponent($json.name)}}&amp;email={{encodeURIComponent($json.email)}}&amp;pos={{encodeURIComponent($json.pos)}}&amp;score={{$json.score}}&amp;pref={{encodeURIComponent($json.pref_dt)}}&amp;tz={{encodeURIComponent($json.timezone)}}&amp;mode={{$json.mode}}\n                </span>\n              </div>\n\n              <!-- Footer -->\n              <div style=\"margin-top:18px;padding-top:14px;border-top:1px dashed #e5e7eb;color:#6b7280;font-size:12px;line-height:1.6;\">\n                ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á HR ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ¬∑ Ref: {{ $json.subId }}\n              </div>\n            </td>\n          </tr>\n          <!-- Bottom spacer (keeps rounded corners visible on white bg) -->\n          <tr><td style=\"height:8px;\"></td></tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</div>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        3280,
        3024
      ],
      "id": "a5d9fc86-8584-4dfd-a1c4-466d4a67d8ba",
      "name": "Send email",
      "webhookId": "cbb9f96b-2c0d-4435-b09a-7de67afe9696",
      "credentials": {
        "smtp": {
          "id": "cjndGMtRHrAmOvgu",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json.html) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3728,
        3024
      ],
      "id": "54c78d8d-5785-4130-8347-ee3ee9dc1e16",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "jsCode": "// --- ‡∏ú‡∏ô‡∏ß‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà Send email ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô $json ---\nconst HR_EMAIL  = 'aiclub@spu.ac.th';       // ‡∏≠‡∏µ‡πÄ‡∏°‡∏• HR ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö\nconst CC_EMAIL  = 'hrspuaiclub@gmail.com';  // (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡∏≠‡∏µ‡πÄ‡∏°‡∏• CC\nconst FROM_NAME = 'SPU AI CLUB HR';\n\nconst subject = `Interview request ‚Äì ${$json.name} (${ $json.pos })`;\n\n// ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ html ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô $json.html ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏à‡∏∞‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß\nconst html = $json.html ?? `\n  <div style=\"font-family:Segoe UI,Tahoma,Arial\">\n    <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</h3>\n    ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: <b>${$json.name}</b> (<b>${$json.email}</b>)<br>\n    ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${$json.pos}<br>\n    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${$json.score}%<br><br>\n    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: <b>${$json.pref_dt || '-'}</b><br>\n    ‡πÇ‡∏´‡∏°‡∏î: ${$json.mode || '-'} / ‡πÇ‡∏ã‡∏ô‡πÄ‡∏ß‡∏•‡∏≤: ${$json.timezone || '-'}\n  </div>\n`;\n\nreturn [{\n  json: {\n    ...$json,\n    HR_EMAIL, CC_EMAIL, FROM_NAME, subject, html\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3056,
        3024
      ],
      "id": "c25f0efe-8c28-436d-8228-c6275c5465a6",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "jsCode": "/**\n * Confirm Interview ‚Äî Candidate Summary (no Calendar button)\n * Output: { html } -> Respond to Webhook\n */\n\n/** ---------- collect sources safely ---------- **/\nconst srcs = [];\n\n// 1) current item\nsrcs.push($json || {});\n\n// 2) body/query ‡∏à‡∏≤‡∏Å Webhook POST/GET\nif ($json.body || $json.query) {\n  srcs.push($json.body || {});\n  srcs.push($json.query || {});\n}\n\n// 3) ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏ô‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á workflow ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ)\nfunction fromNode(name) {\n  try {\n    const a = $items(name);\n    if (Array.isArray(a) && a[0] && a[0].json) return a[0].json;\n  } catch (e) {}\n  return {};\n}\n\n// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏ô‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ü‡∏•‡πÇ‡∏•‡∏ß‡πå (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£)\nsrcs.push(fromNode('WB-Interview-POST'));     // Webhook POST\nsrcs.push(fromNode('Code in JavaScript5'));   // step ‡∏ó‡∏µ‡πà build row\nsrcs.push(fromNode('Append row in sheet1'));  // ‡∏´‡∏•‡∏±‡∏á append (pass-through)\n\n/** ---------- helpers ---------- **/\nconst gp = (obj, path) =>\n  String(path).split('.').reduce((o, k) => (o && o[k] !== undefined ? o[k] : undefined), obj);\n\nconst pick = (...paths) => {\n  for (const p of paths) {\n    for (const s of srcs) {\n      const v = gp(s, p);\n      if (v !== undefined && v !== null && String(v).trim() !== '') return v;\n    }\n  }\n  return '';\n};\n\nconst esc = s => String(s ?? '')\n  .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/\"/g,'&quot;').replace(/>/g,'&gt;');\n\nconst toNum = v => { const n = Number(v); return Number.isFinite(n) ? n : 0; };\n\n/** ---------- fields with fallbacks ---------- **/\nconst subId       = pick('subId','submission_id','submissionId','subid');\nconst name        = pick('name','candidate.name');\nconst email       = (pick('email','candidate.email') || '').toLowerCase();\nconst pos         = pick('pos','position','candidate.position');\nconst score       = Math.max(0, Math.min(100, toNum(pick('score','ai_result.score_percent'))));\n\nconst pref_dt     = pick('pref_dt');                 // 'YYYY-MM-DDTHH:mm' (‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏£‡∏∞‡∏ö‡∏∏)\nconst timezone    = pick('timezone') || 'Asia/Bangkok';\nconst mode        = pick('mode');                    // online / onsite / hybrid\nconst meetUrl     = pick('meet_url','meet');         // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ\nconst locationStr = pick('location','loc','place');  // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ\nconst durationMin = toNum(pick('duration','minutes')) || 60; // ‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß\n\n// -------- Mailto (‡πÅ‡∏à‡πâ‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•) --------\nconst mailtoHref =\n  'mailto:aiclub@spu.ac.th'\n  + '?subject=' + encodeURIComponent(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå - ${name}`)\n  + '&body=' + encodeURIComponent(\n    [\n      `‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£: ${name}`,\n      `‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${email}`,\n      `‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${pos}`,\n      `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}%`,\n      `‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å: ${pref_dt || '-'} (${timezone})`,\n      `‡πÇ‡∏´‡∏°‡∏î: ${mode || '-'}`,\n      locationStr ? `‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${locationStr}` : '',\n      meetUrl ? `Meet: ${meetUrl}` : '',\n      `Submission: ${subId || '-'}`\n    ].filter(Boolean).join('\\n')\n  );\n\n/** ---------- page html (‡∏™‡∏ß‡∏¢ + ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô) ---------- **/\nconst html = `<!doctype html>\n<html lang=\"th\"><head>\n<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</title>\n<style>\n  :root{\n    --bg:#0b1020;--card:#111827;--line:#334155;--muted:#9ca3af;--text:#e5e7eb;\n    --ok:#16a34a;--chip:#0f172a;--g1:#60a5fa33;--g2:#a78bfa33;--g3:#22c55e33;\n  }\n  *{box-sizing:border-box} html,body{height:100%}\n  body{\n    margin:0;background:var(--bg);color:var(--text);\n    font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans Thai\",Arial;\n    overflow-x:hidden;\n  }\n\n  /* Aurora + floating stars */\n  .stage{position:fixed;inset:0;z-index:0;overflow:hidden}\n  .aurora{\n    position:absolute;inset:-20% -20%;\n    background:\n      radial-gradient(45% 60% at 10% 8%,  #1d4ed880 0%, transparent 60%),\n      radial-gradient(55% 60% at 88% 2%,  #7c3aed80 0%, transparent 60%),\n      radial-gradient(60% 55% at 0% 100%, #0ea5e980 0%, transparent 60%),\n      radial-gradient(55% 55% at 100% 100%, #22c55e66 0%, transparent 60%);\n    filter:blur(44px) saturate(1.05);animation:drift 22s linear infinite;opacity:.9\n  }\n  @keyframes drift{0%{transform:translate(0,0) rotate(0)}50%{transform:translate(-3%,2%) rotate(180deg)}100%{transform:translate(0,0) rotate(360deg)}}\n  .particles{position:absolute;inset:0;pointer-events:none}\n  .p{position:absolute;width:6px;height:6px;border-radius:999px;background:radial-gradient(#fff,#c7d2fe);opacity:.55;box-shadow:0 0 12px 2px rgba(167,139,250,.45);filter:blur(.2px)}\n  @keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-42vh)}}\n\n  /* Layout */\n  .wrap{position:relative;z-index:2;min-height:100vh;display:grid;place-items:center;padding:28px}\n  .container{width:min(920px,96vw)}\n  .card{\n    background:linear-gradient(var(--card),var(--card)) padding-box,\n               conic-gradient(from 120deg,var(--g1),var(--g2),var(--g3),var(--g1)) border-box;\n    border:1px solid transparent;border-radius:16px;padding:18px 20px;margin-top:16px;\n    box-shadow:0 22px 60px rgba(0,0,0,.55),inset 0 1px 0 rgba(255,255,255,.04);\n    animation:cardIn .6s cubic-bezier(.22,1,.36,1)\n  }\n  @keyframes cardIn{from{opacity:0;transform:translateY(12px) scale(.985)}to{opacity:1;transform:translateY(0) scale(1)}}\n\n  .h{font-size:20px;font-weight:800;margin:0 0 8px 0}\n  .sub{color:var(--muted);font-size:13px;margin-bottom:6px}\n\n  .row{display:grid;grid-template-columns:180px 1fr;gap:8px 14px;align-items:center}\n  .grid{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center}\n\n  .bar{height:8px;background:#0f172a;border-radius:999px;overflow:hidden}\n  .bar>i{display:block;height:8px;background:#22c55e;width:${score}%}\n\n  .chips{display:flex;gap:8px;flex-wrap:wrap}\n  .chip{background:var(--chip);border:1px solid var(--line);border-radius:999px;padding:4px 10px;font-size:12px}\n\n  .btn{display:inline-block;border:0;border-radius:12px;padding:12px 16px;font-weight:900;text-decoration:none}\n  .btn.primary{background:linear-gradient(92deg,#22c55e,#16a34a);color:#06290f;box-shadow:0 16px 38px rgba(22,163,74,.35),inset 0 1px 0 rgba(255,255,255,.08)}\n  .muted{color:var(--muted);font-size:12px}\n\n  .cta{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div>\n    <div class=\"particles\" id=\"particles\"></div>\n  </div>\n\n  <div class=\"wrap\">\n    <div class=\"container\">\n      <div class=\"card\">\n        <div class=\"h\">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ</div>\n        <div class=\"sub\">‡πÄ‡∏£‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"h\" style=\"margin-bottom:6px\">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>\n        <div class=\"row\">\n          <div>‡∏ä‡∏∑‡πà‡∏≠</div>       <div>${esc(name) || '-'}</div>\n          <div>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>     <div>${esc(email) || '-'}</div>\n          <div>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>   <div>${esc(pos) || '-'}</div>\n          <div>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>\n          <div class=\"grid\">\n            <div class=\"bar\"><i></i></div>\n            <div>${score}%</div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"h\" style=\"margin-bottom:6px\">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</div>\n        <div class=\"row\">\n          <div>‡∏ß‡∏±‡∏ô‚Äì‡πÄ‡∏ß‡∏•‡∏≤</div> <div>${esc(pref_dt) || '-'}</div>\n          <div>‡πÇ‡∏´‡∏°‡∏î</div>\n          <div class=\"chips\">\n            <span class=\"chip\">${esc(mode) || '-'}</span>\n            <span class=\"chip\">‡πÇ‡∏ã‡∏ô‡πÄ‡∏ß‡∏•‡∏≤: ${esc(timezone)}</span>\n            ${locationStr ? `<span class=\"chip\">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${esc(locationStr)}</span>` : ``}\n            ${meetUrl     ? `<span class=\"chip\">Meet: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ô‡∏ö</span>` : ``}\n            <span class=\"chip\">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤: ${durationMin} ‡∏ô‡∏≤‡∏ó‡∏µ</span>\n          </div>\n        </div>\n\n        <div class=\"cta\">\n          <a class=\"btn primary\" href=\"${mailtoHref}\">‡πÅ‡∏à‡πâ‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</a>\n          <span class=\"muted\">* ‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á HR ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£</span>\n        </div>\n      </div>\n\n      <div class=\"card\">\n        <div class=\"h\" style=\"margin-bottom:6px\">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>\n        <div class=\"row\">\n          <div>Submission</div><div>${esc(subId) || '-'}</div>\n          <div>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô</div><div><a href=\"mailto:aiclub@spu.ac.th\" style=\"color:#93c5fd\">aiclub@spu.ac.th</a></div>\n        </div>\n        <div class=\"muted\" style=\"margin-top:10px\">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: HR ‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤/‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>\n      </div>\n    </div>\n  </div>\n\n<script>\n  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏≤‡∏ß‡∏•‡∏≠‡∏¢‡πÜ\n  const part=document.getElementById('particles'); const N=34;\n  for(let i=0;i<N;i++){\n    const s=document.createElement('span'); s.className='p';\n    s.style.left=(Math.random()*100)+'vw';\n    s.style.top =(Math.random()*100)+'vh';\n    s.style.animation='floaty '+(20+Math.random()*16)+'s linear '+(-Math.random()*30)+'s infinite';\n    s.style.width=s.style.height=(Math.random()>0.6?4:6)+'px';\n    part.appendChild(s);\n  }\n  // ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏ï‡∏ï‡∏¥‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î\n  function confetti(cx,cy){\n    const pal=['#60a5fa','#22c55e','#a78bfa','#f59e0b'], n=24;\n    for(let i=0;i<n;i++){\n      const a=document.createElement('span');\n      a.style.position='fixed';a.style.left=cx+'px';a.style.top=cy+'px';\n      a.style.width=a.style.height='8px';a.style.background=pal[i%pal.length];\n      a.style.borderRadius='2px';a.style.pointerEvents='none';a.style.zIndex=9999;\n      const dx=(Math.random()-.5)*2,dy=(Math.random()-.8)*2.6,rot=Math.random()*720;\n      a.animate(\n        [{transform:'translate(0,0) rotate(0)',opacity:1},\n         {transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],\n        {duration:650+Math.random()*250,easing:'cubic-bezier(.22,1,.36,1)'}\n      );\n      setTimeout(()=>a.remove(),900);\n      document.body.appendChild(a);\n    }\n  }\n  window.addEventListener('load',()=>confetti(innerWidth/2, innerHeight/2));\n</script>\n</body></html>`;\n\n/** return to Respond to Webhook */\nreturn [{ json: { html } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3504,
        3024
      ],
      "id": "bb5ba6bf-4d86-4b7a-9526-310e238f41fa",
      "name": "Code in JavaScript10"
    },
    {
      "parameters": {
        "path": "hr-review",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2160,
        3248
      ],
      "id": "883f35ba-7b11-42e3-a694-776af19a62ff",
      "name": "HR Admin ‚Äì GET",
      "webhookId": "3919e938-9ce7-44e5-a2b2-1e19b5626c71"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0",
          "mode": "list",
          "cachedResultName": "interview_requests",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "‡∏ä‡∏µ‡∏ï1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "status",
              "lookupValue": "pending"
            }
          ]
        },
        "options": {
          "dataLocationOnSheet": {
            "values": {
              "rangeDefinition": "detectAutomatically"
            }
          },
          "outputFormatting": {
            "values": {
              "general": "UNFORMATTED_VALUE",
              "date": "FORMATTED_STRING"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2384,
        3248
      ],
      "id": "4303d0f6-1854-43ad-a2f0-c5c2f774fd33",
      "name": "Get row(s) in sheet",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "BBHeKadvAXSi0PbO",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/**\n * HR Review page (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô / ‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô) ‚Äî UI ‡∏™‡∏ß‡∏¢ + ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô + ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á particles/aurora\n * Output: { html } -> ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö Respond to Webhook\n */\n\n/* ================= Helpers ================= */\nconst esc = (s) => String(s ?? '')\n  .replace(/&/g,'&amp;').replace(/</g,'&lt;')\n  .replace(/\"/g,'&quot;').replace(/>/g,'&gt;');\n\nconst toNum = (v, d=0) => { const n = Number(v); return Number.isFinite(n) ? n : d; };\n\n/* ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ */\nconst TH_MONTH = ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];\nconst TH_MON_MAP = { '‡∏°.‡∏Ñ.':1,'‡∏Å.‡∏û.':2,'‡∏°‡∏µ.‡∏Ñ.':3,'‡πÄ‡∏°.‡∏¢.':4,'‡∏û.‡∏Ñ.':5,'‡∏°‡∏¥.‡∏¢.':6,'‡∏Å.‡∏Ñ.':7,'‡∏™.‡∏Ñ.':8,'‡∏Å.‡∏¢.':9,'‡∏ï.‡∏Ñ.':10,'‡∏û.‡∏¢.':11,'‡∏ò.‡∏Ñ.':12 };\nconst zz = (n) => String(n).padStart(2,'0');\n\n/* ---- parse ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ó‡∏ô‡∏ñ‡∏∂‡∏Å ---- */\nfunction parsePrefDT(s){\n  if(!s) return null;\n  const t = String(s).trim();\n\n  let m = t.match(/^(\\d{4})-(\\d{2})-(\\d{2})[ T](\\d{2}):(\\d{2})/);\n  if(m){ const y=+m[1], M=+m[2], d=+m[3], h=+m[4], mi=+m[5];\n    return { y, M, d, h, mi, ts: Date.UTC(y, M-1, d, h, mi, 0) };\n  }\n\n  m = t.match(/^(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})(?:[ T](\\d{1,2}):(\\d{2}))?/);\n  if(m){ let d=+m[1], M=+m[2], y=+m[3], h=+(m[4] ?? 0), mi=+(m[5] ?? 0);\n    if(y>2400) y -= 543; return { y, M, d, h, mi, ts: Date.UTC(y, M-1, d, h, mi, 0) };\n  }\n\n  m = t.match(/^(\\d{1,2})\\s*(‡∏°\\.‡∏Ñ\\.|‡∏Å\\.‡∏û\\.|‡∏°‡∏µ\\.‡∏Ñ\\.|‡πÄ‡∏°\\.‡∏¢\\.|‡∏û\\.‡∏Ñ\\.|‡∏°‡∏¥\\.‡∏¢\\.|‡∏Å\\.‡∏Ñ\\.|‡∏™\\.‡∏Ñ\\.|‡∏Å\\.‡∏¢\\.|‡∏ï\\.‡∏Ñ\\.|‡∏û\\.‡∏¢\\.|‡∏ò\\.‡∏Ñ\\.)\\s*(\\d{4})(?:\\s+(\\d{1,2}):(\\d{2}))?/);\n  if(m){ let d=+m[1], M=TH_MON_MAP[m[2]]||1, y=+m[3], h=+(m[4] ?? 0), mi=+(m[5] ?? 0);\n    if(y>2400) y -= 543; return { y, M, d, h, mi, ts: Date.UTC(y, M-1, d, h, mi, 0) };\n  }\n\n  m = t.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n  if(m){ const y=+m[1], M=+m[2], d=+m[3]; return { y, M, d, h:0, mi:0, ts: Date.UTC(y, M-1, d, 0, 0, 0) }; }\n\n  const d = new Date(t);\n  if(!isNaN(d.getTime())){\n    const y=d.getFullYear(), M=d.getMonth()+1, dd=d.getDate(), h=d.getHours(), mi=d.getMinutes();\n    return { y, M, d:dd, h, mi, ts: Date.UTC(y, M-1, dd, h, mi, 0) };\n  }\n  return null;\n}\nfunction fmtThai(input){\n  const p = parsePrefDT(input);\n  if(!p) return '-';\n  return `${p.d} ${TH_MONTH[p.M-1]} ${p.y+543} ${zz(p.h)}:${zz(p.mi)}`;\n}\n\nfunction pickPrefRaw(row){\n  const CAND_KEYS = ['pref_dt','pref','preferred_dt','preferred','interview_dt','interview_datetime','datetime','date_time','start_at','start_time','schedule','slot','appointment'];\n  for(const k of CAND_KEYS){ if(row[k]) return String(row[k]).trim(); }\n  for(const [k,v] of Object.entries(row)){\n    const s = String(v??'');\n    if( /\\d{4}-\\d{2}-\\d{2}[ T]\\d{2}:\\d{2}/.test(s) ||\n        /\\d{1,2}[\\/\\-]\\d{1,2}[\\/\\-]\\d{4}(?:[ T]\\d{1,2}:\\d{2})?/.test(s) ||\n        /\\d{1,2}\\s*[\\u0E00-\\u0E7F\\.]+\\s*\\d{4}(?:\\s+\\d{1,2}:\\d{2})?/.test(s) ){\n      return s.trim();\n    }\n  }\n  return '';\n}\n\nconst badge = (txt) => `<span class=\"chip\">${esc(txt)}</span>`;\n\n/* === config === */\nconst WEBHOOK_BASE = 'https://n8nkrub.app.n8n.cloud/webhook';\n\n/* query string builder */\nfunction qs(obj){\n  return Object.entries(obj||{})\n    .filter(([k,v]) => v!==undefined && v!==null && String(v)!=='')\n    .map(([k,v]) => encodeURIComponent(k)+'='+encodeURIComponent(String(v)))\n    .join('&');\n}\n\n/* ‡∏õ‡∏∏‡πà‡∏° POST (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô) */\nfunction oneForm(actionPath, r, label, cssClass){\n  const h = (k,v)=>`<input type=\"hidden\" name=\"${k}\" value=\"${esc(v)}\">`;\n  return `\n    <form method=\"POST\" action=\"${WEBHOOK_BASE}/${actionPath}\" style=\"display:inline\" onsubmit=\"this._btn.disabled=true\" aria-label=\"${label}\">\n      ${h('row_number', r.row_number)}\n      ${h('subId',      r.subId)}\n      ${h('name',       r.name)}\n      ${h('email',      r.email)}\n      ${h('pos',        r.pos)}\n      ${h('pref',       r.pref_raw)}\n      ${h('tz',         r.tz)}\n      ${h('mode',       r.mode)}\n      ${h('score',      r.score)}\n      <button class=\"btn ${cssClass}\" name=\"_btn\" type=\"submit\">${label}</button>\n    </form>`;\n}\n\n/* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏ñ‡∏ß */\nfunction rowActions(r){\n  const q = qs({ subId:r.subId, name:r.name, email:r.email, pos:r.pos, score:r.score, pref:r.pref_raw, tz:r.tz, mode:r.mode, row_number:r.row_number });\n  return `\n    <div class=\"actions\">\n      ${oneForm('hr-confirm', r, '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', 'btn-ok')}\n      <a class=\"btn btn-alt\" href=\"${WEBHOOK_BASE}/hr-reschedule?${q}\" aria-label=\"‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô\">‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô</a>\n    </div>`;\n}\n\n/* ================= Read inputs ================= */\nconst rowsIn = (await $input.all()).map(it => it.json);\n\n/* ‡∏≠‡πà‡∏≤‡∏ô query ‡∏Ç‡∏≠‡∏á HR Admin ‚Äì GET (‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏á) */\nlet q = {};\ntry { const src = $items('HR Admin - GET')[0]; if (src?.json?.query) q = src.json.query; } catch(_) {}\n\nconst parseStatuses = (s) => String(s ?? '').split(',').map(x=>x.trim().toLowerCase()).filter(Boolean);\nconst wantStatuses = parseStatuses(q.status ?? 'pending,rescheduled');\nconst wantMode   = (q.mode || '').toLowerCase();\nconst wantTz     = q.tz || '';\n\n/* ================= Normalize + filter + sort ================= */\nlet rows = rowsIn.map((r, idx) => {\n  const prefRaw = pickPrefRaw(r);\n  const p = parsePrefDT(prefRaw);\n  return {\n    _i: idx,\n    row_number: r.row_number ?? '',\n    subId:      r.subId || r.subid || r.submission_id || '',\n    name:       r.name || '',\n    email:      (r.email || '').toLowerCase(),\n    pos:        r.pos || r.position || '',\n    score:      toNum(r.score, 0),\n    mode:       String(r.mode || '').toLowerCase(),\n    tz:         r.timezone || r.tz || 'Asia/Bangkok',\n    status:     String(r.status || '').toLowerCase() || 'pending',\n    pref_raw:   prefRaw,\n    dtLabel:    fmtThai(prefRaw),\n    ts:         p ? p.ts : 0,\n  };\n})\n.filter(r => (wantStatuses.length ? wantStatuses.includes(r.status) : true))\n.filter(r => (wantMode ? r.mode===wantMode : true))\n.filter(r => (wantTz ? r.tz===wantTz : true))\n.sort((a,b) => a.ts - b.ts);\n\n/* ================= Render HTML (with aurora + particles) ================= */\nconst html = `<!doctype html>\n<html lang=\"th\"><head>\n<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>HR Review ‚Äì ${esc(wantStatuses.join(', ') || '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')}</title>\n<style>\n  :root{\n    --bg:#0b1020; --card:#111827; --muted:#9ca3af; --ok:#16a34a; --line:#334155;\n    --accent:#60a5fa; --accent2:#22c55e;\n    --fontstack: ui-sans-serif, -apple-system, \"Segoe UI\", Roboto, \"Noto Sans Thai\", \"Noto Sans\", Arial, sans-serif;\n  }\n  *{box-sizing:border-box}\n  body{\n    margin:0; color:#e5e7eb; font-family:var(--fontstack);\n    background:var(--bg);\n    min-height:100vh;\n  }\n\n  /* ===== background stage (aurora + particles) ===== */\n  .stage{position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden}\n  .aurora{\n    position:absolute; inset:-20% -20%;\n    background:\n      radial-gradient(40% 60% at 20% 10%, #1d4ed880 0%, transparent 60%),\n      radial-gradient(50% 65% at 80% 0%,  #7c3aed7a 0%, transparent 60%),\n      radial-gradient(60% 60% at 0% 100%, #0ea5e97a 0%, transparent 60%),\n      radial-gradient(55% 55% at 100% 100%, #22c55e66 0%, transparent 60%);\n    filter:blur(44px) saturate(1.05);\n    animation:drift 22s linear infinite;\n    opacity:.85;\n  }\n  @keyframes drift{\n    0%{transform:translate3d(0,0,0) rotate(0)}\n    50%{transform:translate3d(-3%,2%,0) rotate(180deg)}\n    100%{transform:translate3d(0,0,0) rotate(360deg)}\n  }\n  .particles{position:absolute; inset:0}\n  .p{\n    position:absolute; width:6px; height:6px; border-radius:999px;\n    background:radial-gradient(#fff,#c7d2fe);\n    box-shadow:0 0 12px 2px rgba(167,139,250,.45);\n    opacity:.6; filter:blur(.2px);\n    animation:floaty linear infinite;\n  }\n  @keyframes floaty{ from{transform:translateY(0)} to{transform:translateY(-40vh)} }\n\n  .wrap{max-width:1024px;margin:34px auto;padding:0 16px; position:relative; z-index:2}\n  .card{\n    background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)) var(--card);\n    border:1px solid rgba(148,163,184,.22);\n    border-radius:16px; overflow:hidden;\n    box-shadow:0 16px 60px rgba(2,6,23,.45);\n    backdrop-filter: blur(6px);\n    animation: popIn .5s ease both;\n  }\n  @keyframes popIn{from{opacity:0; transform:translateY(6px) scale(.98)} to{opacity:1; transform:translateY(0) scale(1)}}\n\n  .head{padding:18px 20px;border-bottom:1px solid var(--line); position:sticky; top:0; background:rgba(17,24,39,.9); backdrop-filter: blur(6px); z-index:5}\n  .title{font-size:18px;font-weight:800;display:flex;align-items:center;gap:10px}\n  .title:after{content:\"\";width:8px;height:8px;border-radius:999px;background:linear-gradient(45deg,var(--accent),var(--accent2)); box-shadow:0 0 12px rgba(96,165,250,.8)}\n  .muted{color:var(--muted);font-size:12px}\n\n  .table-wrap{overflow:auto}\n  table{width:100%;border-collapse:collapse;min-width:920px}\n  th,td{padding:14px;border-bottom:1px solid var(--line);vertical-align:middle}\n  th{color:#cbd5e1;font-size:13px;text-align:left;background:#0f172a;position:sticky;top:56px;z-index:4}\n  tr:hover td{background:rgba(148,163,184,.06)}\n  .rowitem{opacity:0; transform:translateY(6px) scale(.99);}\n  .rowitem.show{opacity:1; transform:none; transition:opacity .45s ease, transform .45s ease}\n\n  .chip{\n    display:inline-block;background:#0f172a;border:1px solid #334155;border-radius:999px;\n    padding:2px 10px;font-size:12px; color:#cbd5e1;\n    box-shadow:inset 0 0 0 1px rgba(255,255,255,.02);\n  }\n\n  /* Buttons unified */\n  .actions{display:flex;gap:10px;flex-wrap:wrap}\n  .btn, .btn:link, .btn:visited, .btn:active{\n    box-sizing:border-box; display:inline-flex; align-items:center; justify-content:center;\n    width:96px; height:40px; padding:0 12px;\n    border:0; outline:0; appearance:none; -webkit-appearance:none;\n    text-decoration:none; white-space:nowrap;\n    font: 800 15px/1 var(--fontstack); letter-spacing:.2px; color:#fff;\n    -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; text-rendering: optimizeLegibility;\n    border-radius:12px; position:relative; overflow:hidden; cursor:pointer;\n    transition:transform .15s ease, box-shadow .15s ease, opacity .2s ease;\n  }\n  .btn:after{content:\"\"; position:absolute; inset:0; background:radial-gradient(120px 60px at var(--x,50%) var(--y,50%), rgba(255,255,255,.15), transparent 60%); opacity:0; transition:opacity .25s ease}\n  .btn:hover{transform:translateY(-1px); box-shadow:0 10px 20px rgba(0,0,0,.28)}\n  .btn:hover:after{opacity:.6}\n  .btn:active{transform:translateY(0) scale(.98)}\n  .btn-ok{  background:linear-gradient(180deg,#22c55e,#16a34a)}\n  .btn-alt{ background:linear-gradient(180deg,#60a5fa,#3b82f6)}\n\n  .meter{height:10px;background:#0f172a;border:1px solid #334155;border-radius:9px;overflow:hidden}\n  .meter i{display:block;height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#4ade80);transition:width .9s cubic-bezier(.2,.8,.2,1)}\n  .tz{color:#93a3b8;font-size:12px}\n</style>\n</head>\n<body>\n  <!-- background -->\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div>\n    <div class=\"particles\" id=\"particles\"></div>\n  </div>\n\n  <div class=\"wrap\">\n    <div class=\"card\">\n      <div class=\"head\">\n        <div class=\"title\">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</div>\n        <div class=\"muted\">‡∏à‡∏≤‡∏Å Google Sheet: interview_requests (status = ${esc(wantStatuses.join(', ') || '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')})</div>\n      </div>\n\n      <div class=\"table-wrap\">\n        <table>\n          <thead>\n            <tr>\n              <th>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</th>\n              <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>\n              <th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ï‡∏≤‡∏° timezone ‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£)</th>\n              <th style=\"min-width:160px\">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>\n              <th>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</th>\n              <th>‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${\n              rows.length ? rows.map(r => `\n                <tr class=\"rowitem\" data-pct=\"${toNum(r.score)}\" style=\"--delay:${r._i}\">\n                  <td>\n                    <div style=\"font-weight:700\">${esc(r.name || '-')}</div>\n                    <div class=\"muted\" style=\"max-width:260px;overflow:hidden;text-overflow:ellipsis\">${esc(r.email || '')}</div>\n                  </td>\n                  <td>${esc(r.pos || '-')}</td>\n                  <td>\n                    <div>${esc(r.dtLabel || '-')}</div>\n                    <div class=\"tz\">${esc(r.tz || '')}</div>\n                  </td>\n                  <td>\n                    <div style=\"display:flex;justify-content:space-between;align-items:center;margin-bottom:6px\">\n                      <div style=\"font-weight:700\">${toNum(r.score)}%</div>\n                    </div>\n                    <div class=\"meter\"><i style=\"--pct:${toNum(r.score)}%\"></i></div>\n                  </td>\n                  <td>${badge(r.mode || '-')}</td>\n                  <td>${rowActions(r)}</td>\n                </tr>\n              `).join('') : `\n                <tr><td colspan=\"6\" class=\"muted\" style=\"text-align:center;padding:24px\">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</td></tr>\n              `\n            }\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n\n<script>\n  // generate gentle particles\n  (function(){\n    const part = document.getElementById('particles'); if(!part) return;\n    const N = 48; // ‡∏û‡∏≠‡∏î‡∏µ ‡πÜ ‡πÑ‡∏°‡πà‡∏´‡∏ô‡πà‡∏ß‡∏á\n    for(let i=0;i<N;i++){\n      const s = document.createElement('span'); s.className='p';\n      const x = Math.random()*100, y = (Math.random()*100);\n      const dur = 22 + Math.random()*16;\n      const delay = -Math.random()*30;\n      s.style.left = x+'vw'; s.style.top = y+'vh';\n      s.style.animationDuration = dur+'s';\n      s.style.animationDelay = delay+'s';\n      s.style.width = s.style.height = (Math.random()>0.7?4:6)+'px';\n      part.appendChild(s);\n    }\n  })();\n\n  // ripple on buttons\n  document.addEventListener('pointermove', (e)=>{\n    if(!(e.target instanceof Element)) return;\n    const btn = e.target.closest('.btn'); if(!btn) return;\n    const rect = btn.getBoundingClientRect();\n    btn.style.setProperty('--x', (e.clientX - rect.left) + 'px');\n    btn.style.setProperty('--y', (e.clientY - rect.top) + 'px');\n  });\n\n  // reveal rows + animate meters\n  const rows = Array.from(document.querySelectorAll('.rowitem'));\n  const io = new IntersectionObserver((entries)=>{\n    entries.forEach(en=>{\n      if(en.isIntersecting){\n        en.target.classList.add('show');\n        const i = en.target.querySelector('.meter i');\n        if(i){\n          const pct = en.target.getAttribute('data-pct') || '0';\n          requestAnimationFrame(()=>{ i.style.width = Math.max(0, Math.min(100, +pct)) + '%'; });\n        }\n        io.unobserve(en.target);\n      }\n    });\n  }, {threshold:.1});\n  rows.forEach((el, idx)=>{\n    el.style.transitionDelay = (idx * 70) + 'ms';\n    io.observe(el);\n  });\n</script>\n</body></html>`;\n\n/* ================= Output ================= */\nreturn [{ json: { html } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2608,
        3248
      ],
      "id": "a9ebe8fa-d8d0-4896-893a-90aaabe6d550",
      "name": "Code in JavaScript11"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json.html) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2832,
        3248
      ],
      "id": "fd85ed52-f5e7-44fb-8f10-55aa3abec1de",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "jsCode": "// Code node (Reschedule) ‚Äî normalize webhook POST body -> for Update row in sheet\nconst b = ($json && $json.body) ? $json.body : ($json || {});\nconst get = (k, d = '') => String(b[k] ?? d).trim();\nconst toLower = (s) => String(s || '').trim().toLowerCase();\n\nconst row_number = Number(get('row_number'));\nif (!Number.isFinite(row_number) || row_number <= 0) {\n  throw new Error('row_number ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°');\n}\n\n// ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå new_pref / pref / pref_dt)\nconst newPref = get('new_pref') || get('pref') || get('pref_dt');\n\nreturn [{\n  json: {\n    row_number,\n\n    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï\n    status: 'rescheduled',\n    hr_rescheduled_at: new Date().toISOString(),\n\n    // ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç\n    pref_dt: newPref,                                 // ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ä‡∏µ‡∏ï)\n    timezone: get('tz') || get('timezone') || 'Asia/Bangkok',\n    mode: toLower(get('mode')),\n    meet_url: get('meet_url') || get('meet'),\n    location: get('location') || get('loc'),\n    notes: get('notes') || get('note'),\n\n    // ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á\n    subId: get('subId') || get('subid'),\n    name: get('name'),\n    email: toLower(get('email')),\n    pos: get('pos') || get('position'),\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        3568
      ],
      "id": "c6c16b86-931b-4d57-a421-b6ef4e65ae91",
      "name": "Code in JavaScript12"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0",
          "mode": "list",
          "cachedResultName": "interview_requests",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "‡∏ä‡∏µ‡∏ï1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "row_number": "={{$json.row_number}}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "timestamp",
              "displayName": "timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "subId",
              "displayName": "subId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "name",
              "displayName": "name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pos",
              "displayName": "pos",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "pref_dt",
              "displayName": "pref_dt",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "timezone",
              "displayName": "timezone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "mode",
              "displayName": "mode",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "hr_confirmed_at",
              "displayName": "hr_confirmed_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "confirmed_at",
              "displayName": "confirmed_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "meet_url",
              "displayName": "meet_url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "location",
              "displayName": "location",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "notes",
              "displayName": "notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cand_subject",
              "displayName": "cand_subject",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cand_html",
              "displayName": "cand_html",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2608,
        3568
      ],
      "id": "71c650d8-1dd9-4f8d-80d4-2b0321a77321",
      "name": "Update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "BBHeKadvAXSi0PbO",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0",
          "mode": "list",
          "cachedResultName": "interview_requests",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "‡∏ä‡∏µ‡∏ï1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1eac70s67DjW1vWpNWwK70My_-DOh1SKRqUn7iBal-R0/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "subId",
              "lookupValue": "={{$json.subId}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2832,
        3568
      ],
      "id": "6811d509-48bd-4aaa-9d47-f14ef350fc69",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "BBHeKadvAXSi0PbO",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "/**\n * Code in JavaScript13 ‚Äî Confirm Result (animated success + emails)\n * ‡πÄ‡∏õ‡∏¥‡∏î Google Calendar ‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏î‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏°‡∏µ target=\"_blank\")\n * Outputs:\n *  - hr_email, hr_subject, hr_html\n *  - cand_email, cand_subject, cand_html\n *  - html (Respond to Webhook)\n *  - name, email, pos, score, pref_dt, tz, mode, meet_url, location, notes\n */\n\n/* ========== Helpers ========== */\nconst esc = (s) => String(s ?? '')\n  .replace(/&/g,'&amp;').replace(/</g,'&lt;')\n  .replace(/\"/g,'&quot;').replace(/>/g,'&gt;');\n\nconst toNum = (v, d=0) => { const n = Number(v); return Number.isFinite(n) ? n : d; };\n\nconst TH_MONTH = ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];\nconst TH_MON_MAP = { '‡∏°.‡∏Ñ.':1,'‡∏Å.‡∏û.':2,'‡∏°‡∏µ.‡∏Ñ.':3,'‡πÄ‡∏°.‡∏¢.':4,'‡∏û.‡∏Ñ.':5,'‡∏°‡∏¥.‡∏¢.':6,'‡∏Å.‡∏Ñ.':7,'‡∏™.‡∏Ñ.':8,'‡∏Å.‡∏¢.':9,'‡∏ï.‡∏Ñ.':10,'‡∏û.‡∏¢.':11,'‡∏ò.‡∏Ñ.':12 };\nconst zz = (n) => String(n).padStart(2,'0');\n\nconst pick = (obj, keys, fallback='') => {\n  for (const k of keys) {\n    const v = obj?.[k];\n    if (v !== undefined && v !== null && String(v).trim() !== '') return v;\n  }\n  return fallback;\n};\n\n/* ‡∏û‡∏≤‡∏£‡πå‡∏™‡∏´‡∏•‡∏≤‡∏¢‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï */\nfunction parsePrefDT(s){\n  if(!s) return null;\n  const t = String(s).trim();\n\n  let m = t.match(/^(\\d{4})-(\\d{2})-(\\d{2})[ T](\\d{2}):(\\d{2})/);\n  if(m){ const y=+m[1], M=+m[2], d=+m[3], h=+m[4], mi=+m[5]; return { y,M,d,h,mi }; }\n\n  m = t.match(/^(\\d{1,2})[\\/\\-](\\d{1,2})[\\/\\-](\\d{4})(?:[ T](\\d{1,2}):(\\d{2}))?/);\n  if(m){ let d=+m[1], M=+m[2], y=+m[3], h=+(m[4]??0), mi=+(m[5]??0); if(y>2400) y-=543; return { y,M,d,h,mi }; }\n\n  m = t.match(/^(\\d{1,2})\\s*(‡∏°\\.‡∏Ñ\\.|‡∏Å\\.‡∏û\\.|‡∏°‡∏µ\\.‡∏Ñ\\.|‡πÄ‡∏°\\.‡∏¢\\.|‡∏û\\.‡∏Ñ\\.|‡∏°‡∏¥\\.‡∏¢\\.|‡∏Å\\.‡∏Ñ\\.|‡∏™\\.‡∏Ñ\\.|‡∏Å\\.‡∏¢\\.|‡∏ï\\.‡∏Ñ\\.|‡∏û\\.‡∏¢\\.|‡∏ò\\.‡∏Ñ\\.)\\s*(\\d{4})(?:\\s+(\\d{1,2}):(\\d{2}))?/);\n  if(m){ let d=+m[1], M=TH_MON_MAP[m[2]]||1, y=+m[3], h=+(m[4]??0), mi=+(m[5]??0); if(y>2400) y-=543; return { y,M,d,h,mi }; }\n\n  m = t.match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\n  if(m){ const y=+m[1], M=+m[2], d=+m[3]; return { y, M:+M, d:+d, h:0, mi:0 }; }\n\n  const d = new Date(t);\n  if(!isNaN(d.getTime())){\n    return { y:d.getFullYear(), M:d.getMonth()+1, d:d.getDate(), h:d.getHours(), mi:d.getMinutes() };\n  }\n  return null;\n}\nfunction fmtThai(s){\n  const p = parsePrefDT(s);\n  if(!p) return '-';\n  return `${p.d} ${TH_MONTH[p.M-1]} ${p.y+543} ${zz(p.h)}:${zz(p.mi)}`;\n}\n\n/* Calendar link ‚Äî ‡πÉ‡∏ä‡πâ ‚Äúlocal wall time + ctz‚Äù ‡∏ó‡∏±‡πâ‡∏á start/end */\nfunction gcalLinkLocal({ pref, tz, name, email, pos, mode, meet_url, location, minutes=60 }){\n  const p = parsePrefDT(pref);\n  if(!p) return 'https://calendar.google.com/calendar/render';\n  const startLocal = new Date(p.y, p.M-1, p.d, p.h, p.mi, 0);\n  const endLocal   = new Date(startLocal.getTime() + minutes*60*1000);\n\n  const fmt = (d) =>\n    d.getFullYear() + zz(d.getMonth()+1) + zz(d.getDate()) + 'T' + zz(d.getHours()) + zz(d.getMinutes()) + '00';\n\n  const text = `Interview: ${name} (${pos})`;\n  const details = [\n    `Candidate: ${name} <${email}>`,\n    `Mode: ${String(mode||'-').toUpperCase()}`,\n    location ? `Location: ${location}` : '',\n    meet_url ? `Meet: ${meet_url}` : ''\n  ].filter(Boolean).join('\\n');\n\n  return 'https://calendar.google.com/calendar/render?action=TEMPLATE'\n       + '&text='    + encodeURIComponent(text)\n       + '&dates='   + fmt(startLocal) + '/' + fmt(endLocal)\n       + '&details=' + encodeURIComponent(details)\n       + '&ctz='     + encodeURIComponent(tz || 'Asia/Bangkok');\n}\n\n/* ‡∏î‡∏∂‡∏á‡∏Ç‡∏≠‡∏á‡∏à‡∏≤‡∏Å node ‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ */\nfunction fromNode(name){\n  try{ const it = $items(name)[0]; return it?.json || null; }catch(e){ return null; }\n}\n\n/* ========== Merge ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏î ‚Üí ‡πÄ‡∏Å‡πà‡∏≤) ========== */\nconst base  = $json || {};\nconst upd   = fromNode('Update row in sheet') || {};\nconst body  = fromNode('HR Admin - Confirm') || {};\nconst src   = Object.assign({}, base, upd, body);\n\n/* ========== Normalize ========== */\nconst name  = pick(src, ['name']);\nconst email = String(pick(src, ['email'])).toLowerCase();\nconst pos   = pick(src, ['pos','position']);\nconst score = toNum(pick(src, ['score']), 0);\n\nconst prefRaw = pick(src, [\n  'pref','pref_dt','preferred_dt','interview_dt','interview_datetime',\n  'datetime','date_time','start_at','start_time','schedule','slot','appointment'\n]);\nconst tz    = pick(src, ['tz','timezone'], 'Asia/Bangkok');\nconst mode  = String(pick(src, ['mode','mode_raw'])).toLowerCase();\nconst meet  = pick(src, ['meet_url','meet']);\nconst loc   = pick(src, ['location','loc']);\nconst notes = pick(src, ['notes','note']);\n\nconst prettyTime = fmtThai(prefRaw);\nconst calUrl = gcalLinkLocal({ pref: prefRaw, tz, name, email, pos, mode, meet_url: meet, location: loc, minutes: 60 });\n\n/* ========= Notice: ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 1‚Äì2 ‡∏ß‡∏±‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ online ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå) ========= */\nconst onlineNoLink = (mode === 'online' || mode === '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå') && !meet;\nconst meetNoticeTxt = '‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° (Google Meet) ‡∏à‡∏∞‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå 1‚Äì2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•';\n\n/* ========== Email contents ========== */\nconst hr_subject   = `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå: ${name} (${pos}) ‚Äì ${prettyTime}`;\nconst hr_html = `\n  <div style=\"font-family:Segoe UI,Tahoma,Arial,sans-serif;color:#111\">\n    <div style=\"background:#10b9810f;border:1px solid #10b98133;border-radius:12px;padding:18px\">\n      <h2 style=\"margin:0 0 8px\">HR ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</h2>\n      <p style=\"margin:.4em 0\"><b>‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</b> ${esc(name)} &lt;${esc(email)}&gt;</p>\n      <p style=\"margin:.4em 0\"><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</b> ${esc(pos)}</p>\n      <p style=\"margin:.4em 0\"><b>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤ (${esc(tz)}):</b> ${esc(prettyTime)}</p>\n      <p style=\"margin:.4em 0\"><b>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</b> ${esc(mode || '-')}</p>\n      ${loc  ? `<p style=\"margin:.4em 0\"><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</b> ${esc(loc)}</p>` : ''}\n      ${meet ? `<p style=\"margin:.4em 0\"><b>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°:</b> <a href=\"${esc(meet)}\">${esc(meet)}</a></p>` : ''}\n      ${onlineNoLink ? `<p style=\"margin:.6em 0;color:#065f46\"><i>${esc(meetNoticeTxt)}</i></p>` : ''}\n      ${notes? `<p style=\"margin:.6em 0\"><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</b> ${esc(notes)}</p>` : ''}\n      <p style=\"margin:12px 0\">\n        <a href=\"${calUrl}\" style=\"display:inline-block;background:#16a34a;color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none\">Add to Google Calendar</a>\n      </p>\n    </div>\n  </div>\n`;\n\nconst cand_subject = `‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚Äì ${prettyTime}`;\nconst cand_html = `\n  <div style=\"font-family:Segoe UI,Tahoma,Arial,sans-serif;color:#111\">\n    <div style=\"background:#111827;color:#fff;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.12)\">\n      <h2 style=\"margin:0 0 8px\">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ</h2>\n      <p style=\"margin:.4em 0\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${esc(name)}, ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß</p>\n      <p style=\"margin:.4em 0\"><b>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</b> ${esc(pos)}</p>\n      <p style=\"margin:.4em 0\"><b>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤ (${esc(tz)}):</b> ${esc(prettyTime)}</p>\n      <p style=\"margin:.4em 0\"><b>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</b> ${esc(mode || '-')}</p>\n      ${loc  ? `<p style=\"margin:.4em 0\"><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</b> ${esc(loc)}</p>` : ''}\n      ${meet ? `<p style=\"margin:.4em 0\"><b>‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°:</b> <a style=\"color:#22c55e\" href=\"${esc(meet)}\">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</a></p>` : ''}\n      ${onlineNoLink ? `<p style=\"margin:.6em 0;color:#86efac\"><i>${esc(meetNoticeTxt)}</i></p>` : ''}\n      ${notes? `<p style=\"margin:.6em 0\"><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</b> ${esc(notes)}</p>` : ''}\n      <p style=\"margin:12px 0\">\n        <a href=\"${calUrl}\" style=\"display:inline-block;background:#22c55e;color:#072b11;padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700\">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á Google Calendar</a>\n      </p>\n    </div>\n  </div>\n`;\n\n/* ========== Animated Success Page ========== */\nconst html = `<!doctype html>\n<html lang=\"th\"><head>\n<meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</title>\n<style>\n  :root{ --bg:#0b1020; --card:#111827; --line:#334155; --muted:#9ca3af; --ok:#16a34a;\n    --font: ui-sans-serif, -apple-system, \"Segoe UI\", Roboto, \"Noto Sans Thai\", \"Noto Sans\", Arial; }\n  *{box-sizing:border-box}\n  body{ margin:0; color:#e5e7eb; font-family:var(--font); min-height:100vh; overflow-x:hidden; background:var(--bg); }\n  .stage{position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden}\n  .aurora{ position:absolute; inset:-20% -20%;\n    background: radial-gradient(40% 60% at 20% 10%, #1d4ed880 0%, transparent 60%),\n               radial-gradient(50% 65% at 80% 0%,  #7c3aed7a 0%, transparent 60%),\n               radial-gradient(60% 60% at 0% 100%, #0ea5e97a 0%, transparent 60%),\n               radial-gradient(55% 55% at 100% 100%, #22c55e66 0%, transparent 60%);\n    filter:blur(44px) saturate(1.05); animation:drift 22s linear infinite; opacity:.85; }\n  @keyframes drift{0%{transform:translate3d(0,0,0) rotate(0)}50%{transform:translate3d(-3%,2%,0) rotate(180deg)}100%{transform:translate3d(0,0,0) rotate(360deg)}}\n  .particles{position:absolute; inset:0}\n  .p{ position:absolute; width:6px; height:6px; border-radius:999px; background:radial-gradient(#fff,#c7d2fe);\n      box-shadow:0 0 12px 2px rgba(167,139,250,.45); opacity:.6; filter:blur(.2px); animation:floaty linear infinite; }\n  @keyframes floaty{ from{transform:translateY(0)} to{transform:translateY(-40vh)} }\n  .wrap{min-height:100vh; display:grid; place-items:center; padding:28px; position:relative; z-index:2}\n  .card{ width:min(720px, calc(100vw - 28px)); background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)) var(--card);\n         border:1px solid rgba(148,163,184,.22); border-radius:18px; padding:22px; box-shadow:0 18px 60px rgba(2,6,23,.55);\n         backdrop-filter: blur(6px); transform: translateY(10px) scale(.985); opacity:0;\n         animation: pop .55s cubic-bezier(.2,.8,.2,1) .2s forwards; }\n  @keyframes pop{ to{transform:none; opacity:1} }\n  .head{display:flex; gap:12px; align-items:center; margin-bottom:8px}\n  .pill{display:inline-flex; align-items:center; gap:8px; font-weight:800; font-size:20px}\n  .muted{color:var(--muted)}\n  .okicon{ width:28px;height:28px;color:var(--ok) }\n  .okicon circle{stroke:currentColor; stroke-width:2; opacity:.25}\n  .okicon path{ stroke:currentColor; stroke-width:3; stroke-linecap:round; stroke-linejoin:round; stroke-dasharray:60; stroke-dashoffset:60; animation:draw .7s ease forwards .35s }\n  @keyframes draw{ to{ stroke-dashoffset: 0 } }\n  .row{ display:flex; justify-content:space-between; align-items:center; gap:12px; background:rgba(255,255,255,.04);\n        border:1px solid rgba(255,255,255,.07); border-radius:14px; padding:14px 16px; margin-top:10px;\n        box-shadow: inset 0 0 0 1px rgba(255,255,255,.02); }\n  .row .title{font-weight:800; font-size:18px}\n  .row .sub{font-size:13px; color:var(--muted)}\n  .kv{margin-top:4px}\n  .kv b{color:#cbd5e1}\n  .btn{ box-sizing:border-box; display:inline-flex; align-items:center; justify-content:center; width:160px; height:44px;\n        padding:0 14px; border:0; outline:0; border-radius:12px; cursor:pointer; color:#fff; font: 800 15px/1 var(--font);\n        letter-spacing:.2px; text-decoration:none; background:linear-gradient(180deg, #22c55e, #16a34a); position:relative; overflow:hidden;\n        transition: transform .15s ease, box-shadow .15s ease; }\n  .btn:after{ content:\"\"; position:absolute; inset:0; background:radial-gradient(130px 70px at var(--x,50%) var(--y,50%), rgba(255,255,255,.18), transparent 60%); opacity:0; transition:opacity .25s ease }\n  .btn:hover{ transform: translateY(-1px); box-shadow:0 12px 22px rgba(0,0,0,.28) }\n  .btn:hover:after{ opacity:.7 }\n  .btn:active{ transform: translateY(0) scale(.98) }\n  .foot{margin-top:10px; font-size:12px; color:var(--muted)}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div>\n    <div class=\"particles\" id=\"particles\"></div>\n  </div>\n\n  <div class=\"wrap\">\n    <div class=\"card\">\n      <div class=\"head\">\n        <svg class=\"okicon\" viewBox=\"0 0 24 24\" fill=\"none\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\n          <path d=\"M7 12.5l3.2 3.2L17.5 8.5\"/>\n        </svg>\n        <div class=\"pill\">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>\n      </div>\n      <div class=\"muted\" style=\"margin-bottom:10px\">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <b>confirmed</b> ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏•‡πâ‡∏ß</div>\n\n      <div class=\"row\">\n        <div>\n          <div class=\"title\">${esc(name)} <span class=\"muted\">‚Äî ${esc(pos)}</span></div>\n          <div class=\"sub\">‡πÄ‡∏ß‡∏•‡∏≤: ${esc(prettyTime)} (${esc(tz)}) ¬∑ ‡πÇ‡∏´‡∏°‡∏î: ${esc(mode || '-')}</div>\n          ${loc  ? `<div class=\"kv sub\"><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</b> ${esc(loc)}</div>` : ''}\n          ${meet ? `<div class=\"kv sub\"><b>‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°:</b> <a style=\"color:#60a5fa\" href=\"${esc(meet)}\">‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå</a></div>` : ''}\n          ${onlineNoLink ? `<div class=\"kv sub\" style=\"color:#86efac\"><i>${esc(meetNoticeTxt)}</i></div>` : ''}\n        </div>\n        <!-- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏î‡∏¥‡∏° (‡πÑ‡∏°‡πà‡∏°‡∏µ target=\"_blank\") -->\n        <a class=\"btn\" href=\"${calUrl}\">Add to Calendar</a>\n      </div>\n\n      <div class=\"foot\">Ref: ${esc(src.subId || src.ref || src.submission_id || '-')}</div>\n    </div>\n  </div>\n\n<script>\n  (function(){\n    const part = document.getElementById('particles'); if(!part) return;\n    const N = 40;\n    for(let i=0;i<N;i++){\n      const s = document.createElement('span'); s.className='p';\n      s.style.left = (Math.random()*100) + 'vw';\n      s.style.top  = (Math.random()*100) + 'vh';\n      s.style.animation = 'floaty ' + (22+Math.random()*16) + 's linear ' + (-Math.random()*30) + 's infinite';\n      s.style.width = s.style.height = (Math.random()>0.7?4:6)+'px';\n      part.appendChild(s);\n    }\n  })();\n\n  document.addEventListener('pointermove',(e)=>{\n    const btn = e.target.closest('.btn'); if(!btn) return;\n    const r = btn.getBoundingClientRect();\n    btn.style.setProperty('--x', (e.clientX - r.left) + 'px');\n    btn.style.setProperty('--y', (e.clientY - r.top) + 'px');\n  });\n\n  function confetti(cx,cy){\n    const pal=['#60a5fa','#22c55e','#a78bfa','#f59e0b'];\n    for(let i=0;i<24;i++){\n      const a=document.createElement('span');\n      a.style.position='fixed';a.style.left=cx+'px';a.style.top=cy+'px';\n      a.style.width=a.style.height='8px';a.style.background=pal[i%pal.length];\n      a.style.borderRadius='2px';a.style.pointerEvents='none';a.style.zIndex=9999;\n      const dx=(Math.random()-.5)*2,dy=(Math.random()-.8)*2.6,rot=Math.random()*720;\n      a.animate([{transform:'translate(0,0) rotate(0)',opacity:1},{transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],\n                {duration:650+Math.random()*250,easing:'cubic-bezier(.22,1,.36,1)'}); \n      setTimeout(()=>a.remove(),900); document.body.appendChild(a);\n    }\n  }\n  window.addEventListener('load',()=>confetti(innerWidth/2, innerHeight/2));\n</script>\n</body></html>`;\n\n/* ========== Email recipients (fallback) ========== */\nconst hr_email   = src.hr_email || 'hrspuaiclub@gmail.com';\nconst cand_email = email;\n\n/* ========== Return ========== */\nreturn [{\n  json: {\n    name, email, pos, score, pref_dt: prefRaw, tz, mode, meet_url: meet, location: loc, notes,\n    hr_email, hr_subject, hr_html,\n    cand_email, cand_subject, cand_html,\n    html\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3056,
        3568
      ],
      "id": "d211b7a7-4037-4176-bdc8-03a2d1db9ee8",
      "name": "Code in JavaScript13"
    },
    {
      "parameters": {
        "fromEmail": "aiclub@spu.ac.th",
        "toEmail": "={{$json.hr_email || 'hrspuaiclub@gmail.com'}}",
        "subject": "={{ $json.hr_subject }}",
        "html": "={{ $json.hr_html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        3280,
        3472
      ],
      "id": "f9f1e55b-5112-4d76-8b2f-0d300e8a3238",
      "name": "Send email1",
      "webhookId": "6106f678-c00e-4cc6-95b8-2be5d866450f",
      "credentials": {
        "smtp": {
          "id": "cjndGMtRHrAmOvgu",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "aiclub@spu.ac.th",
        "toEmail": "={{ $json.cand_email || $json.email }}",
        "subject": "={{ $json.cand_subject }}",
        "html": "={{ $json.cand_html }}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        3280,
        3664
      ],
      "id": "c11bf6fd-fde3-42a6-8a12-7e02cfb37675",
      "name": "Send email2",
      "webhookId": "6106f678-c00e-4cc6-95b8-2be5d866450f",
      "credentials": {
        "smtp": {
          "id": "cjndGMtRHrAmOvgu",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$node[\"Code in JavaScript13\"].json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3504,
        3664
      ],
      "id": "cabbc9c6-0fd5-4559-89c2-032f4924a88d",
      "name": "Respond to Webhook3"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "hr-confirm",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2160,
        3568
      ],
      "id": "f6f1c1b2-edc5-41e4-b613-689bb785c02e",
      "name": "HR Admin ‚Äì Comfirm",
      "webhookId": "3919e938-9ce7-44e5-a2b2-1e19b5626c71"
    },
    {
      "parameters": {
        "jsCode": "/**\n * HR Reschedule (GET) ‚Üí Code in JavaScript\n * Output: { html }  ‚Üí Respond to Webhook (text/html)\n */\nconst POST_URL = 'https://n8nkrub.app.n8n.cloud/webhook/hr-reschedule-submit';\n\nconst html = `<!doctype html>\n<html lang=\"th\">\n<head>\n<meta charset=\"utf-8\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<title>‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</title>\n<style>\n  :root{\n    --bg:#070b17; --panel:#0f172a; --card:#101827; --line:#243142;\n    --muted:#9ca3af; --text:#e5e7eb; --ok:#22c55e; --info:#60a5fa; --accent:#a78bfa;\n  }\n  *{box-sizing:border-box}\n  html,body{height:100%}\n  body{ margin:0; color:var(--text);\n    font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans Thai\",Arial;\n    overflow:hidden;\n  }\n\n  /* Aurora + particles */\n  .stage{position:fixed; inset:0; overflow:hidden; background:var(--bg);}\n  .aurora{ position:absolute; inset:-20% -20%;\n    background:\n      radial-gradient(40% 60% at 20% 10%, #1d4ed880 0%, transparent 60%),\n      radial-gradient(45% 65% at 80% 0%,  #7c3aed70 0%, transparent 60%),\n      radial-gradient(60% 60% at 0% 100%, #0ea5e980 0%, transparent 60%),\n      radial-gradient(55% 55% at 100% 100%, #22c55e55 0%, transparent 60%);\n    filter: blur(40px) saturate(1.1);\n    animation: drift 22s linear infinite; opacity:.9;\n  }\n  @keyframes drift{0%{transform:translate3d(0,0,0) rotate(0)}50%{transform:translate3d(-3%,2%,0) rotate(180deg)}100%{transform:translate3d(0,0,0) rotate(360deg)}}\n  .particles{position:absolute; inset:0; pointer-events:none}\n  .p{position:absolute; width:6px; height:6px; border-radius:999px;\n     background:linear-gradient(#fff,#c7d2fe); filter:blur(.2px); opacity:.55;\n     box-shadow:0 0 12px 2px rgba(167,139,250,.45)}\n  .p:nth-child(odd){background:linear-gradient(#a5b4fc,#fff)}\n  @keyframes floaty{ from{transform:translateY(0)} to{transform:translateY(-40vh)} }\n\n  /* Layout */\n  .wrap{position:relative; z-index:2; display:grid; place-items:center; min-height:100vh; padding:28px}\n  .card{\n    width:min(820px,96vw); border-radius:20px; padding:24px;\n    background:\n      linear-gradient(var(--card),var(--card)) padding-box,\n      conic-gradient(from 120deg, #60a5fa40, #a78bfa40, #22c55e40, #60a5fa40) border-box;\n    border:1px solid transparent;\n    box-shadow: 0 24px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.04);\n    animation: cardIn .7s cubic-bezier(.22,1,.36,1);\n    transform-style: preserve-3d;\n  }\n  @keyframes cardIn{from{opacity:0; transform:translateY(14px) scale(.985)} to{opacity:1; transform:translateY(0) scale(1)}}\n\n  .head{display:flex; align-items:center; gap:10px; margin-bottom:6px}\n  .head svg{color:#a78bfa}\n  h1{margin:0; font-size:22px; letter-spacing:.2px}\n  .sub{color:var(--muted); font-size:13px; margin-bottom:16px}\n\n  .chips{display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px}\n  .chip{background:#0c1426; border:1px solid #2a3a53; border-radius:999px; padding:4px 10px; font-size:12px; color:#cbd5e1}\n\n  .grid{display:grid; gap:14px}\n  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}\n  @media (max-width:640px){ .grid2{grid-template-columns:1fr} }\n\n  label{font-size:13px; color:#cbd5e1; display:block; margin-bottom:6px}\n  .row{display:grid; gap:6px}\n  .field{position:relative}\n\n  .input, .area{\n    width:100%; background:var(--panel); color:var(--text);\n    border:1px solid #263445; border-radius:14px; padding:12px 12px;\n    outline:0; transition: box-shadow .25s, border-color .25s, transform .08s;\n    box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);\n  }\n  .area{min-height:120px; resize:vertical}\n  .input:focus, .area:focus{\n    border-color:#60a5fa; box-shadow: 0 0 0 10px rgba(96,165,250,.14), inset 0 0 0 1px rgba(255,255,255,.04);\n  }\n\n  /* === Date/Time input: ‡πÉ‡∏ä‡πâ‡∏ò‡∏µ‡∏°‡∏î‡∏≤‡∏£‡πå‡∏Å + ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß === */\n  .dateDark{\n    color-scheme: dark; /* ‡∏ö‡∏≠‡∏Å‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡πÄ‡∏ô‡∏ô‡∏ï‡πå‡πÇ‡∏ó‡∏ô‡∏î‡∏≤‡∏£‡πå‡∏Å */\n  }\n  .dateDark::-webkit-calendar-picker-indicator{\n    filter: invert(1) brightness(2);  /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */\n    opacity:.95; cursor:pointer;\n  }\n  .dateDark::-webkit-datetime-edit, \n  .dateDark::-webkit-datetime-edit-fields-wrapper,\n  .dateDark::-webkit-datetime-edit-text{\n    color: var(--text);\n  }\n\n  /* ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å */\n  .copy{\n    position:absolute; right:8px; top:8px; width:28px; height:28px; border-radius:10px;\n    display:grid; place-items:center; color:#9ca3af; cursor:pointer;\n    background:#0c1426; border:1px solid #2a3a53; transition:.2s;\n  }\n  .copy:hover{color:#e5e7eb; border-color:#3a4b66}\n\n  /* ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏ã‡πâ‡∏≠‡∏ô (‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô/‡πÄ‡∏™‡∏£‡∏¥‡∏° indicator ‡πÄ‡∏î‡∏¥‡∏°) */\n  .calBtn{\n    position:absolute; right:44px; top:8px; width:28px; height:28px; border-radius:10px;\n    display:grid; place-items:center; cursor:pointer;\n    background:#0c1426; border:1px solid #2a3a53; transition:.2s;\n  }\n  .calBtn:hover{border-color:#3a4b66}\n  .calBtn svg{display:block}\n\n  /* Buttons */\n  .btn{\n    position:relative; display:inline-grid; place-items:center; user-select:none;\n    border:0; border-radius:14px; padding:13px 18px; font-weight:900; letter-spacing:.2px;\n    color:#fff; background:linear-gradient(92deg,#60a5fa,#3b82f6,#2563eb);\n    box-shadow:0 16px 38px rgba(37,99,235,.35), inset 0 1px 0 rgba(255,255,255,.08);\n    transition:transform .08s, filter .2s, box-shadow .2s;\n  }\n  .btn:hover{filter:saturate(1.08) brightness(1.02)}\n  .btn:active{transform:translateY(1px) scale(.997)}\n  .btn[disabled]{opacity:.7; cursor:not-allowed; filter:grayscale(.2)}\n  .btn::after{\n    content:\"\"; position:absolute; inset:0; border-radius:14px;\n    background:radial-gradient(120px 120px at var(--x,50%) var(--y,50%), rgba(255,255,255,.24), transparent 60%);\n    opacity:0; transition:opacity .25s;\n  }\n  .btn:hover::after{opacity:.18}\n\n  .footer{margin-top:12px; color:var(--muted); font-size:12px}\n  .glo{position:absolute; inset:auto 0 -40px 0; height:80px; filter:blur(28px);\n    background:radial-gradient(60% 80% at 50% 0%, #60a5fa40 0%, transparent 70%)}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\">\n    <div class=\"aurora\"></div>\n    <div class=\"particles\" id=\"particles\"></div>\n  </div>\n\n  <div class=\"wrap\">\n    <div class=\"card\" id=\"card\">\n      <div class=\"head\">\n        <svg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\">\n          <path d=\"M12 3l1.76 3.56 3.93.57-2.84 2.77.67 3.9L12 12.9 8.48 13.8l.67-3.9L6.3 7.13l3.93-.57L12 3Z\" stroke=\"currentColor\" opacity=\".7\"/>\n        </svg>\n        <h1>‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ô‡∏±‡∏î‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</h1>\n      </div>\n      <div class=\"sub\"><span id=\"candName\">-</span> ‚Äî <span id=\"candPos\">-</span></div>\n\n      <div class=\"chips\" id=\"chips\"></div>\n\n      <form id=\"f\" class=\"grid\" method=\"POST\">\n        <div class=\"row field\">\n          <label for=\"pref_dt\">‡∏ß‡∏±‡∏ô‚Äì‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)</label>\n          <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô class ‡πÄ‡∏õ‡πá‡∏ô dateDark ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß -->\n          <input class=\"input dateDark\" type=\"datetime-local\" name=\"pref_dt\" id=\"pref_dt\" required>\n          <button type=\"button\" class=\"calBtn\" id=\"calBtn\" title=\"‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà\">\n            <!-- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß -->\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\n              <rect x=\"3.5\" y=\"5.5\" width=\"17\" height=\"15\" rx=\"2.5\" stroke=\"white\" />\n              <path d=\"M7 3.5v4M17 3.5v4\" stroke=\"white\" stroke-linecap=\"round\"/>\n              <path d=\"M3.5 9.5h17\" stroke=\"white\"/>\n            </svg>\n          </button>\n          <button type=\"button\" class=\"copy\" id=\"copyBtn\" title=\"‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\">\n              <rect x=\"9\" y=\"9\" width=\"11\" height=\"11\" rx=\"2.4\" stroke=\"currentColor\" opacity=\".95\"/>\n              <rect x=\"4\" y=\"4\" width=\"11\" height=\"11\" rx=\"2.4\" stroke=\"currentColor\" opacity=\".55\"/>\n            </svg>\n          </button>\n        </div>\n\n        <div class=\"grid2\">\n          <div class=\"row\">\n            <label for=\"tz\">Time zone</label>\n            <input class=\"input\" type=\"text\" name=\"timezone\" id=\"tz\" required>\n          </div>\n          <div class=\"row\">\n            <label for=\"loc\">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</label>\n            <input class=\"input\" type=\"text\" name=\"location\" id=\"loc\" placeholder=\"Google Meet / ‡∏´‡πâ‡∏≠‡∏á / ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£\">\n          </div>\n        </div>\n\n        <div class=\"row\">\n          <label for=\"notes\">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>\n          <textarea class=\"area\" name=\"notes\" id=\"notes\" placeholder=\"‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ä‡πâ‡∏≤‡πÄ‡∏û‡∏£‡∏≤‡∏∞...\"></textarea>\n        </div>\n\n        <input type=\"text\" name=\"website\" style=\"display:none\">\n\n        <input type=\"hidden\" name=\"subId\"  id=\"subId\">\n        <input type=\"hidden\" name=\"name\"   id=\"name\">\n        <input type=\"hidden\" name=\"email\"  id=\"email\">\n        <input type=\"hidden\" name=\"pos\"    id=\"pos\">\n        <input type=\"hidden\" name=\"score\"  id=\"score\">\n        <input type=\"hidden\" name=\"mode\"   id=\"mode\">\n        <input type=\"hidden\" name=\"pref\"   id=\"pref_old\">\n\n        <div><button class=\"btn\" id=\"submitBtn\" type=\"submit\">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà & ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button></div>\n      </form>\n\n      <div class=\"footer\" id=\"hint\">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>\n    </div>\n    <div class=\"glo\"></div>\n  </div>\n\n<script>\n  // particles\n  const part = document.getElementById('particles');\n  const N = 28;\n  for(let i=0;i<N;i++){\n    const s = document.createElement('span'); s.className='p';\n    s.style.left = (Math.random()*100)+'vw';\n    s.style.top  = ((Math.random()*100)+40)+'vh';\n    s.style.animation = 'floaty ' + (22+Math.random()*14) + 's linear ' + (-Math.random()*30) + 's infinite';\n    s.style.width = s.style.height = (Math.random()>0.6?4:6)+'px';\n    part.appendChild(s);\n  }\n\n  const $ = (s,el=document)=>el.querySelector(s);\n  const pad = n => String(n).padStart(2,'0');\n\n  // query\n  const qp = new URLSearchParams(location.search);\n  const q = Object.fromEntries(qp.entries());\n\n  $('#candName').textContent = q.name || '-';\n  $('#candPos').textContent  = q.pos  || '-';\n\n  const chips = $('#chips');\n  const chip = t => { const e=document.createElement('span'); e.className='chip'; e.textContent=t; return e; };\n  (q.email && chips.append(chip(q.email)));\n  (q.tz||q.timezone) && chips.append(chip(q.tz||q.timezone));\n  (q.mode && chips.append(chip(q.mode)));\n  (q.score && chips.append(chip('‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô '+q.score+'%')));\n\n  // hidden\n  $('#subId').value   = q.subId || q.subID || q.subid || '';\n  $('#name').value    = q.name  || '';\n  $('#email').value   = (q.email||'').toLowerCase();\n  $('#pos').value     = q.pos   || '';\n  $('#score').value   = q.score || '';\n  $('#mode').value    = (q.mode || '').toLowerCase();\n  $('#pref_old').value= q.pref  || '';\n\n  // tz + date defaults\n  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Asia/Bangkok';\n  $('#tz').value = q.tz || q.timezone || tz;\n\n  function toLocalInput(d){\n    return d.getFullYear()+'-'+pad(d.getMonth()+1)+'-'+pad(d.getDate())+'T'+pad(d.getHours())+':'+pad(d.getMinutes());\n  }\n  (function initDate(){\n    const el = $('#pref_dt');\n    const fromQ = (q.pref||'').trim().replace(' ','T');\n    let d;\n    if(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}$/.test(fromQ)) d = new Date(fromQ);\n    else d = new Date(Date.now()+90*60*1000);\n    el.value = toLocalInput(d);\n    el.min   = toLocalInput(new Date(Date.now()+30*60*1000));\n  })();\n\n  // ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô (‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß) ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î native picker\n  $('#calBtn').addEventListener('click', ()=>{\n    const el = $('#pref_dt');\n    if (typeof el.showPicker === 'function') el.showPicker();\n    else el.focus();\n  });\n\n  // copy\n  $('#copyBtn').addEventListener('click', async ()=>{\n    try{\n      await navigator.clipboard.writeText($('#pref_dt').value);\n      $('#hint').innerHTML = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡πâ‡∏ß <span style=\"color:#86efac;font-weight:700\">‚úî</span>';\n    }catch{ $('#hint').textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'; }\n  });\n\n  // ripple coords\n  const btn = $('#submitBtn');\n  btn.addEventListener('mousemove', e=>{\n    const r=e.currentTarget.getBoundingClientRect();\n    e.currentTarget.style.setProperty('--x',(e.clientX-r.left)+'px');\n    e.currentTarget.style.setProperty('--y',(e.clientY-r.top)+'px');\n  });\n\n  // tilt card\n  const card = document.getElementById('card');\n  let tId;\n  card.addEventListener('pointermove', (e)=>{\n    const r = card.getBoundingClientRect();\n    const x = (e.clientX - r.left) / r.width - .5;\n    const y = (e.clientY - r.top)  / r.height - .5;\n    cancelAnimationFrame(tId);\n    tId = requestAnimationFrame(()=> card.style.transform =\n      'rotateX(' + (y*-6) + 'deg) rotateY(' + (x*8) + 'deg) translateZ(0)');\n  });\n  card.addEventListener('pointerleave', ()=>{ card.style.transform=''; });\n\n  // confetti + submit\n  function fireConfetti(x,y){\n    const n=22, box = document.body;\n    for(let i=0;i<n;i++){\n      const s=document.createElement('span');\n      s.style.position='fixed'; s.style.left=x+'px'; s.style.top=y+'px';\n      s.style.width=s.style.height='8px';\n      s.style.background=['#60a5fa','#22c55e','#a78bfa','#f59e0b'][i%4];\n      s.style.borderRadius='2px'; s.style.pointerEvents='none'; s.style.zIndex=9999;\n      const dx=(Math.random()-.5)*2, dy=(Math.random()-.8)*2.6, rot=Math.random()*720;\n      s.animate([{transform:'translate(0,0) rotate(0)',opacity:1},\n                 {transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],\n                 {duration:650+Math.random()*250, easing:'cubic-bezier(.22,1,.36,1)'});\n      setTimeout(()=>s.remove(),900); box.appendChild(s);\n    }\n  }\n\n  const form = $('#f');\n  form.action = '${POST_URL}';\n  form.addEventListener('submit', (e)=>{\n    e.preventDefault();\n    btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';\n    $('#hint').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ñ‡∏∂‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£';\n    fireConfetti(innerWidth/2, (innerHeight/2)+20);\n    setTimeout(()=> form.submit(), 600);\n  });\n</script>\n</body>\n</html>`;\n\nreturn [{ json: { html } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        3888
      ],
      "id": "a4ed0e82-77b4-4ce3-be94-a733d4ea0039",
      "name": "Code in JavaScript14"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2608,
        3888
      ],
      "id": "3efeadf0-01a9-41f6-924c-f6e2ef471101",
      "name": "Respond to Webhook8"
    },
    {
      "parameters": {
        "path": "hr-reschedule",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2160,
        3888
      ],
      "id": "d5fb7005-f780-488b-9a90-11daa73229b4",
      "name": "HR Reschedule (GET)",
      "webhookId": "16537442-cffb-4c1c-ae86-eb676902d1c1"
    },
    {
      "parameters": {
        "fromEmail": "hrspuaiclub@gmail.com",
        "toEmail": "={{$json.email}}",
        "subject": "={{$json.cand_subject}}",
        "html": "={{$json.cand_html}}",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        2608,
        4112
      ],
      "id": "c082fa5c-36e2-4ab0-9f9d-6e0f23c1cfec",
      "name": "Send email6",
      "webhookId": "1d3ead4e-44a7-4dc9-8cb4-b618101a850f",
      "credentials": {
        "smtp": {
          "id": "cjndGMtRHrAmOvgu",
          "name": "SMTP account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "hr-reschedule-submit",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2160,
        4112
      ],
      "id": "a04d4f1d-a7b9-42a2-84df-37090ba6225b",
      "name": "HR Reschedule (POST)1",
      "webhookId": "16537442-cffb-4c1c-ae86-eb676902d1c1"
    },
    {
      "parameters": {
        "jsCode": "// ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£\nconst esc = s => String(s??'').replace(/&/g,'&amp;').replace(/</g,'&lt;')\n  .replace(/\"/g,'&quot;').replace(/>/g,'&gt;');\n\nfunction parsePrefDT(s){\n  if(!s) return null;\n  const m=String(s).trim().replace('T',' ').match(/^(\\d{4})-(\\d{2})-(\\d{2})[ T](\\d{2}):(\\d{2})$/);\n  if(!m) return null;\n  const y=+m[1],M=+m[2],d=+m[3],h=+m[4],mi=+m[5];\n  return { y,M,d,h,mi, ts: Date.UTC(y,M-1,d,h,mi,0) };\n}\nconst TH_MONTH=['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];\nconst zz=n=>String(n).padStart(2,'0');\nfunction fmtThai(pref_dt){\n  const p=parsePrefDT(pref_dt); if(!p) return '-';\n  return `${p.d} ${TH_MONTH[p.M-1]} ${p.y+543} ${zz(p.h)}:${zz(p.mi)}`;\n}\n\nconst f = $json.body || {};\nconst payload = {\n  subId: f.subId||'', name: f.name||'',\n  email: (f.email||'').toLowerCase(),\n  pos: f.pos||'', score: f.score||'',\n  pref_dt: String(f.pref_dt||''),\n  timezone: f.timezone || f.tz || 'Asia/Bangkok',\n  mode: (f.mode||'').toLowerCase() || 'online',\n  location: f.location || '',\n  note: f.note || ''\n};\nconst pretty = fmtThai(payload.pref_dt);\n\n// ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£\nconst cand_subject = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå ‚Äì ${pretty}`;\nconst cand_html = `\n<table role=\"presentation\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#f5f7fb;margin:0;padding:24px;font-family:Segoe UI,Tahoma,Arial,sans-serif;\">\n  <tr><td align=\"center\">\n    <table role=\"presentation\" width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"max-width:600px;background:#ffffff;border:1px solid #e6e9ef;border-radius:14px;overflow:hidden\">\n      <tr>\n        <td align=\"center\" style=\"background:#0ea5e9;color:#ffffff;padding:22px 20px\">\n          <div style=\"font-size:18px;font-weight:800;letter-spacing:.3px;\">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå</div>\n          <div style=\"opacity:.9;font-size:13px;margin-top:6px\">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ${esc(payload.pos)}</div>\n        </td>\n      </tr>\n      <tr><td style=\"padding:24px 22px;color:#111827;\">\n        <div style=\"font-size:18px;font-weight:700;margin-bottom:8px\">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${esc(payload.name)} üëã</div>\n        <div style=\"line-height:1.7\">\n          ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏°‡∏†‡∏≤‡∏©‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô <b>${esc(pretty)}</b> (${esc(payload.timezone)})<br>\n          ‡πÇ‡∏´‡∏°‡∏î: <b>${esc(payload.mode)}</b>${payload.location ? `<br>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡∏•‡∏¥‡∏á‡∏Å‡πå: <b>${esc(payload.location)}</b>` : ''}\n          ${payload.note ? `<br><br><i>${esc(payload.note)}</i>` : ''}\n        </div>\n      </td></tr>\n    </table>\n  </td></tr>\n</table>`;\n\n// ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•\nconst html = `<!doctype html><meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡πâ‡∏ß</title>\n<body style=\"margin:0;background:#0b1020;color:#e5e7eb;min-height:100vh;display:grid;place-items:center;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans Thai,Noto Sans,Arial\">\n  <main style=\"background:#111827;border:1px solid #334155;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.45);padding:22px;max-width:720px;width:calc(100% - 28px)\">\n    <h2 style=\"margin:0 0 8px\">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ</h2>\n    <div style=\"font-size:14px;color:#9ca3af;margin-bottom:8px\">${esc(payload.name)} ‚Äî ${esc(payload.pos)}</div>\n    <div style=\"background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px 16px;margin-bottom:6px\">\n      ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà: <b>${esc(pretty)}</b> (${esc(payload.timezone)}) ¬∑ ‡πÇ‡∏´‡∏°‡∏î: <b>${esc(payload.mode)}</b>\n      ${payload.location ? `<div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà/‡∏•‡∏¥‡∏á‡∏Å‡πå: ${esc(payload.location)}</div>` : ''}\n    </div>\n    <div style=\"color:#9ca3af;font-size:12px\">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á: ${esc(payload.email)}</div>\n  </main>\n</body>`;\n\nreturn [{\n  json: {\n    ...payload,\n    cand_subject,\n    cand_html,\n    html\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2384,
        4112
      ],
      "id": "20457c4e-9640-42cc-9b4a-8187c7a3a678",
      "name": "Code in JavaScript17"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=utf-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        3056,
        4112
      ],
      "id": "d598e035-78f1-4553-81e1-e9ca110994e2",
      "name": "Respond to Webhook10"
    },
    {
      "parameters": {
        "jsCode": "/**\n * HR Reschedule Submit ‚Üí Thank-you page\n * ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à + ‡∏õ‡∏∏‡πà‡∏° Add to Calendar (‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏î‡∏¥‡∏°)\n */\n\n/* ---------- helpers ---------- */\nconst esc = (v) => String(v ?? '')\n  .replace(/&/g,'&amp;').replace(/</g,'&lt;')\n  .replace(/\"/g,'&quot;').replace(/>/g,'&gt;');\n\nconst TH_MONTH = ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];\nconst zz = (n) => String(n).padStart(2,'0');\n\n/** parse ISO-ish: YYYY-MM-DD[ T]HH:mm[:ss][.sss][Z|¬±HH[:mm]] */\nfunction parsePrefDT(raw){\n  if(!raw) return null;\n  const str = String(raw).trim();\n  const m = str.replace('t','T').match(\n    /^(\\d{4})-(\\d{2})-(\\d{2})[ T](\\d{2}):(\\d{2})(?::(\\d{2}))?(?:\\.(\\d+))?(Z|([+-]\\d{2}):?(\\d{2}))?$/\n  );\n  if(!m) return null;\n  const y=+m[1], M=+m[2], d=+m[3], h=+m[4], mi=+m[5], sec=+(m[6]||0);\n  const offSign = m[8] && m[8] !== 'Z' ? (m[8][0] === '-' ? -1 : 1) : 0;\n  const offH = m[9] ? Math.abs(+m[9]) : 0;\n  const offM = m[10]? Math.abs(+m[10]) : 0;\n  let ts = Date.UTC(y, M-1, d, h, mi, sec);\n  if(offSign !== 0){ ts -= offSign * ((offH*60 + offM) * 60 * 1000); }\n  return { y, M, d, h, mi, sec, ts, raw: str };\n}\nfunction fmtThai(v){\n  const p = parsePrefDT(v);\n  if(!p) return v || '-';\n  return `${p.d} ${TH_MONTH[p.M-1]} ${p.y+543} ${zz(p.h)}:${zz(p.mi)}`;\n}\nfunction icsUTC(d){\n  return d.getUTCFullYear()+zz(d.getUTCMonth()+1)+zz(d.getUTCDate())\n    +'T'+zz(d.getUTCHours())+zz(d.getUTCMinutes())+zz(d.getUTCSeconds())+'Z';\n}\n\n/* Calendar link ‚Äî ‡πÉ‡∏ä‡πâ UTC ‡∏ä‡∏±‡∏ß‡∏£‡πå + ‡πÉ‡∏™‡πà ctz ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡πÇ‡∏ã‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏ú‡πà‡∏≤‡∏ô JS */\nfunction calendarLink(row, minutes=60, tz='Asia/Bangkok'){\n  const p = parsePrefDT(row.pref_dt); if(!p) return '';\n  const a=new Date(p.ts), b=new Date(p.ts+minutes*60*1000);\n  const dates=`${icsUTC(a)}/${icsUTC(b)}`;\n  const text=encodeURIComponent(`Interview: ${row.name} (${row.pos})`);\n  const details=encodeURIComponent(\n    `Candidate: ${row.name} <${row.email}>\\n`+\n    `Mode: ${String(row.mode||'').toUpperCase()}`+\n    (row.location?`\\nLocation: ${row.location}`:'')+\n    (row.meet_url?`\\nMeet: ${row.meet_url}`:'')\n  );\n  const ctz = encodeURIComponent(tz || 'Asia/Bangkok');\n  return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${text}&details=${details}&dates=${dates}&ctz=${ctz}`;\n}\n\n/* ---------- pull data from everywhere ---------- */\nconst bags = [];\nbags.push($json || {});\ntry { for (const it of await $input.all()) bags.push(it.json || {}); } catch(e){}\n\n/* ‡πÇ‡∏´‡∏ô‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏±‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */\nconst candidateNodeNames = [\n  'HR Reschedule (POST)','HR Reschedule ‚Äì POST','HR Reschedule - POST',\n  'HR Reschedule Submit','HR Reschedule Submit (webhook)',\n  'Webhook', 'Webhook1', 'Webhook2',\n  ...Array.from({length:40}, (_,i)=>`Code in JavaScript${i||''}`),\n  'Update row in sheet','Update row in sheet1','Get row(s) in sheet','Get row(s) in sheet1',\n  ...Array.from({length:10}, (_,i)=>`Send email${i||''}`)\n];\n\nfor (const name of candidateNodeNames){\n  try{\n    const arr = $items(name);\n    if (arr?.length){\n      for (const it of arr){\n        const j = it.json || {};\n        bags.push(j);\n        if (j.body)  bags.push(j.body);\n        if (j.query) bags.push(j.query);\n        if (j.data)  bags.push(j.data);\n      }\n    }\n  }catch(_){}\n}\nfor (const b of [...bags]){ if(b?.query) bags.push(b.query); if(b?.body) bags.push(b.body); if(b?.data) bags.push(b.data); }\n\n/* ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á */\nconst pick = (...keys) => {\n  for (const bag of bags){\n    for (const k of keys){\n      if (bag && Object.prototype.hasOwnProperty.call(bag,k)){\n        const v = bag[k];\n        if (v !== undefined && v !== null && String(v) !== '') return v;\n      }\n    }\n  }\n  return '';\n};\n\n/* ---------- normalize ---------- */\nconst name  = pick('name','candidate','fullname') || '-';\nconst email = String(pick('email','mail') || '').toLowerCase();\nconst pos   = pick('pos','position','role','title') || '-';\nconst mode  = String(pick('mode','interview_mode','format') || '').toLowerCase();\n\nconst pref  = pick('new_pref_dt','pref_dt','pref','datetime','interview_dt','dt') || '';\nconst tz    = pick('timezone','tz','time_zone') || 'Asia/Bangkok';\n\nconst location = pick('location','loc','place','venue','room','address') || '';\nconst meetUrl  = pick('meet_url','meet','meeting_url','link','url') || '';\nconst score    = pick('score','ai_score') || '';\n\nconst pretty  = pref ? fmtThai(pref) : '-';\nconst calUrl  = pref ? calendarLink({ pref_dt: pref, name, email, pos, mode, location, meet_url: meetUrl }, 60, tz) : '';\n\n/* ---------- animated UI ---------- */\nconst html = `<!doctype html><html lang=\"th\"><head>\n<meta charset=\"utf-8\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>\n<title>‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</title>\n<style>\n:root{--bg:#070b17;--card:#101827;--line:#243142;--muted:#9ca3af;--text:#e5e7eb;--ok:#22c55e}\n*{box-sizing:border-box}html,body{height:100%}\nbody{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,\"Segoe UI\",Roboto,\"Noto Sans Thai\",Arial;overflow:hidden}\n.stage{position:fixed;inset:0;overflow:hidden}\n.aurora{position:absolute;inset:-20% -20%;\n  background:\n    radial-gradient(40% 60% at 20% 10%, #1d4ed880 0%, transparent 60%),\n    radial-gradient(45% 65% at 80% 0%,  #7c3aed70 0%, transparent 60%),\n    radial-gradient(60% 60% at 0% 100%, #0ea5e980 0%, transparent 60%),\n    radial-gradient(55% 55% at 100% 100%, #22c55e55 0%, transparent 60%);\n  filter:blur(40px) saturate(1.1);animation:drift 22s linear infinite;opacity:.9}\n@keyframes drift{0%{transform:translate3d(0,0,0) rotate(0)}50%{transform:translate3d(-3%,2%,0) rotate(180deg)}100%{transform:translate3d(0,0,0) rotate(360deg)}}\n.particles{position:absolute;inset:0;pointer-events:none}\n.p{position:absolute;width:6px;height:6px;border-radius:999px;background:linear-gradient(#fff,#c7d2fe);filter:blur(.2px);opacity:.55;box-shadow:0 0 12px 2px rgba(167,139,250,.45)}\n.p:nth-child(odd){background:linear-gradient(#a5b4fc,#fff)}\n@keyframes floaty{from{transform:translateY(0)}to{transform:translateY(-40vh)}}\n.wrap{position:relative;z-index:2;display:grid;place-items:center;min-height:100vh;padding:28px}\n.card{width:min(760px,94vw);border-radius:20px;padding:18px;background:linear-gradient(var(--card),var(--card)) padding-box,conic-gradient(from 120deg,#60a5fa40,#a78bfa40,#22c55e40,#60a5fa40) border-box;border:1px solid transparent;box-shadow:0 24px 60px rgba(0,0,0,.55),inset 0 1px 0 rgba(255,255,255,.04);animation:cardIn .7s cubic-bezier(.22,1,.36,1)}\n@keyframes cardIn{from{opacity:0;transform:translateY(14px) scale(.985)}to{opacity:1;transform:translateY(0) scale(1)}}\n.row{display:flex;align-items:center;gap:10px}.okIcon{color:var(--ok)}\n.title{font-weight:900;font-size:18px}\n.note{margin-top:10px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px 14px;color:var(--muted)}\n.meta{display:flex;justify-content:space-between;align-items:center;gap:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px 16px;margin-top:12px}\n.btn{display:inline-grid;place-items:center;padding:10px 14px;border:0;border-radius:12px;color:#fff;font-weight:900;background:linear-gradient(92deg,#60a5fa,#3b82f6,#2563eb);box-shadow:0 16px 38px rgba(37,99,235,.35), inset 0 1px 0 rgba(255,255,255,.08);text-decoration:none;cursor:pointer}\n.glo{position:absolute;inset:auto 0 -40px 0;height:80px;filter:blur(28px);background:radial-gradient(60% 80% at 50% 0%, #60a5fa40 0%, transparent 70%)}\n</style>\n</head>\n<body>\n  <div class=\"stage\" aria-hidden=\"true\"><div class=\"aurora\"></div><div class=\"particles\" id=\"particles\"></div></div>\n  <div class=\"wrap\">\n    <div class=\"card\" id=\"card\">\n      <div class=\"row\">\n        <svg class=\"okIcon\" width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"none\">\n          <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"2\" opacity=\".25\"/>\n          <path d=\"M7 12.5l3.2 3.2L17.5 8.5\" stroke=\"currentColor\" stroke-width=\"2.8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n        </svg>\n        <div class=\"title\">‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>\n      </div>\n      <div class=\"note\">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>\n      <div class=\"meta\">\n        <div>\n          <div style=\"font-weight:700;font-size:16px\">${esc(name)} <span style=\"color:#9ca3af\">‚Äî ${esc(pos)}</span></div>\n          <div style=\"font-size:13px;color:#9ca3af\">‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà: ${esc(pretty || pref || '-')} (${esc(tz)}) ¬∑ ‡πÇ‡∏´‡∏°‡∏î: ${esc(mode || '-')}</div>\n          ${location ? `<div style=\"font-size:13px;color:#9ca3af\">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${esc(location)}</div>` : ''}\n          ${meetUrl  ? `<div style=\"font-size:13px;color:#9ca3af\">Meet: <a style=\"color:#93c5fd\" href=\"${esc(meetUrl)}\" target=\"_blank\" rel=\"noopener\">${esc(meetUrl)}</a></div>` : ''}\n          ${score ? `<div style=\"font-size:13px;color:#9ca3af\">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô AI: ${esc(score)}%</div>` : ''}\n        </div>\n        ${calUrl ? `<button class=\"btn\" id=\"gcalBtn\" type=\"button\">Add to Calendar</button>` : ``}\n      </div>\n    </div>\n    <div class=\"glo\"></div>\n  </div>\n<script>\n  // particles\n  const part=document.getElementById('particles'); const N=24;\n  for(let i=0;i<N;i++){const el=document.createElement('span');el.className='p';\n    const x=Math.random()*100, y=(Math.random()*100)+40;\n    el.style.left=x+'vw'; el.style.top=y+'vh';\n    el.style.animation='floaty '+(22+Math.random()*14)+'s linear '+(-Math.random()*30)+'s infinite';\n    el.style.width=el.style.height=(Math.random()>0.6?4:6)+'px'; part.appendChild(el);}\n  // tilt\n  const card=document.getElementById('card'); let tId;\n  card.addEventListener('pointermove',(e)=>{const r=card.getBoundingClientRect(),x=(e.clientX-r.left)/r.width-.5,y=(e.clientY-r.top)/r.height-.5;cancelAnimationFrame(tId);tId=requestAnimationFrame(()=>card.style.transform='rotateX('+(y*-6)+'deg) rotateY('+(x*8)+'deg)')}); card.addEventListener('pointerleave',()=>card.style.transform='')\n  // confetti\n  function confetti(cx,cy){const n=22;for(let i=0;i<n;i++){const el=document.createElement('span');el.style.position='fixed';el.style.left=cx+'px';el.style.top=cy+'px';el.style.width=el.style.height='8px';el.style.background=['#60a5fa','#22c55e','#a78bfa','#f59e0b'][i%4];el.style.borderRadius='2px';el.style.pointerEvents='none';el.style.zIndex=9999;const dx=(Math.random()-.5)*2,dy=(Math.random()-.8)*2.6,rot=Math.random()*720;el.animate([{transform:'translate(0,0) rotate(0)',opacity:1},{transform:'translate('+(dx*120)+'px,'+(dy*120)+'px) rotate('+rot+'deg)',opacity:0}],{duration:650+Math.random()*250,easing:'cubic-bezier(.22,1,.36,1)'});setTimeout(()=>el.remove(),900);document.body.appendChild(el);}}\n  window.addEventListener('load',()=>confetti(innerWidth/2, innerHeight/2));\n\n  // open calendar in the SAME tab\n  const calUrlVar = ${JSON.stringify(calUrl)};\n  document.getElementById('gcalBtn')?.addEventListener('click', ()=>{\n    if (calUrlVar) location.href = calUrlVar;\n  });\n</script>\n</body></html>`;\n\n/* ---------- output ---------- */\nreturn [{ json: { html } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2832,
        4112
      ],
      "id": "1c896e08-2849-4e1e-b4cf-575f9cf475a4",
      "name": "Code in JavaScript16"
    }
  ],
  "pinData": {},
  "connections": {
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload PDF1": {
      "main": [
        [
          {
            "node": "Convert/Extract from PDF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert/Extract from PDF1": {
      "main": [
        [
          {
            "node": "Prepare Text from PDF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Text from PDF1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fillout Trigger1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Upload PDF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [],
        [
          {
            "node": "Send email4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email4": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Respond to Webhook5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [],
        [
          {
            "node": "Send email5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email5": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Respond to Webhook7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Send email3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WB-Interview-GET": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WB-Interview-POST": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "Append row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet1": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "Send email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript10": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HR Admin ‚Äì GET": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Code in JavaScript11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript11": {
      "main": [
        [
          {
            "node": "Respond to Webhook2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript12": {
      "main": [
        [
          {
            "node": "Update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update row in sheet": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Code in JavaScript13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript13": {
      "main": [
        [
          {
            "node": "Send email1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send email2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email1": {
      "main": [
        []
      ]
    },
    "Send email2": {
      "main": [
        [
          {
            "node": "Respond to Webhook3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HR Admin ‚Äì Comfirm": {
      "main": [
        [
          {
            "node": "Code in JavaScript12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript14": {
      "main": [
        [
          {
            "node": "Respond to Webhook8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HR Reschedule (GET)": {
      "main": [
        [
          {
            "node": "Code in JavaScript14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send email6": {
      "main": [
        [
          {
            "node": "Code in JavaScript16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HR Reschedule (POST)1": {
      "main": [
        [
          {
            "node": "Code in JavaScript17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript17": {
      "main": [
        [
          {
            "node": "Send email6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript16": {
      "main": [
        [
          {
            "node": "Respond to Webhook10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "UKKsQWocZsyLEfEo"
  },
  "versionId": "9d58b931-e4ba-4921-8ca4-80bcca405bef",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "cef8168519f561fc3932dbad25026c17206710c4a9025c300251d2fda303df10"
  },
  "id": "UKKsQWocZsyLEfEo",
  "tags": []
}